<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Power of Deduction | BELAUG · FFXIV Library</title>
  <meta name="description" content="MSQ – Power of Deduction (ARR Patch 2.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:var(--fg);border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}
    /* 展開/收合 */
    .clamp{position:relative; max-height:360px; overflow:hidden}
    .clamp[data-collapsed="false"]{max-height:none}
    .clamp[data-collapsed="true"]::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:72px;
      background:linear-gradient(to bottom, rgba(255,255,255,0), var(--card)); pointer-events:none;
    }
    .expand-wrap{ margin-top:12px; }
    .expand-btn{
      display:inline-block; padding:8px 14px; border-radius:10px;
      background:var(--card); border:1px solid var(--border); cursor:pointer; font-weight:600;
    }
    .expand-btn:hover{ background:#fffef8; }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">🏠 Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="切換語言">🌐 EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <!-- 左：影片 -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/zAh6gMUoZXw"
              title="Power of Deduction" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- 右：標題 + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">Power of Deduction</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story"   class="tab-panel active"></div>
          <div id="panel-acq"     class="tab-panel"></div>
          <div id="panel-unlockq" class="tab-panel"></div>
          <div id="panel-followq" class="tab-panel"></div>
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const LANG_KEY = 'ffxiv-guide-lang';
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:'Power of Deduction',
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    readMore:'Show more', readLess:'Show less',
    story:`<div class="clamp" data-collapsed="true">
      <p>Sleepless and on edge, Medrod confesses that the lack of leads gnaws at him. Ivaurault, after much doubt, swears he truly saw a winged eyeball—no banemite could be so distinct. The group puzzles over how he and Medrod witnessed it at the same moment from malms apart, and Aideen lands on a chilling answer: there must be more than one. If the fiends have been seen repeatedly, then more victims likely lie undiscovered. With a collective gulp, the civilians bow out, urging you—the expert—to take over. Ivaurault points you to the rocky ground west of North Shroud and advises that any findings should be reported at the nearby guardhouse; the Serpents will want to hear anything that concerns regional safety.</p>
      <p>At the western crags you discover the grim proof: another victim. You present the body to Aethelmaer at the guardhouse. The officer steels himself—he’ll never grow used to such sights. Similar murders have been reported in the Central Shroud; while the masked stranger hasn’t been seen at those scenes, sightings of the winged eyeball are common, and the creature seems to move the bodies for reasons unknown. All the dead are young women, their faces mutilated beyond recognition, which has hampered identification. From the latest corpse, Aethelmaer recovers a button engraved with a lily—an object found on another victim as well. Perhaps, he hopes, this small emblem will prove the key to unraveling the killings.</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> Medrod <small class="muted">(North Shroud, X:21.7, Y:26.7)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="seeing-eye-to-winged-eye.html">Seeing Eye to Winged Eye</a></div>
      <div class="row"><a class="link" href="rock-of-rancor.html">Rock of Rancor</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="secret-of-the-white-lily.html">Secret of the White Lily</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'推理は踊る',
    tabs:{ story:'ストーリー', acq:'入手方法', unlockq:'開放クエスト', followq:'後続クエスト', comments:'コメント' },
    readMore:'全文を表示', readLess:'折りたたむ',
    story:`<div class="clamp" data-collapsed="true">
      <p>手がかりの乏しさに眠れぬ夜を過ごすメドロッド。イヴォーロは逡巡の末、やはり自分が見たのは「翼を持つ目玉」に違いないと断言する。二人が離れた場所で同時に目撃した矛盾に皆が首をかしげる中、アイディーンははっと気づく──同種の魔物が複数いるのだ、と。再三の目撃があるなら、まだ見つかっていない被害者もいるはず。一般人である彼女らは「ここから先は専門家に任せる」と身を引き、イヴォーロは北部森林西の岩場を示し、見つけたものは近くの詰所で双蛇党に報告するよう勧めた。</p>
      <p>西の岩場で、あなたは新たな遺体を発見。詰所の隊士エセルメアへ引き渡すと、彼はやり切れない面持ちで語る。中央森林でも同様の殺害が報告されており、現場で「仮面の男」は確認されていないが、「翼を持つ目玉」の目撃は多いという。あの魔物は遺体を運んでいる節があるが、目的は不明。被害者はいずれも若い女性で、顔面は判別不能なほど損壊しており身元特定が難航している。今回の遺体からは百合の意匠が刻まれたボタンが見つかった──同じものが別件でも発見されており、この発見が事件解決の糸口になるかもしれない、と彼は希望を口にする。</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>クエスト発行</b> メドロド　黒衣森：北部森林 <small class="muted">(X:21.7, Y:26.7)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="seeing-eye-to-winged-eye.html">逢魔が時に光る瞳</a></div>
      <div class="row"><a class="link" href="rock-of-rancor.html">怨念岩の謎</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="secret-of-the-white-lily.html">白百合は謡う</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'推理的力量',
    tabs:{ story:'故事概要', acq:'取得方式', unlockq:'解鎖任務', followq:'後續任務', comments:'留言' },
    readMore:'展開全文', readLess:'收合內容',
    story:`<div class="clamp" data-collapsed="true">
      <p>線索依舊停滯，Medrod 因焦慮而夜夜難眠。Ivaurault 在反覆思量後堅稱自己確實看見了 winged eyeball，絕不可能與 banemite 搞混。眾人困惑於他與 Medrod 相距數 malms 卻同時目擊的矛盾；Aideen 忽然醒悟——恐怕不只一隻。若多次出現於 North Shroud，一定還有尚未被發現的受害者。幾人面面相覷，決定把後續交給你這位專業冒險者。Ivaurault 指向西方岩地，提醒你一有發現便去附近哨所通報；那裡的 Serpents 會重視任何攸關區域安危的情報。</p>
      <p>你在西側岩地找到了新的屍體，並將其呈交給哨所的 Aethelmaer。即使身經百戰，他仍難以習慣這般景象。Central Shroud 也出現相同的案件；雖然現場未見「戴面具的神秘人」，但 winged eyeball 的目擊頻繁，而牠似乎會移動屍體，至於目的不得而知。所有受害者皆是年輕女性，臉部遭到毀壞，導致身分難以確認。Aethelmaer 在這具遺體上找到一枚刻有百合圖樣的鈕扣——與另一名受害者持有的物件相同。他希望這枚小小的徽記，能成為破解連環兇殺的關鍵。</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>任務發布</b> 梅卓德　黑衣森林北部 <small class="muted">(X:21.7, Y:26.7)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="seeing-eye-to-winged-eye.html">暮光之瞳</a></div>
      <div class="row"><a class="link" href="rock-of-rancor.html">怨岩之謎</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="secret-of-the-white-lily.html">白百合的秘密</a></div>
    </div>`
  }
};

const langToggle  = document.getElementById('langToggle');
const pageTitle   = document.getElementById('pageTitle');
const tabBtns     = [...document.querySelectorAll('.tab-btn')];
const panels = {
  story:  document.getElementById('panel-story'),
  acq:    document.getElementById('panel-acq'),
  unlockq:document.getElementById('panel-unlockq'),
  followq:document.getElementById('panel-followq'),
  comments: document.getElementById('panel-comments')
};

function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }
function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `🌐 ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}

function wireClamp(panelEl, t){
  const clamp = panelEl.querySelector('.clamp');
  const btn = panelEl.querySelector('[data-role="expand"]');
  if(!clamp || !btn) return;
  function setLabel(){
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    btn.textContent = collapsed ? t.readMore : t.readLess;
  }
  setLabel();
  btn.addEventListener('click', ()=>{
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    clamp.setAttribute('data-collapsed', collapsed ? 'false' : 'true');
    setLabel();
  });
}

function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  if (key !== 'comments') panels[key].innerHTML = t[key];
  if (key === 'story') wireClamp(panels[key], t);
  if (key === 'comments') loadGiscusForCurrentLang();
}

tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});

langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem(LANG_KEY, next);
  applyLang(next);
});

applyLang(getLang());

/* === Giscus：Comments 分頁 === */
const GISCUS_CFG = {
  repo: 'BELAUG-FFXIV/FFXIV_Library',
  repoId: 'R_kgDOPyh4Kw',
  category: 'General',
  categoryId: 'DIC_kwDOPyh4K84CwPjL',
  theme: 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  mount.innerHTML = '';
  const langCode = getLang();
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + '｜' + langCode);
  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;
  mount.appendChild(s);
}
</script>
</body>
</html>
