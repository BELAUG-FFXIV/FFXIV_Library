<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>A Modest Proposal | BELAUG Â· FFXIV Library</title>
  <meta name="description" content="MSQ â€“ A Modest Proposal (ARR Patch 2.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:var(--fg);border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}
    .clamp{position:relative; max-height:360px; overflow:hidden}
    .clamp[data-collapsed="false"]{max-height:none}
    .clamp[data-collapsed="true"]::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:72px;
      background:linear-gradient(to bottom, rgba(255,255,255,0), var(--card)); pointer-events:none;
    }
    .expand-wrap{ margin-top:12px; }
    .expand-btn{
      display:inline-block; padding:8px 14px; border-radius:10px;
      background:var(--card); border:1px solid var(--border); cursor:pointer; font-weight:600;
    }
    .expand-btn:hover{ background:#fffef8; }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">ğŸ  Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="åˆ‡æ›èªè¨€">ğŸŒ EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <!-- å·¦ï¼šå½±ç‰‡ -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/vKYemSkDhY4"
              title="A Modest Proposal" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- å³ï¼šæ¨™é¡Œ + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">A Modest Proposal</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story"   class="tab-panel active"></div>
          <div id="panel-acq"     class="tab-panel"></div>
          <div id="panel-unlockq" class="tab-panel"></div>
          <div id="panel-followq" class="tab-panel"></div>
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const LANG_KEY = 'ffxiv-guide-lang';
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:'A Modest Proposal',
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    readMore:'Show more', readLess:'Show less',
    story:`<div class="clamp" data-collapsed="true">
      <p>Wheiskaet tells you that two highly distinguished visitors are expected to arrive at Costa del Sol soon, and Master Gegeruju intends to greet them with an elaborate banquet.</p>
      <p>Money, however, will not buy everything his master desires. This is to be an exceedingly exotic feast, and your mission is to seek out and obtain the rare ingredients the chef requires.</p>
      <p>Fine dining also demands a fitting wineâ€”by â€œfitting,â€ Wheiskaet means the very best there is. But he sets that aside for now, insisting you already have enough on your plate.</p>
      <p>The journey will be long and arduous, yet you will not be made to toil alone. Many mercenaries who once served under Wheiskaetâ€™s command still live, and they will guide you. For the first ingredient, he orders you to travel to the South Shroud and speak with Landenel at Camp Tranquil.</p>
      <p>When you push back, saying you cannot afford to waste time, Wheiskaet answers without patience. If you lack the endurance to finish this mission, he demands, how can he believe you will outlast the Lord of Crags? Do it or donâ€™tâ€”he has work to do.</p>
      <p>At Camp Tranquil, Landenel asks if you require assistance, then looks you over with open appraisal. So you are the one who would challenge Titanâ€”he has been expecting you.</p>
      <p>He tells you the ingredient you seek: the egg of a giant adamantoise. The method should be obviousâ€”you steal it from the beastâ€™s nest. Simple in theory, difficult in execution, and most who attempt it die. As for help, Landenel only laughs; he will not jeopardize his position by openly assisting you. From him, you will receive informationâ€”what you do with it is your choice.</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> Wheiskaet <small class="muted">Eastern La Noscea (X:32.6, Y:30.5)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="nix-that.html">Nix That</a></div>
      <div class="row">All classes and jobs (excluding limited jobs) (Level 30 or above)</div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="trial-by-turtle.html">Trial by Turtle</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'ã‚¨ã‚ªãƒ«ã‚¼ã‚¢ã®çå‘³ã‚’æ±‚ã‚ã¦',
    tabs:{ story:'ã‚¹ãƒˆãƒ¼ãƒªãƒ¼', acq:'å…¥æ‰‹æ–¹æ³•', unlockq:'é–‹æ”¾ã‚¯ã‚¨ã‚¹ãƒˆ', followq:'å¾Œç¶šã‚¯ã‚¨ã‚¹ãƒˆ', comments:'ã‚³ãƒ¡ãƒ³ãƒˆ' },
    readMore:'å…¨æ–‡ã‚’è¡¨ç¤º', readLess:'æŠ˜ã‚ŠãŸãŸã‚€',
    story:`<div class="clamp" data-collapsed="true">
      <p>ãƒ´ã‚§ã‚¤ã‚¹ã‚±ãƒ¼ãƒˆã¯ã€è¿‘ã„ã†ã¡ã«ã‚³ã‚¹ã‚¿ãƒ»ãƒ‡ãƒ«ãƒ»ã‚½ãƒ«ã¸ã€ç‰¹ã«é«˜åãªæ¥å®¢ãŒäºŒåè¨ªã‚Œã‚‹äºˆå®šã ã¨å‘Šã’ã‚‹ã€‚ã‚²ã‚²ãƒ«ã‚¸ãƒ¥æ§˜ã¯ã€ãã®è€…ãŸã¡ã‚’ç››å¤§ãªæ™©é¤ã§ã‚‚ã¦ãªã—ãŸã„ã®ã ã¨ã„ã†ã€‚</p>
      <p>ã ãŒã€é‡‘ã«ç³¸ç›®ã‚’ã¤ã‘ãªã‘ã‚Œã°ä½•ã§ã‚‚æ‰‹ã«å…¥ã‚‹ã‚ã‘ã§ã¯ãªã„ã€‚ç”¨æ„ã™ã‚‹ã®ã¯ã€ãã‚ã‚ã¦çå¥‡ãªé¦³èµ°ã€‚ãã®ãŸã‚ã«å¿…è¦ã¨ãªã‚‹å¸Œå°‘ãªé£Ÿæã‚’æ¢ã—å‡ºã—ã€å…¥æ‰‹ã™ã‚‹ã“ã¨â€•â€•ãã‚ŒãŒã‚ãªãŸã®ä»»å‹™ã ã€‚</p>
      <p>ã•ã‚‰ã«ã€ä¸Šè³ªãªæ–™ç†ã«ã¯ç›¸å¿œã®è‘¡è„é…’ãŒæ¬ ã‹ã›ãªã„ã€‚ã€Œç›¸å¿œã€ã¨ã¯ã€Œã“ã®ä¸Šãªãæœ€ä¸Šã®ã‚‚ã®ã€ã‚’æ„å‘³ã™ã‚‹ã€ã¨ãƒ´ã‚§ã‚¤ã‚¹ã‚±ãƒ¼ãƒˆã¯å¿µã‚’æŠ¼ã™ã€‚ã¨ã¯ã„ãˆã€ãã‚Œã¯ã²ã¨ã¾ãšå¾Œå›ã—ã ã€‚ä»Šã®ã‚ãªãŸã«ã¯ã€ã™ã§ã«æŠ±ãˆã‚‹ã‚‚ã®ãŒååˆ†ã«ã‚ã‚‹ã®ã ã‹ã‚‰ã¨ã€‚</p>
      <p>é“ã®ã‚Šã¯é•·ãã€éª¨ã®æŠ˜ã‚Œã‚‹æ—…ã«ãªã‚‹ãŒã€ã²ã¨ã‚Šã§è‹¦åŠ´ã™ã‚‹å¿…è¦ã¯ãªã„ã€‚ã‹ã¤ã¦ãƒ´ã‚§ã‚¤ã‚¹ã‚±ãƒ¼ãƒˆã®æŒ‡æ®ä¸‹ã«ã„ãŸå‚­å…µãŸã¡ãŒä»Šã‚‚å„åœ°ã«ãŠã‚Šã€ã‚ãªãŸã‚’å°ãã¨ã„ã†ã€‚ã¾ãšã¯é»’è¡£æ£®ï¼šå—éƒ¨æ£®æ—ã¸èµ´ãã€ã‚­ãƒ£ãƒ³ãƒ—ãƒ»ãƒˆãƒ©ãƒ³ã‚­ãƒ«ã§ãƒ©ãƒ³ãƒ‰ã‚¥ãƒãƒ«ã«ä¼šãˆâ€•â€•ãã‚ŒãŒæœ€åˆã®æŒ‡ç¤ºã ã£ãŸã€‚</p>
      <p>ã‚ãªãŸãŒæ™‚é–“ã‚’ç„¡é§„ã«ã§ããªã„ã¨å‘Šã’ã‚‹ã¨ã€ãƒ´ã‚§ã‚¤ã‚¹ã‚±ãƒ¼ãƒˆã¯è‹›ç«‹ã¡ã‚’éš ã•ãªã„ã€‚ã“ã®ä»»å‹™ã‚’å®Œé‚ã™ã‚‹ã ã‘ã®å¿è€ãŒãªã„ã®ãªã‚‰ã€ã©ã†ã—ã¦è›®ç¥ã‚¿ã‚¤ã‚¿ãƒ³ã‚’ç›¸æ‰‹ã«è€ãˆæŠœã‘ã‚‹ã¨ä¿¡ã˜ã‚‰ã‚Œã‚‹ã®ã‹ã€‚ã‚„ã‚‹ã®ã‹ã€ã‚„ã‚‰ãªã„ã®ã‹â€•â€•å½¼ã«ã¯å½¼ã®ä»•äº‹ãŒã‚ã‚‹ã€ã¨çªãæ”¾ã™ã€‚</p>
      <p>ã‚­ãƒ£ãƒ³ãƒ—ãƒ»ãƒˆãƒ©ãƒ³ã‚­ãƒ«ã§ã€ãƒ©ãƒ³ãƒ‰ã‚¥ãƒãƒ«ã¯ã€ŒåŠ©åŠ›ãŒå¿…è¦ã‹ã€ã¨å•ã„ã‹ã‘ã€ã‚ãªãŸã‚’å€¤è¸ã¿ã™ã‚‹ã‚ˆã†ã«è¦‹æ®ãˆã‚‹ã€‚è›®ç¥ã‚¿ã‚¤ã‚¿ãƒ³ã«æŒ‘ã‚€è€…ãŒã€ã‚ãªãŸãªã®ã‹â€•â€•å½¼ã¯ãã‚Œã‚’å¾…ã£ã¦ã„ãŸã®ã ã¨è¨€ã†ã€‚</p>
      <p>æ±‚ã‚ã‚‹é£Ÿæã¯ã€å·¨å¤§ãªã‚¢ãƒ€ãƒãƒ³ã‚¿ã‚¹ã®åµã ã€‚å…¥æ‰‹æ³•ã¯æ˜ç™½ã ã‚ã†â€•â€•ç£ã®å·£ã‹ã‚‰ç›—ã¿å‡ºã™ã®ã ã€‚ç†å±ˆã¯å˜ç´”ã ãŒã€å®Ÿè¡Œã¯å›°é›£ã§ã€æŒ‘ã‚“ã§å‘½ã‚’è½ã¨ã™è€…ã‚‚å¤šã„ã€‚åŠ©ã‘ã‚‹ã®ã‹ã¨å•ã†ã¦ã‚‚ã€ãƒ©ãƒ³ãƒ‰ã‚¥ãƒãƒ«ã¯ç¬‘ã†ã ã‘ã ã£ãŸã€‚ç«‹å ´ã‚’å±ã†ãã—ã¦ã¾ã§è¡¨ç«‹ã£ã¦æ‰‹ã‚’è²¸ã™ã¤ã‚‚ã‚Šã¯ãªã„ã€‚ä¸ãˆã‚‹ã®ã¯æƒ…å ±ã ã‘ã§ã€ãã®å…ˆã‚’ã©ã†ã™ã‚‹ã‹ã¯ã€ã‚ãªãŸæ¬¡ç¬¬ã ã€‚</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>ã‚¯ã‚¨ã‚¹ãƒˆç™ºè¡Œ</b> ãƒ´ã‚§ã‚¤ã‚¹ã‚±ãƒ¼ãƒˆ <small class="muted">æ±ãƒ©ãƒã‚·ã‚¢ (X:32.6, Y:30.5)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="nix-that.html">ãƒ´ã‚§ã‚¤ã‚¹ã‚±ãƒ¼ãƒˆã®è…•è©¦ã—</a></div>
      <div class="row">ã™ã¹ã¦ï¼ˆãƒªãƒŸãƒ†ãƒƒãƒ‰ã‚¸ãƒ§ãƒ–ã‚’é™¤ãï¼‰Lv 30ï½</div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="trial-by-turtle.html">ã‚¢ãƒ€ãƒãƒ³ã‚¿ã‚¹ã®å¤§åµ</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'å°‹æ‰¾è‰¾æ­æ¾¤äºçš„çå‘³',
    tabs:{ story:'æ•…äº‹æ¦‚è¦', acq:'å–å¾—æ–¹å¼', unlockq:'è§£é–ä»»å‹™', followq:'å¾ŒçºŒä»»å‹™', comments:'ç•™è¨€' },
    readMore:'å±•é–‹å…¨æ–‡', readLess:'æ”¶åˆå…§å®¹',
    story:`<div class="clamp" data-collapsed="true">
      <p>Wheiskaet å‘Šè¨´ä½ ï¼Œè¿‘æœŸå°‡æœ‰å…©ä½æ¥µå…·è²æœ›çš„è²´å®¢é€ è¨ª Costa del Solï¼Œè€Œ Master Gegeruju å¸Œæœ›ä»¥ä¸€å ´ç››å¤§è€Œç²¾ç·»çš„å®´å¸­è¿æ¥ä»–å€‘ã€‚</p>
      <p>ç„¶è€Œï¼Œå°±ç®—é‡‘éŒ¢ä¸æ˜¯å•é¡Œï¼Œä¹Ÿä¸æ˜¯æ‰€æœ‰å¿ƒé¡˜éƒ½èƒ½ç”¨è²·çš„è§£æ±ºã€‚é€™å°‡æ˜¯ä¸€å ´æ¥µåº¦ã€Œç•°åœ‹é¢¨å‘³ã€çš„é¥—å®´ï¼Œå› æ­¤ä½ çš„ä»»å‹™ï¼Œæ˜¯å»å°‹æ‰¾ä¸¦å–å¾—ä¸»å»šæ‰€éœ€è¦çš„ç¨€æœ‰é£Ÿæã€‚</p>
      <p>è€Œä½³é¤šè‡ªç„¶ä¹Ÿè¦é…ä¸Šç›¸ç¨±çš„é…’ã€‚Wheiskaet æ‰€è¬‚çš„ã€Œç›¸ç¨±ã€ï¼ŒæŒ‡çš„å°±æ˜¯ã€Œæœ€å¥½çš„é‚£ä¸€ç¨®ã€ã€‚ä½†ä»–æš«æ™‚æŠŠé€™ä»¶äº‹æ“±ä¸‹ï¼Œå› ç‚ºä»–èªç‚ºä½ çœ¼å‰è¦è™•ç†çš„äº‹å·²ç¶“å¤ å¤šäº†ã€‚</p>
      <p>é€™æœƒæ˜¯ä¸€æ®µæ¼«é•·è€Œè‰±è¾›çš„æ—…ç¨‹ï¼Œä½†ä½ ä¸å¿…ç¨è‡ªå¥”æ³¢ã€‚è¨±å¤šæ›¾åœ¨ Wheiskaet éº¾ä¸‹æ•ˆå‘½çš„å‚­å…µå¦‚ä»Šä»åœ¨äººä¸–ï¼Œä»–å€‘æœƒåœ¨æ—…é€”ä¸­æŒ‡å¼•ä½ ã€‚ç¬¬ä¸€æ¨£é£Ÿæï¼Œä»–è¦ä½ å‰å¾€ South Shroudï¼Œå» Camp Tranquil æ‰¾ Landenelã€‚</p>
      <p>ç•¶ä½ è¡¨ç¤ºè‡ªå·±ç„¡æ³•æµªè²»æ™‚é–“æ™‚ï¼ŒWheiskaet çš„èªæ°£ç«‹åˆ»è®Šå¾—ä¸è€ã€‚å¦‚æœä½ é€£å®Œæˆé€™é …ä»»å‹™çš„è€åŠ›éƒ½æ²’æœ‰ï¼Œä»–åå•ï¼Œä½ è¦ä»–æ€éº¼ç›¸ä¿¡ä½ èƒ½æ’é Lord of Cragsï¼Ÿè¦åšå°±åšï¼Œä¸åšå°±ç®—â€”â€”ä»–é‚„æœ‰ä»–çš„å·¥ä½œè¦è™•ç†ã€‚</p>
      <p>æŠµé” Camp Tranquil å¾Œï¼ŒLandenel å…ˆå•ä½ æ˜¯å¦éœ€è¦å”åŠ©ï¼Œéš¨å³ä»¥æ¯«ä¸æ©é£¾çš„ç›®å…‰æ‰“é‡è‘—ä½ ã€‚åŸä¾†ï¼Œä½ å°±æ˜¯é‚£å€‹æ‰“ç®—æŒ‘æˆ° Titan çš„äººâ€”â€”ä»–ä¸€ç›´åœ¨ç­‰ä½ ã€‚</p>
      <p>ä»–å‘Šè¨´ä½ è¦æ‰¾çš„ææ–™æ˜¯ï¼šä¸€é¡†å·¨å‹é™¸é¾œï¼ˆadamantoiseï¼‰çš„è›‹ã€‚å–å¾—æ–¹æ³•æ‡‰è©²å†æ˜é¡¯ä¸éâ€”â€”ç•¶ç„¶æ˜¯å¾ç‰ çš„å·¢ç©´è£¡å·èµ°ã€‚ç†è«–ä¸Šå¾ˆç°¡å–®ï¼Œå¯¦éš›ä¸Šå»æ¥µå…¶å±éšªï¼Œå› ç‚ºå¤šæ•¸å˜—è©¦çš„äººéƒ½æ­»åœ¨é€™ä¸€æ­¥ã€‚è‡³æ–¼ä½ å•ä»–æ˜¯å¦æœƒå¹«å¿™ï¼ŒLandenel åªæ˜¯ä¸€ç¬‘ï¼›ä»–ä¸æœƒç‚ºäº†å…¬é–‹å”åŠ©ä½ è€Œè®“è‡ªå·±çš„ç«‹å ´é™·å…¥é¢¨éšªã€‚ä»–èƒ½çµ¦ä½ çš„åªæœ‰æƒ…å ±â€”â€”æ¥ä¸‹ä¾†è¦æ€éº¼åšï¼Œç”±ä½ è‡ªå·±æ±ºå®šã€‚</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>ä»»å‹™ç™¼å¸ƒ</b> ç¶­æ–¯å‡±ç‰¹ <small class="muted">æ‹‰è«¾è¥¿äºæ±éƒ¨ (X:32.6, Y:30.5)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="nix-that.html">ç¶­æ–¯å‡±ç‰¹çš„è©¦ç…‰</a></div>
      <div class="row">æ‰€æœ‰è·æ¥­ï¼ˆä¸å«é™å®šè·ï¼‰ ç­‰ç´š 30 ä»¥ä¸Š</div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="trial-by-turtle.html">å·¨é¾œçš„è©¦ç…‰ä¹‹åµ</a></div>
    </div>`
  }
};

const langToggle  = document.getElementById('langToggle');
const pageTitle   = document.getElementById('pageTitle');
const tabBtns     = [...document.querySelectorAll('.tab-btn')];
const panels = {
  story:  document.getElementById('panel-story'),
  acq:    document.getElementById('panel-acq'),
  unlockq:document.getElementById('panel-unlockq'),
  followq:document.getElementById('panel-followq'),
  comments: document.getElementById('panel-comments')
};

function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }
function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `ğŸŒ ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}

function wireClamp(panelEl, t){
  const clamp = panelEl.querySelector('.clamp');
  const btn = panelEl.querySelector('[data-role="expand"]');
  if(!clamp || !btn) return;
  function setLabel(){
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    btn.textContent = collapsed ? t.readMore : t.readLess;
  }
  setLabel();
  btn.addEventListener('click', ()=>{
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    clamp.setAttribute('data-collapsed', collapsed ? 'false' : 'true');
    setLabel();
  });
}

function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  if (key !== 'comments') panels[key].innerHTML = t[key];
  if (key === 'story') wireClamp(panels[key], t);
  if (key === 'comments') loadGiscusForCurrentLang();
}

tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});

langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem(LANG_KEY, next);
  applyLang(next);
});

applyLang(getLang());

const GISCUS_CFG = {
  repo: 'BELAUG-FFXIV/FFXIV_Library',
  repoId: 'R_kgDOPyh4Kw',
  category: 'General',
  categoryId: 'DIC_kwDOPyh4K84CwPjL',
  theme: 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  mount.innerHTML = '';
  const langCode = getLang();
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + 'ï½œ' + langCode);
  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;
  mount.appendChild(s);
}
</script>
</body>
</html>
