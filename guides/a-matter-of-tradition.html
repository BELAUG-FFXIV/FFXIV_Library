<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>A Matter of Tradition | BELAUG · FFXIV Library</title>
  <meta name="description" content="MSQ – A Matter of Tradition (ARR Patch 2.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:var(--fg);border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}

    /* 展開/收合 */
    .clamp{position:relative; max-height:360px; overflow:hidden}
    .clamp[data-collapsed="false"]{max-height:none}
    .clamp[data-collapsed="true"]::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:72px;
      background:linear-gradient(to bottom, rgba(255,255,255,0), var(--card)); pointer-events:none;
    }
    .expand-wrap{ margin-top:12px; }
    .expand-btn{
      display:inline-block; padding:8px 14px; border-radius:10px;
      background:var(--card); border:1px solid var(--border); cursor:pointer; font-weight:600;
    }
    .expand-btn:hover{ background:#fffef8; }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">🏠 Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="切換語言">🌐 EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <!-- 左：影片 -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/PSNxynTb78Y"
              title="A Matter of Tradition" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- 右：標題 + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">A Matter of Tradition</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story"   class="tab-panel active"></div>
          <div id="panel-acq"     class="tab-panel"></div>
          <div id="panel-unlockq" class="tab-panel"></div>
          <div id="panel-followq" class="tab-panel"></div>
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const LANG_KEY = 'ffxiv-guide-lang';
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:'A Matter of Tradition',
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    readMore:'Show more', readLess:'Show less',
    story:`<div class="clamp" data-collapsed="true">
      <p>By the Twelve—an adventurer like you receiving a personal invitation from Her Grace herself is unheard of. The honor weighs heavy, for only the most distinguished souls are ever granted a seat at the royal banquet. Owyne speaks of his awe, but quickly admits that he is no expert in protocol. Instead, he urges you to seek guidance from Momodi, who has long instructed foreign dignitaries in Ul’dahn custom.</p>
      <p>When you return to the Quicksand, Momodi greets you warmly, half teasing, half proud. She explains the tradition: all guests must wear ceremonial earrings, crafted for this occasion alone. They are both symbol and safeguard, ensuring that only true invitees enter the banquet hall.</p>
      <p>Your next stop is the Goldsmiths’ Guild. There, Mistress Serendipity welcomes you and presents the earrings she made by her own hand. The box, however, remains locked—only Momodi holds the authority to open it. You dutifully return, and Momodi herself unlocks the container, gasping at the finery within.</p>
      <p>She warns you to guard the earrings well; in the wrong hands, they could spell disaster. With them in your possession, you are now ready. Soon, you will walk among Ul’dah’s elite, a guest of the Sultana herself.</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> Owyne <small class="muted">(Heart of the Sworn, X:6.1, Y:6.0)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="duty-honor-country.html">Duty, Honor, Country</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="a-royal-reception.html">A Royal Reception</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'晩餐会に備えて',
    tabs:{ story:'ストーリー', acq:'入手方法', unlockq:'開放クエスト', followq:'後続クエスト', comments:'コメント' },
    readMore:'全文を表示', readLess:'折りたたむ',
    story:`<div class="clamp" data-collapsed="true">
      <p>十二神に誓って──冒険者であるあなたが、ナナモ・ウル・ナモ女王陛下から直々に宴へ招待されるとは前代未聞のこと。オワインも驚嘆しつつ、その栄誉の重みを語る。しかし礼儀作法については自分には分からぬと告げ、クイックサンドのモモディを訪ねるよう勧める。</p>
      <p>酒場へ戻ると、モモディはにこやかに迎え、半ばからかいながらも誇らしげに説明する。王家の宴に列席するには、特別に誂えられた「儀礼用の耳飾り」を必ず身につけねばならないという。象徴であり、また警護の一環であり、その耳飾りなくしては大広間に入ることは許されない。</p>
      <p>続いて黄金細工師ギルドを訪ねると、セレンディピティが出迎え、彼女自らが手がけた耳飾りを手渡す。しかし箱は固く施錠されており、開封を許されているのはモモディただひとり。あなたは耳飾りを携え、再びクイックサンドへ戻る。</p>
      <p>箱を開いたモモディは、その見事な細工に思わず息を呑む。彼女は「絶対に失くさぬように」と念を押し、もし悪人の手に渡れば何が起こるか分からないと警告する。こうして耳飾りを手にしたあなたは、いよいよウルダハの名士たちと肩を並べる時を迎えるのだった。</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>クエスト発行</b> オワイン <small class="muted">（銀冑団総長室, X:6.1, Y:6.0）</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="duty-honor-country.html">至宝の影で蠢く闇</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="a-royal-reception.html">王宮の晩餐会</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'備宴的傳統',
    tabs:{ story:'故事概要', acq:'取得方式', unlockq:'解鎖任務', followq:'後續任務', comments:'留言' },
    readMore:'展開全文', readLess:'收合內容',
    story:`<div class="clamp" data-collapsed="true">
      <p>十二神在上──一名冒險者竟能獲得女王 Nanamo Ul Namo 的親自邀請，這在 Ul’dah 前所未有。Owyne 滿是驚歎，提醒這是極為崇高的榮譽，只有最尊貴的人才能在王室宴會中占有一席。然而他坦言自己並不熟悉禮儀，勸你去找 Momodi，她一直負責接待外來賓客，熟知所有應遵守的規矩。</p>
      <p>回到 Quicksand，Momodi 熱情迎接你，語氣既調侃又帶著驕傲。她解釋道：按照古老的習俗，所有受邀出席宴會的人必須佩戴特製的「儀式耳環」。這不僅是象徵，更是安全措施，沒有它便不得入內。</p>
      <p>你依指引前往 Goldsmiths’ Guild，公會長 Serendipity 親手將耳環交給你。她特別說明，盒子上了鎖，只有 Momodi 有權打開。你便將耳環帶回，Momodi 親自打開盒子，看著華麗的工藝忍不住倒吸一口氣。</p>
      <p>她鄭重囑咐你務必妥善保管，因為一旦落入歹人之手，後果不堪設想。如今耳環已在你手中，你也整裝待發。下一步，便是踏入 Ul’dah 的權貴之間，成為女王座上真正的座上賓。</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>任務發布</b> 奧懷恩 <small class="muted">（銀冑團總長室, X:6.1, Y:6.0）</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="duty-honor-country.html">責任、榮耀與祖國</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="a-royal-reception.html">皇宮盛宴</a></div>
    </div>`
  }
};

const langToggle  = document.getElementById('langToggle');
const pageTitle   = document.getElementById('pageTitle');
const tabBtns     = [...document.querySelectorAll('.tab-btn')];
const panels = {
  story:  document.getElementById('panel-story'),
  acq:    document.getElementById('panel-acq'),
  unlockq:document.getElementById('panel-unlockq'),
  followq:document.getElementById('panel-followq'),
  comments: document.getElementById('panel-comments')
};

function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }
function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `🌐 ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}

function wireClamp(panelEl, t){
  const clamp = panelEl.querySelector('.clamp');
  const btn = panelEl.querySelector('[data-role="expand"]');
  if(!clamp || !btn) return;
  function setLabel(){
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    btn.textContent = collapsed ? t.readMore : t.readLess;
  }
  setLabel();
  btn.addEventListener('click', ()=>{
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    clamp.setAttribute('data-collapsed', collapsed ? 'false' : 'true');
    setLabel();
  });
}

function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  if (key !== 'comments') panels[key].innerHTML = t[key];
  if (key === 'story') wireClamp(panels[key], t);
  if (key === 'comments') loadGiscusForCurrentLang();
}

tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});

langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem(LANG_KEY, next);
  applyLang(next);
});

applyLang(getLang());

/* === Giscus：Comments 分頁 === */
const GISCUS_CFG = {
  repo: 'belaug-ffxiv/FFXIV_Library',
  repoId: 'R_kgD0Pyh4Kw',
  category: 'General',
  categoryId: 'DIC_kwD0Pyh4K84CwPjL',
  theme: 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  mount.innerHTML = '';
  const langCode = getLang();
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + '｜' + langCode);
  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;
  mount.appendChild(s);
}
</script>
</body>
</html>
