<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Narwhal Beckons | BELAUG · FFXIV Library</title>
  <meta name="description" content="Role Quest – The Narwhal Beckons (DT Patch 7.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:var(--fg);border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}

    /* 展開/收合（統一模板） */
    .clamp{position:relative; max-height:360px; overflow:hidden}
    .clamp[data-collapsed="false"]{max-height:none}
    .clamp[data-collapsed="true"]::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:72px;
      background:linear-gradient(to bottom, rgba(255,255,255,0), var(--card)); pointer-events:none;
    }
    .expand-wrap{ margin-top:12px; }
    .expand-btn{
      display:inline-block; padding:8px 14px; border-radius:10px;
      background:var(--card); border:1px solid var(--border); cursor:pointer; font-weight:600;
    }
    .expand-btn:hover{ background:#fffef8; }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">🏠 Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="切換語言">🌐 EN</button>
      </div>
    </nav>
  </header>
  <main class="container main">
    <div class="grid">
      <!-- 左：影片 -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/61Ga0oTWajs"
              title="The Narwhal Beckons" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- 右：標題 + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">The Narwhal Beckons</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story"   class="tab-panel active"></div>
          <div id="panel-acq"     class="tab-panel"></div>
          <div id="panel-unlockq" class="tab-panel"></div>
          <div id="panel-followq" class="tab-panel"></div>
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const LANG_KEY = 'ffxiv-guide-lang';
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:'The Narwhal Beckons',
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    readMore:'Show more', readLess:'Show less',
    story:`<div class="clamp" data-collapsed="true">
      <p>You meet Loazenikwe at the shore; she greets you politely and, seeing your traveler’s garb, assumes Br’uk Evu has sent you. She thanks the brave narwhal for guiding you safely and explains that her people in northern Xak Tural revere a tural vidraal whose essence rests in the Cradle of the Sleepless — a sacred relic kept in the Cradle that can lay others into deep slumber while sparing its keeper from fatigue. Because such power is dangerous, the village’s greatest warrior, Tentoawa, was sent across the sea to reclaim it. Loazenikwe could not go herself and instead awaited someone to aid him; a letter from Tentoawa arrived just before you did, saying he had chased a thief as far as Ishgard. She asks you to follow him there and find him before he acts rashly.</p>
      <p>You track Tentoawa to the Jeweled Crozier, where the hot-blooded youth argues with nobles and admits frustration: the trail runs cold in Ishgard. He gives you what little description he has — an Elezen woman with red hair, rust-colored eyes, a scar on her forehead and a mole on her lip — and explains she came to his village posing as a scholar, offering food and favours to win trust, yet moving like a predator. You press onward with Tentoawa to the Congregation, where Firmalbert listens, hesitates, then admits the name the description evokes: Leophyne, an expelled knight whose disgrace still haunts the order. He vows to inform his superiors and lend the Congregation’s aid to hunt her down. With a name at last and the Congregation pledged to help, you and Tentoawa prepare to wait for any lead — ready to move at a moment’s notice.</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> Loazenikwe <small class="muted">(Tuliyollal, X:12.9, Y:15.0)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="#">Uncouth Customers</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="#">Sleepless in Ishgard</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'根雪に包まれて',
    tabs:{ story:'ストーリー', acq:'入手方法', unlockq:'開放クエスト', followq:'後続クエスト', comments:'コメント' },
    readMore:'全文を表示', readLess:'折りたたむ',
    story:`<div class="clamp" data-collapsed="true">
      <p>あなたは海辺で Loazenikwe に出会う。旅装のあなたを見て、Br’uk Evu が使いを出したのだと彼女は受け取り、見守り続ける narwhal に感謝の念を示す。彼女の出自は Xak Tural の北方で、村は「Cradle of the Sleepless」にその精を宿すトゥラルのヴィドラールを崇めているという。その聖なる「クレイドル」は他者を深い眠りへと誘い、保持者自身は眠りを必要としない力を持つ。ゆえに危険視され、村の最強の戦士 Tentoawa が海を渡ってそれを取り戻す任を負ったのだ。Loazenikwe は自ら行けなかったが、直前に Tentoawa から手紙が届き、盗人が Ishgard に向かったと知ったため、あなたに彼を追って見つけてほしいと頼む。</p>
      <p>あなたは Jeweled Crozier で Tentoawa を見つける。彼は城内の者たちに手詰まりを嘆き、追跡の糸口が切れていると打ち明ける。彼が伝えられる容貌は、赤髪で錆色の瞳、額の傷と唇のほくろを持つエレゼンの女だ。学者を装って村へ入り込んだその女は、食物や物資で信頼を買いながらも、獲物のような身のこなしを見せたという。あなたは彼と共に聖堂へ赴き、Congregation の Firmalbert に状況を訴える。ためらいの後、彼はその描写が Leophyne という元騎士を思い起こさせると告げる。Leophyne はかつて秩序を汚した者として追放され、その所在は不明だが、Firmalbert は上官に報告し、追跡に協力することを約束する。名が判明し、教団の支援が得られた今、あなたと Tentoawa は手がかりを待ちつつ、いつでも動けるよう身構えるのだった。</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>クエスト発行</b> ローデニケ <small class="muted">（トライヨラ, X:12.9, Y:15.0）</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="#">超常の力、宿りし祭器</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="#">眠らずの勇士</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'白雪的呼喚',
    tabs:{ story:'故事概要', acq:'取得方式', unlockq:'解鎖任務', followq:'後續任務', comments:'留言' },
    readMore:'展開全文', readLess:'收合內容',
    story:`<div class="clamp" data-collapsed="true">
      <p>你在海邊遇見 Loazenikwe；見到你穿著外來旅人的裝束，她便推測 Br’uk Evu 已將你差來。她感謝守護者那頭勇敢的 narwhal 將你平安引導到此，並說明她來自 Xak Tural 北方的部族，族中供奉一隻其精存在於「Cradle of the Sleepless」的海獸。那件聖物能將他人催入深眠，而持有者自身則無需睡眠。這種力量若落入歹人之手，後果不堪設想，因此村中最強的戰士 Tentoawa 承擔起跨海取回聖物的任務。Loazenikwe 無法同行，卻在你到來前收到 Tentoawa 的來信：竊賊已至 Ishgard，她懇請你追往那地尋回他，阻止他做出魯莽之事。</p>
      <p>你在 Jeweled Crozier 找到 Tentoawa。他滿懷焦躁地說線索在 Ishgard 斷了，僅能提供一份膚淺的描述：一位被此地稱為「Elezen」的女子，紅髮、銹色的眼，額頭有一道疤，唇邊有顆痣。她以學者為名接近村人，贈以食物換取信任，行為卻如掠食者，令人警覺。你與 Tentoawa 一同前往 Congregation，Firmalbert 在聆聽後沉吟，最終道出那名字——Leophyne，一名曾被教團逐出的騎士，其所留下的污點至今未能洗清。Firmalbert 承諾將上報並動員教團協力追緝其下落。如今有了名字與教團的承諾，你與 Tentoawa 將在等待進一步線索的同時，保持隨時出動的準備。</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>任務發布</b> Loazenikwe <small class="muted">（Tuliyollal, X:12.9, Y:15.0）</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="#">超常之力的祭器</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="#">伊修加德的守夜人</a></div>
    </div>`
  }
};

const langToggle  = document.getElementById('langToggle');
const pageTitle   = document.getElementById('pageTitle');
const tabBtns     = [...document.querySelectorAll('.tab-btn')];
const panels = {
  story:  document.getElementById('panel-story'),
  acq:    document.getElementById('panel-acq'),
  unlockq:document.getElementById('panel-unlockq'),
  followq:document.getElementById('panel-followq'),
  comments: document.getElementById('panel-comments')
};

function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }
function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `🌐 ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}

function wireClamp(panelEl, t){
  const clamp = panelEl.querySelector('.clamp');
  const btn = panelEl.querySelector('[data-role="expand"]');
  if(!clamp || !btn) return;
  function setLabel(){
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    btn.textContent = collapsed ? t.readMore : t.readLess;
  }
  setLabel();
  btn.addEventListener('click', ()=>{
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    clamp.setAttribute('data-collapsed', collapsed ? 'false' : 'true');
    setLabel();
  });
}

function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  if (key !== 'comments') panels[key].innerHTML = t[key];
  if (key === 'story') wireClamp(panels[key], t);
  if (key === 'comments') loadGiscusForCurrentLang();
}

tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});

langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem(LANG_KEY, next);
  applyLang(next);
});

applyLang(getLang());

/* === Giscus：Comments 分頁 === */
const GISCUS_CFG = {
      repo: 'BELAUG-FFXIV/FFXIV_Library',
      repoId: 'R_kgDOPyh4Kw',
      category: 'General',
      categoryId: 'DIC_kwDOPyh4K84CwPjL',
      theme: 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  mount.innerHTML = '';
  const langCode = getLang();
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + '｜' + langCode);
  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;
  mount.appendChild(s);
}
</script>
</body>
</html>
