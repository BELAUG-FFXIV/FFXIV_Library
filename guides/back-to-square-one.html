<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Back to Square One | BELAUG · FFXIV Library</title>
  <meta name="description" content="MSQ – Back to Square One (ARR Patch 2.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:var(--fg);border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}
    /* 展開/收合 */
    .clamp{position:relative; max-height:360px; overflow:hidden}
    .clamp[data-collapsed="false"]{max-height:none}
    .clamp[data-collapsed="true"]::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:72px;
      background:linear-gradient(to bottom, rgba(255,255,255,0), var(--card)); pointer-events:none;
    }
    .expand-wrap{ margin-top:12px; }
    .expand-btn{
      display:inline-block; padding:8px 14px; border-radius:10px;
      background:var(--card); border:1px solid var(--border); cursor:pointer; font-weight:600;
    }
    .expand-btn:hover{ background:#fffef8; }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">🏠 Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="切換語言">🌐 EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <!-- 左：影片 -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/-lNkrIcnJIo"
              title="Back to Square One" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- 右：標題 + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">Back to Square One</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story"   class="tab-panel active"></div>
          <div id="panel-acq"     class="tab-panel"></div>
          <div id="panel-unlockq" class="tab-panel"></div>
          <div id="panel-followq" class="tab-panel"></div>
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const LANG_KEY = 'ffxiv-guide-lang';
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:'Back to Square One',
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    readMore:'Show more', readLess:'Show less',
    story:`<div class="clamp" data-collapsed="true">
      <p>With Wilred’s confession laid bare, Gundobald laments that they know little more of the masked stranger. The man’s lies have already sown tragedy, and Gundobald prays that you will hunt him down before others fall to his poisoned words. He promises that Little Ala Mhigo will always remain a safe haven for you, and that Wilred, burdened with regret, will strive to live on in remembrance of those lost.</p>
      <p>You return to the Waking Sands, where Minfilia greets you warmly and listens as you recount the events in Little Ala Mhigo. She immediately recognizes the pattern—knowledge of summoning instilled into the young, a manipulation typical of the Ascians. Lahabrea’s hand is evident.</p>
      <p>Minfilia reflects solemnly: while much of Eorzea’s suffering stems from the Calamity, a darker will now moves behind the scenes, twisting despair into chaos. Determined to act while the primal threat remains subdued, she vows to delve deeper into this mystery.</p>
      <p>As the tension lifts, Tataru attempts to lighten the mood, teasing her mistress about overwork. Minfilia pointedly ignores her, though a faint smile betrays her amusement. For now, you are told to rest and recover—before the next truth awaiting beyond the quiet dawn.</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> Gundobald <small class="muted">(Southern Thanalan, X:16.9, Y:14.4)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="big-trouble-in-little-ala-mhigo.html">Big Trouble in Little Ala Mhigo</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="terror-at-fallgourd.html">Terror at Fallgourd</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'束の間の帰還',
    tabs:{ story:'ストーリー', acq:'入手方法', unlockq:'開放クエスト', followq:'後続クエスト', comments:'コメント' },
    readMore:'全文を表示', readLess:'折りたたむ',
    story:`<div class="clamp" data-collapsed="true">
      <p>ウィルレッドの告白を受け、ガンドバルドは仮面の男についてほとんど何も分かっていないと嘆く。その男の偽りの言葉が多くの若者の命を奪った今、彼はあなたに託す──必ずや奴を見つけ出し、再び悲劇が起きぬようその手で止めてほしいと。リトルアラミゴは、いつでもあなたを迎える安らぎの場所であり続けると約束し、ウィルレッドも悔恨を糧に新たな人生を歩むだろうと語る。</p>
      <p>砂の家に戻ると、ミンフィリアがあなたを出迎える。あなたがリトルアラミゴでの出来事を報告すると、彼女はすぐにその手口に思い当たる。若者の心に召喚の知識を植え付ける──それはアシエンが常に用いてきた卑劣な策略、すなわちラハブレアの仕業に違いなかった。</p>
      <p>ミンフィリアは静かに語る。確かに多くの災いは第七霊災によるものだが、その陰にはさらに邪悪な意志が蠢いている。絶望を利用し、混乱を広げようとする何者かの存在を感じ取っていたのだ。原初の脅威が沈静している今こそ、真実を追うべき時だと彼女は決意を新たにする。</p>
      <p>緊張が解けたところで、タタルが軽口を叩き、働きづめの主をからかう。ミンフィリアは聞こえぬふりをしつつも、わずかに微笑みを浮かべるのだった。彼女は言う。「今はしばし休み、次なる調査に備えましょう」と。</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>クエスト発行</b> グンドバルド　南ザナラーン <small class="muted">(X:16.9, Y:14.4)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="big-trouble-in-little-ala-mhigo.html">若き血の暴走</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="terror-at-fallgourd.html">浮き村の怪事件</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'回到起點',
    tabs:{ story:'故事概要', acq:'取得方式', unlockq:'解鎖任務', followq:'後續任務', comments:'留言' },
    readMore:'展開全文', readLess:'收合內容',
    story:`<div class="clamp" data-collapsed="true">
      <p>在 Wilred 坦白一切後，Gundobald 表示他們對那名蒙面男子仍所知有限。那人的謊言已帶來慘劇，他懇請你盡快將其阻止，以免更多生命被毒言蠱惑。他向你保證，Little Ala Mhigo 永遠是你的避風港，而 Wilred 將懷著懊悔與記憶，繼續前行。</p>
      <p>你返回 Waking Sands，Minfilia 熱情迎接，耐心聽完你在 Little Ala Mhigo 的經過。她立刻察覺這是典型的 Ascian 詭計——將召喚的知識灌輸給年輕心靈，以欺騙與毀滅為目的。這正是 Lahabrea 的手段。</p>
      <p>Minfilia 神情嚴肅地說，雖然 Eorzea 的苦難多源於 Calamity，但如今更陰險的意志正在暗處蠢動，將人們的絕望化為混亂。她決定趁原初存在的威脅暫時平息之際，深入調查這股邪惡的力量。</p>
      <p>氣氛稍緩，Tataru 忍不住開玩笑，說「Minfilia 若只是工作而不放鬆，可就變成無趣的 Scion 啦！」被主上瞪了一眼後，她慌忙否認。Minfilia 假裝沒聽見，卻掩不住唇角的微笑。她最後叮囑你先行休息，為接下來的調查整備精神。</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>任務發布</b> 岡多巴德　薩納蘭南部 <small class="muted">(X:16.9, Y:14.4)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="big-trouble-in-little-ala-mhigo.html">失控的理想</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="terror-at-fallgourd.html">漂浮村的怪事</a></div>
    </div>`
  }
};

const langToggle  = document.getElementById('langToggle');
const pageTitle   = document.getElementById('pageTitle');
const tabBtns     = [...document.querySelectorAll('.tab-btn')];
const panels = {
  story:  document.getElementById('panel-story'),
  acq:    document.getElementById('panel-acq'),
  unlockq:document.getElementById('panel-unlockq'),
  followq:document.getElementById('panel-followq'),
  comments: document.getElementById('panel-comments')
};

function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }
function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `🌐 ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}

function wireClamp(panelEl, t){
  const clamp = panelEl.querySelector('.clamp');
  const btn = panelEl.querySelector('[data-role="expand"]');
  if(!clamp || !btn) return;
  function setLabel(){
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    btn.textContent = collapsed ? t.readMore : t.readLess;
  }
  setLabel();
  btn.addEventListener('click', ()=>{
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    clamp.setAttribute('data-collapsed', collapsed ? 'false' : 'true');
    setLabel();
  });
}

function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  if (key !== 'comments') panels[key].innerHTML = t[key];
  if (key === 'story') wireClamp(panels[key], t);
  if (key === 'comments') loadGiscusForCurrentLang();
}

tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});

langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem(LANG_KEY, next);
  applyLang(next);
});

applyLang(getLang());

/* === Giscus：Comments 分頁 === */
const GISCUS_CFG = {
  repo: 'BELAUG-FFXIV/FFXIV_Library',
  repoId: 'R_kgDOPyh4Kw',
  category: 'General',
  categoryId: 'DIC_kwDOPyh4K84CwPjL',
  theme: 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  mount.innerHTML = '';
  const langCode = getLang();
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + '｜' + langCode);
  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;
  mount.appendChild(s);
}
</script>
</body>
</html>
