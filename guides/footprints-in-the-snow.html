<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Footprints in the Snow | BELAUG Â· FFXIV Library</title>
  <meta name="description" content="MSQ â€“ Footprints in the Snow (ARR Patch 2.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:var(--fg);border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}
    .clamp{position:relative; max-height:360px; overflow:hidden}
    .clamp[data-collapsed="false"]{max-height:none}
    .clamp[data-collapsed="true"]::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:72px;
      background:linear-gradient(to bottom, rgba(255,255,255,0), var(--card)); pointer-events:none;
    }
    .expand-wrap{ margin-top:12px; }
    .expand-btn{
      display:inline-block; padding:8px 14px; border-radius:10px;
      background:var(--card); border:1px solid var(--border); cursor:pointer; font-weight:600;
    }
    .expand-btn:hover{ background:#fffef8; }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">ğŸ  Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="åˆ‡æ›èªè¨€">ğŸŒ EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/0Z8UX6u-5J8"
              title="Footprints in the Snow" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="hd" id="pageTitle">Footprints in the Snow</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story"    class="tab-panel active"></div>
          <div id="panel-acq"      class="tab-panel"></div>
          <div id="panel-unlockq"  class="tab-panel"></div>
          <div id="panel-followq"  class="tab-panel"></div>
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const LANG_KEY = 'ffxiv-guide-lang';
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:`Footprints in the Snow`,
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    readMore:'Show more', readLess:'Show less',
    story:`<div class="clamp" data-collapsed="true"><p>Pierremons tells you the airship was carrying prisoners, and when it was forced to land, they seized the chance to run. The Garleans deployed immediately, splitting into search parties to comb the wilderness, and Pierremons returned to his post to raise the alarmâ€”only to find signs that someone had come by while he was gone. Whoever it was tried the door, failed to get in, and moved on. He noted two sets of footprints in the snowâ€”one large, one smallâ€”and urges you to search the area and follow them to their owners.</p><p>Tracking the prints, you find Wedge half-frozen and terrified, convinced heâ€™s about to be eatenâ€”until he spots you and blurts out his relief. He rambles through how the Garleans chased them like hungry wolves, how he nearly ran into monsters more than once, and how the cold and hunger finally caught up with him when he found somewhere to hide. Biggs isnâ€™t with himâ€”he split off in another direction to draw the pursuers away. Before you can decide what to do next, Cid contacts you via linkpearl: youâ€™ve found Wedge, but Biggs is still missing. Cid says heâ€™s searched near the Darkhold without results, yet heâ€™s sure Biggs headed westâ€”and with Yda and Yâ€™shtola helping, he believes theyâ€™ll find him soon. He tells you to meet him at an Ishgardian fortification to the westâ€”Monument Towerâ€”while he heads your way and keeps watch for Biggs. Wedge, shaken but hopeful after hearing Cidâ€™s voice, insists on going with you to wait there.</p><p>At Monument Tower, Abelie greets you and asks what brings you to this frozen corner of the realm. Seeing Wedgeâ€™s condition, she urges you both to warm yourselves by the fire and brings hot broth to chase the chill away. Once Wedge has steadied, she tells you to stay as long as you needâ€”and reminds you, too, that with a hard road ahead, you must take rest whenever you can.</p></div><div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack"><div class="row"><b>Quest Giver</b> Portelaine <small class="muted">(Coerthas Central Highlands, X:14.3, Y:35.2)</small></div></div>`,
    unlockq:`<div class="stack"><div class="row"><a class="link" href="eyes-on-the-empire.html">Eyes on the Empire</a></div><div class="row">All classes and jobs (excluding limited jobs) (Level 44 or above)</div></div>`,
    followq:`<div class="stack"><div class="row"><a class="link" href="monumental-hopes.html">Monumental Hopes</a></div></div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'ãµãŸã‚Šã®è„±èµ°è€…',
    tabs:{ story:'ã‚¹ãƒˆãƒ¼ãƒªãƒ¼', acq:'å…¥æ‰‹æ–¹æ³•', unlockq:'é–‹æ”¾ã‚¯ã‚¨ã‚¹ãƒˆ', followq:'å¾Œç¶šã‚¯ã‚¨ã‚¹ãƒˆ', comments:'ã‚³ãƒ¡ãƒ³ãƒˆ' },
    readMore:'å…¨æ–‡ã‚’è¡¨ç¤º', readLess:'æŠ˜ã‚ŠãŸãŸã‚€',
    story:`<div class="clamp" data-collapsed="true"><p>ãƒ”ã‚¨ãƒ«ãƒ¢ãƒ³ã¯ã€å¸å›½ã®é£›ç©ºè‰‡ã«ã¯æ•è™œãŒä¹—ã£ã¦ã„ãŸã‚‰ã—ãã€ã‚„ã‚€ãªãç€é™¸ã—ãŸéš™ã«é€ƒã’å‡ºã—ãŸè€…ãŒã„ãŸã®ã ã¨ã‚ãªãŸã«èªã‚‹ã€‚å¸å›½å…µã¯æœç´¢éšŠã‚’çµ„ã‚“ã§è’é‡ã‚’æ´—ã„ã€ãƒ”ã‚¨ãƒ«ãƒ¢ãƒ³ã¯å‘³æ–¹ã«çŸ¥ã‚‰ã›ã‚‹ãŸã‚æŒã¡å ´ã¸æˆ»ã£ãŸãŒã€ãã®ä¸åœ¨ã®é–“ã«èª°ã‹ãŒã“ã“ã¸æ¥ãŸç—•è·¡ãŒæ®‹ã£ã¦ã„ãŸã¨ã„ã†ã€‚æ‰‰ã‚’è©¦ã—ãŸã‚‚ã®ã®å…¥ã‚Œãšã€åˆ¥ã®å ´æ‰€ã¸å‘ã‹ã£ãŸã‚‰ã—ã„â€•â€•é›ªã®ä¸Šã«ã¯å¤§ãã„è¶³è·¡ã¨å°ã•ã„è¶³è·¡ã€äºŒçµ„ãŒã¯ã£ãã‚Šæ®‹ã£ã¦ã„ãŸã€‚ã‚ãªãŸã¯å‘¨å›²ã‚’æ¢ã—ã€ãã®è¶³è·¡ã‚’è¾¿ã£ã¦æŒã¡ä¸»ã‚’è¦‹ã¤ã‘ã¦ã»ã—ã„ã¨é ¼ã¾ã‚Œã‚‹ã€‚</p><p>è¶³è·¡ã‚’è¿½ã£ãŸå…ˆã§ã€ã‚ãªãŸã¯å‡ãˆãã£ãŸã‚¦ã‚§ãƒƒã‚¸ã‚’è¦‹ã¤ã‘ã‚‹ã€‚æ€¯ãˆãã£ãŸå½¼ã¯å¿…æ­»ã«é€ƒã’å›ã£ãŸé¡›æœ«ã‚’ã¾ãã—ãŸã¦ã€å¸å›½å…µã«è¿½ã„ç«‹ã¦ã‚‰ã‚Œã€é­”ç‰©ã«ä½•åº¦ã‚‚é­é‡ã—ã‹ã‘ã€ã‚ˆã†ã‚„ãèº«ã‚’éš ã—ãŸé€”ç«¯ã«å¯’ã•ã¨ç©ºè…¹ãŒèº«ã«æŸ“ã¿ãŸã®ã ã¨è¨´ãˆã‚‹ã€‚ãƒ“ãƒƒã‚°ã‚¹ã¯å›®ã«ãªã‚‹ãŸã‚åˆ¥æ–¹å‘ã¸å‘ã‹ã£ãŸã¨ã„ã†ã€‚ãã“ã¸ãƒªãƒ³ã‚¯ãƒ‘ãƒ¼ãƒ«è¶Šã—ã«ã‚·ãƒ‰ãŒé€£çµ¡ã—ã¦ãã‚‹ã€‚ã‚¦ã‚§ãƒƒã‚¸ã‚’è¦‹ã¤ã‘ãŸã®ã¯æœ—å ±ã ãŒã€ãƒ“ãƒƒã‚°ã‚¹ã¯ã¾ã ã â€•â€•ã‚¼ãƒ¼ãƒ¡ãƒ«è¦å¡å‘¨è¾ºã‚‚æˆæœã¯ãªãã€ãã‚Œã§ã‚‚å½¼ãŒè¥¿ã¸å‘ã‹ã£ãŸã®ã¯ç¢ºã‹ã§ã€ã‚¤ãƒ€ã¨ãƒ¤ãƒ»ã‚·ãƒ¥ãƒˆãƒ©ã‚‚å‹•ã„ã¦ã„ã‚‹ä»¥ä¸Šã€ã»ã©ãªãè¦‹ã¤ã‹ã‚‹ã¯ãšã ã¨ã‚·ãƒ‰ã¯è¨€ã†ã€‚ãã—ã¦ã‚ãªãŸã®è¥¿ã«ã‚ã‚‹ã‚¤ã‚·ãƒ¥ã‚¬ãƒ«ãƒ‰ã®é˜²å¡ã€Œç§˜çŸ³ã®å¡”ã€ã§åˆæµã—ã‚ˆã†ã¨å‘Šã’ã€ã‚ãªãŸã®ã‚‚ã¨ã¸å‘ã‹ã„ãªãŒã‚‰ãƒ“ãƒƒã‚°ã‚¹ã‚’æœã™ã¨ç´„æŸã™ã‚‹ã€‚ã‚¦ã‚§ãƒƒã‚¸ã¯ã‚·ãƒ‰ã®ç„¡äº‹ã‚’çŸ¥ã£ã¦æ³£ããã†ã«ãªã‚ŠãªãŒã‚‰ã‚‚é¡”è‰²ã‚’å–ã‚Šæˆ»ã—ã€ã‚ãªãŸã¨å…±ã«ã€Œç§˜çŸ³ã®å¡”ã€ã¸å‘ã‹ã†æ±ºæ„ã‚’å›ºã‚ã‚‹ã€‚</p><p>ç§˜çŸ³ã®å¡”ã«è¾¿ã‚Šç€ãã¨ã€ã‚¢ãƒ™ãƒªãŒã‚ãªãŸã‚’è¿ãˆã€ã“ã®å‡ã¦ã¤ãè¾ºå¢ƒã«ä½•ã®ç”¨ã§æ¥ãŸã®ã‹ã¨å°‹ã­ã‚‹ã€‚é€£ã‚Œã®ã‚¦ã‚§ãƒƒã‚¸ãŒã²ã©ãå†·ãˆã¦ã„ã‚‹ã®ã‚’è¦‹ã‚‹ã¨ã€å½¼å¥³ã¯ç«ã®ãã°ã¸æ¡ˆå†…ã—ã€æ¸©ã‹ã„æ±ç‰©ã‚’ç”¨æ„ã—ã¦èº«ä½“ã‚’æ¸©ã‚ã•ã›ã¦ãã‚Œã‚‹ã€‚å°‘ã—è½ã¡ç€ã„ãŸã¨ã“ã‚ã§ã€å¿…è¦ãªã ã‘ã“ã“ã«ç•™ã¾ã£ã¦ã‚ˆã„ã¨è¨€ã„ã€ã‚ãªãŸã«ã‚‚ã€ã“ã‚Œã‹ã‚‰å…ˆã®æ—…ãŒå³ã—ã„ã®ã¯æ˜ã‚‰ã‹ã ã‹ã‚‰ã“ãã€ä¼‘ã‚ã‚‹æ™‚ã«ä¼‘ã‚€ã‚ˆã†é™ã‹ã«å¿µã‚’æŠ¼ã™ã€‚</p></div><div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack"><div class="row"><b>ã‚¯ã‚¨ã‚¹ãƒˆç™ºè¡Œ</b> ãƒãƒ«ãƒˆã‚¥ãƒ¬ãƒ¼ãƒ³ <small class="muted">ï¼ˆã‚¯ãƒ«ã‚¶ã‚¹ä¸­å¤®é«˜åœ°, ï¼¸:14.3, ï¼¹:35.2ï¼‰</small></div></div>`,
    unlockq:`<div class="stack"><div class="row"><a class="link" href="eyes-on-the-empire.html">å¸å›½ã‚’è¦‹å¼µã‚‹ç›®</a></div><div class="row">ã™ã¹ã¦ï¼ˆãƒªãƒŸãƒ†ãƒƒãƒ‰ã‚¸ãƒ§ãƒ–ã‚’é™¤ãï¼‰ï¼¬ï½–ï¼”ï¼”ï½</div></div>`,
    followq:`<div class="stack"><div class="row"><a class="link" href="monumental-hopes.html">ãƒ“ãƒƒã‚°ã‚¹ã®æœç´¢</a></div></div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'é›ªåœ°è¶³è·¡',
    tabs:{ story:'æ•…äº‹æ¦‚è¦', acq:'å–å¾—æ–¹å¼', unlockq:'è§£é–ä»»å‹™', followq:'å¾ŒçºŒä»»å‹™', comments:'ç•™è¨€' },
    readMore:'å±•é–‹å…¨æ–‡', readLess:'æ”¶åˆå…§å®¹',
    story:`<div class="clamp" data-collapsed="true"><p>Pierremons å‘Šè¨´ä½ ï¼Œé‚£è‰˜å¸åœ‹é£›ç©ºè‰‡ä¸Šä¼¼ä¹è¼‰è‘—å›šçŠ¯ï¼›é£›ç©ºè‰‡è¢«è¿«ç·Šæ€¥é™è½æ™‚ï¼Œä»–å€‘å°±æŠ“æº–æ©Ÿæœƒé€ƒäº†å‡ºå»ã€‚å¸åœ‹è»éš¨å³è¢«æ´¾ä¸‹ä¾†ï¼Œåˆ†æˆå¤šæ”¯æœç´¢éšŠåœ¨è’é‡è£¡åœ°æ¯¯å¼æœæ•ï¼Œè€Œ Pierremons ç‚ºäº†é€šå ±å·±æ–¹éƒ¨éšŠè¶•å›å´—ä½â€”â€”å»ç™¼ç¾è‡ªå·±é›¢é–‹çš„é€™æ®µæ™‚é–“ï¼Œæœ‰äººä¾†éã€‚å°æ–¹è©¦éé–€å»é€²ä¸å»ï¼Œåªèƒ½è½‰å¾€åˆ¥è™•ï¼›é›ªåœ°è£¡æ¸…æ¥šç•™ä¸‹å…©çµ„è¶³è·¡ï¼Œä¸€å¤§ä¸€å°ã€‚Pierremons è¦ä½ åœ¨é™„è¿‘æœå°‹ï¼Œæ²¿è‘—è¶³è·¡è¿½ä¸Šå®ƒå€‘çš„ä¸»äººã€‚</p><p>ä½ å¾ªè‘—è¶³è·¡ä¸€è·¯æ‰¾å»ï¼Œçµ‚æ–¼åœ¨æ©‹ä¸‹ç™¼ç¾å†·åˆ°ç™¼æŠ–çš„ Wedgeã€‚ä»–å…ˆæ˜¯åš‡å¾—å¤§å–Šæ±‚é¥’ï¼Œä¸‹ä¸€ç§’èªå‡ºä½ å°±åƒæŠ“åˆ°æ•‘å‘½ç¹©èˆ¬å´©æ½°åœ°å‚¾è¨´â€”â€”å¸åœ‹è»ä¸€è·¯ç·Šå’¬ä¸æ”¾ï¼Œåƒé¤“ç‹¼ç¾¤è¿½è‘—ä»–å€‘è·‘ï¼›ä»–æ‹¼å‘½é–ƒèº²è¿½å…µï¼Œé‚„å·®é»ä¸‰åº¦æ’é€²é­”ç‰©å¼µé–‹çš„å¤§å£ï¼Œç­‰å¥½ä¸å®¹æ˜“èº²èµ·ä¾†ï¼Œæ‰ç™¼ç¾è‡ªå·±åˆå†·åˆé¤“å¾—å¹¾ä¹ç«™ä¸ç©©ã€‚Biggs æ²’è·Ÿä»–åœ¨ä¸€èµ·ï¼Œç‚ºäº†æŠŠè¿½å…µå¼•é–‹ï¼Œé¸äº†å¦ä¸€å€‹æ–¹å‘é›¢é–‹ã€‚å°±åœ¨ä½ å£“ä¸‹ç„¦æ€¥æ€ç·’æ™‚ï¼ŒCid é€é linkpearl è¯çµ¡ä¸Šä½ ï¼šæ‰¾åˆ° Wedge æ˜¯å¥½æ¶ˆæ¯ï¼Œä½† Biggs ä»ä¸‹è½ä¸æ˜ã€‚Cid èªªä»–å·²åœ¨ Dzemael Darkhold å‘¨é‚Šæœå°‹éå»æ²’æœ‰æ”¶ç©«ï¼Œä¸éå¯ä»¥ç¢ºå®š Biggs å¾€è¥¿é‚Šå»äº†ï¼›å†åŠ ä¸Š Yda èˆ‡ Yâ€™shtola ä¹Ÿåœ¨å”åŠ©ï¼Œä»–ç›¸ä¿¡å¾ˆå¿«å°±æœƒæœ‰çµæœã€‚Cid è¦ä½ åˆ°è¥¿é‚Šä¸é è™•çš„ Ishgard é˜²ç¦¦æ“šé» Monument Tower æœƒåˆï¼Œä»–ä¹Ÿæœƒä¸€é‚Šè¶•ä¾†ã€ä¸€é‚Šç•™å¿ƒæ‰¾å°‹ Biggsã€‚è½è¦‹ Cid çš„è²éŸ³ï¼ŒWedge åƒæ˜¯çµ‚æ–¼èƒ½å–˜å£æ°£ï¼ŒæŠ¹è‘—çœ¼æ·šèªªè‡ªå·±å¥½å¤šäº†ï¼Œå …æŒè·Ÿä½ ä¸€èµ·å» Monument Tower ç­‰ä»–ã€‚</p><p>ä¾†åˆ° Monument Towerï¼ŒAbelie è¿ä¸Šå‰ä¾†ï¼Œå•ä½ ç‚ºä½•æœƒåˆ°é€™ç‰‡å†°å¯’çš„è§’è½ã€‚å¥¹ä¸€çœ¼çœ‹å‡º Wedge å—äº†å¯’ï¼Œç«‹åˆ»æŠŠä½ å€‘å¸¶åˆ°ç«é‚Šå–æš–ï¼Œé‚„ç«¯ä¾†ç†±æ¹¯è®“ä»–å›æš–ã€‚ç­‰ Wedge çš„ç‹€æ³ç¨ç¨ç©©ä½ï¼Œå¥¹è¦ä½ å€‘éœ€è¦å¤šä¹…å°±å¾…å¤šä¹…ï¼›è€Œçœ‹è‘—ä½ ï¼Œå¥¹ä¹Ÿèªæ°£å¹³éœå»å¾ˆç¯¤å®šåœ°æé†’â€”â€”å‰æ–¹çš„è·¯é¡¯ç„¶ä¸æœƒè¼•é¬†ï¼Œä½ å¿…é ˆåœ¨èƒ½ä¼‘æ¯çš„æ™‚å€™å°±å¥½å¥½ä¼‘æ¯ã€‚</p></div><div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack"><div class="row"><b>Quest Giver</b> Portelaine <small class="muted">(Coerthas Central Highlands, X:14.3, Y:35.2)</small></div></div>`,
    unlockq:`<div class="stack"><div class="row"><a class="link" href="eyes-on-the-empire.html">æ³¨è¦–å¸åœ‹å‹•å‘</a></div><div class="row">æ‰€æœ‰è·æ¥­ï¼ˆä¸å«é™å®šè·ï¼‰ç­‰ç´š 44 ä»¥ä¸Š</div></div>`,
    followq:`<div class="stack"><div class="row"><a class="link" href="monumental-hopes.html">å°‹æ‰¾ Biggs</a></div></div>`
  }
};

const langToggle  = document.getElementById('langToggle');
const pageTitle   = document.getElementById('pageTitle');
const tabBtns     = [...document.querySelectorAll('.tab-btn')];
const panels = {
  story:  document.getElementById('panel-story'),
  acq:    document.getElementById('panel-acq'),
  unlockq:document.getElementById('panel-unlockq'),
  followq:document.getElementById('panel-followq'),
  comments: document.getElementById('panel-comments')
};

function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }
function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle.replace(/&#39;/g,"'");
  langToggle.textContent = `ğŸŒ ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}

function wireClamp(panelEl, t){
  const clamp = panelEl.querySelector('.clamp');
  const btn = panelEl.querySelector('[data-role="expand"]');
  if(!clamp || !btn) return;
  function setLabel(){
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    btn.textContent = collapsed ? t.readMore : t.readLess;
  }
  setLabel();
  btn.addEventListener('click', ()=>{
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    clamp.setAttribute('data-collapsed', collapsed ? 'false' : 'true');
    setLabel();
  });
}

function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  if (key !== 'comments') panels[key].innerHTML = t[key];
  if (key === 'story') wireClamp(panels[key], t);
  if (key === 'comments') loadGiscusForCurrentLang();
}

tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});

langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem(LANG_KEY, next);
  applyLang(next);
});

applyLang(getLang());

const GISCUS_CFG = {
      repo: 'BELAUG-FFXIV/FFXIV_Library',
      repoId: 'R_kgDOPyh4Kw',
      category: 'General',
      categoryId: 'DIC_kwDOPyh4K84CwPjL',
      theme: 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  mount.innerHTML = '';
  const langCode = getLang();
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + 'ï½œ' + langCode);
  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;
  mount.appendChild(s);
}
</script>
</body>
</html>
