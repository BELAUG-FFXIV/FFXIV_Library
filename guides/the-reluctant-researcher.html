<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Reluctant Researcher | BELAUG Â· FFXIV Library</title>
  <meta name="description" content="MSQ â€“ The Reluctant Researcher (ARR Patch 2.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:var(--fg);border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}
    .clamp{position:relative; max-height:360px; overflow:hidden}
    .clamp[data-collapsed="false"]{max-height:none}
    .clamp[data-collapsed="true"]::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:72px;
      background:linear-gradient(to bottom, rgba(255,255,255,0), var(--card)); pointer-events:none;
    }
    .expand-wrap{ margin-top:12px; }
    .expand-btn{
      display:inline-block; padding:8px 14px; border-radius:10px;
      background:var(--card); border:1px solid var(--border); cursor:pointer; font-weight:600;
    }
    .expand-btn:hover{ background:#fffef8; }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">ğŸ  Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="åˆ‡æ›èªè¨€">ğŸŒ EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <!-- å·¦ï¼šå½±ç‰‡ -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/Y4ikm7E7ik8"
              title="The Reluctant Researcher" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- å³ï¼šæ¨™é¡Œ + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">The Reluctant Researcher</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story"   class="tab-panel active"></div>
          <div id="panel-acq"     class="tab-panel"></div>
          <div id="panel-unlockq" class="tab-panel"></div>
          <div id="panel-followq" class="tab-panel"></div>
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:'The Reluctant Researcher',
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    readMore:'Show more', readLess:'Show less',
    story:`<div class="clamp" data-collapsed="true">
      <p>Ceana lets out a long sigh and finally relents. She says she still canâ€™t see why you insist on dragging her along, but if you wonâ€™t take no for an answer, she will go with you.</p>
      <p>Then she swears by the Twelve that if you leave her behind to be devoured by some horrid abomination, she will come back to haunt you.</p>
      <p>At the docks in Aleport, you ask the ferry skipper to take you to the Isles of Umbra. He laughs at the ideaâ€”until he notices you have a writ of passage, and tells you to climb aboard.</p>
      <p>When you arrive at the docks, Ceana stares out at the place and tries to convince herself it isnâ€™t so bad. A heartbeat later, she gives up entirely, shoves an old pot into your hands, and tells you to go on without her.</p>
      <p>She reminds you that youâ€™ve harvested corrupted crystals before, so you donâ€™t need her help. If you speak to the man guarding the gate, she is sure he will let you inâ€”then she asks to be excused, eager to put distance between herself and the isles.</p>
      <p>When you return, Ceana immediately rounds on you, furious that you abandoned her after she explicitly told you not to. Even so, when you ask her to accompany you again, she sighs and agreesâ€”making it clear she wonâ€™t forget what you did.</p>
      <p>Back at the dock, you ask the ferry skipper to take you to the Isles of Umbra again. He scoffs as if no one in their right mind would ever want toâ€”but seeing you are serious, he tells you to climb aboard.</p>
      <p>Near Pharos Sirius, Davyd stops you and asks how you managed to come here at all, since access to the island is currently restricted.</p>
      <p>When you present the old pot and explain you came to harvest a corrupted crystal, Davyd hesitates, then apologizes. He says you may have to return empty-handed.</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> Ceana <small class="muted">Western La Noscea (X:27.9, Y:27.0)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="representing-the-representative.html">Representing the Representative</a></div>
      <div class="row">All classes and jobs (excluding limited jobs) (Level 42 or above)</div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="sweet-somethings.html">Sweet Somethings</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'å³¶ã«ä¹—ã‚Šã“ã‚ï¼',
    tabs:{ story:'ã‚¹ãƒˆãƒ¼ãƒªãƒ¼', acq:'å…¥æ‰‹æ–¹æ³•', unlockq:'é–‹æ”¾ã‚¯ã‚¨ã‚¹ãƒˆ', followq:'å¾Œç¶šã‚¯ã‚¨ã‚¹ãƒˆ', comments:'ã‚³ãƒ¡ãƒ³ãƒˆ' },
    readMore:'å…¨æ–‡ã‚’è¡¨ç¤º', readLess:'æŠ˜ã‚ŠãŸãŸã‚€',
    story:`<div class="clamp" data-collapsed="true">
      <p>ã‚·ã‚¢ãƒ¼ãƒŠã¯å¤§ãããŸã‚æ¯ã‚’ã¤ãã€ã¤ã„ã«æŠ˜ã‚Œã‚‹ã€‚ãªãœã‚ãªãŸã®æ—…ã«åŒè¡Œã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã®ã‹ç†è§£ã§ããªã„ã¨è¨€ã„ãªãŒã‚‰ã‚‚ã€ãã“ã¾ã§è¨€ã†ã®ãªã‚‰è‡ªåˆ†ã‚‚è¡Œãã¨å‘Šã’ãŸã€‚</p>
      <p>ãã—ã¦åäºŒç¥ã«èª“ã„ã€ã‚‚ã—ã‚ãªãŸãŒè‡ªåˆ†ã‚’ç½®ãå»ã‚Šã«ã—ã¦ã€æã‚ã—ã„æ€ªç‰©ã«å–°ã‚ã‚Œã‚‹ã‚ˆã†ãªã“ã¨ãŒã‚ã‚Œã°ã€å¿…ãšåŒ–ã‘ã¦å‡ºã‚‹ã¨è„…ã™ã€‚</p>
      <p>ã‚¨ãƒ¼ãƒ«ãƒãƒ¼ãƒˆã®èˆ¹ç€å ´ã§ã€ã‚ãªãŸãŒå¹»å½±è«¸å³¶ã¸é€£ã‚Œã¦è¡Œã‘ã¨é ¼ã‚€ã¨ã€èˆ¹é ­ã¯é¼»ã§ç¬‘ã†ã€‚ã ãŒæ¸¡èˆªè¨±å¯è¨¼ã‚’æŒã£ã¦ã„ã‚‹ã¨è¦‹ã‚‹ã‚„æ…‹åº¦ã‚’æ”¹ã‚ã€ä¹—ã‚Šè¾¼ã‚ã¨è¨€ã£ãŸã€‚</p>
      <p>å¹»å½±è«¸å³¶ã®èˆ¹ç€å ´ã«ç€ãã¨ã€ã‚·ã‚¢ãƒ¼ãƒŠã¯éœ‡ãˆãªãŒã‚‰ã‚‚ã€æ€ã£ãŸã»ã©ã§ã¯ãªã„ã¨è¨€ã„ã‹ã‘ã‚‹ã€‚ã‘ã‚Œã©ã™ãã«æŠ•ã’ã‚„ã‚Šã«ãªã‚Šã€å¤ã„å£ºã‚’ã‚ãªãŸã«æŠ¼ã—ã¤ã‘ã¦ã€ã‚‚ã†è‡ªåˆ†æŠœãã§é€²ã‚ã¨çªãæ”¾ã—ãŸã€‚</p>
      <p>ã‚ãªãŸã¯ä»¥å‰ã«ã‚‚æ±šæŸ“ã•ã‚ŒãŸã‚¯ãƒªã‚¹ã‚¿ãƒ«ã‚’æ¡å–ã—ãŸã“ã¨ãŒã‚ã‚‹ã®ã ã‚ã†ã€ã¨å½¼å¥³ã¯è¨€ã†ã€‚ã ã‹ã‚‰è‡ªåˆ†ã®åŠ©ã‘ã¯è¦ã‚‰ãªã„ã¯ãšã ã€é–€ã‚’å®ˆã‚‹ç”·ã«è©±ã›ã°ä¸­ã¸å…¥ã‚Œã¦ãã‚Œã‚‹ã ã‚ã†â€•â€•ãã†è¨€ã„æ®‹ã—ã€å½¼å¥³ã¯å¸­ã‚’å¤–ã—ãŸãŒã£ãŸã€‚</p>
      <p>ã‚ãªãŸãŒæˆ»ã‚‹ã¨ã€ã‚·ã‚¢ãƒ¼ãƒŠã¯ã™ãã•ã¾ã‚ãªãŸã‚’è²¬ã‚ç«‹ã¦ã‚‹ã€‚ç½®ãå»ã‚Šã«ã™ã‚‹ãªã¨è¨€ã£ãŸã®ã«æ¨ã¦ãŸã€ã¨æ€’é³´ã‚Šã€ã•ã‚‰ã«ã‚‚ã†ä¸€åº¦åŒè¡Œã—ã‚ã¨è¨€ã†ã‚ãªãŸã®åšã‹ã¾ã—ã•ã«å‘†ã‚ŒãªãŒã‚‰ã‚‚ã€ãŸã‚æ¯ã‚’ã¤ã„ã¦æ‰¿è«¾ã—ãŸã€‚</p>
      <p>å†ã³èˆ¹ç€å ´ã§ã‚ãªãŸãŒå¹»å½±è«¸å³¶ã¸é€£ã‚Œã¦è¡Œã‘ã¨é ¼ã‚€ã¨ã€èˆ¹é ­ã¯ã¾ãŸã‚‚ã‚„å†—è«‡ã ã‚ã†ã¨ç¬‘ã„ã‹ã‘ã‚‹ã€‚ã ãŒã‚ãªãŸãŒæœ¬æ°—ã ã¨ã‚ã‹ã‚‹ã¨ã€ä»•æ–¹ãªã„ã¨ã°ã‹ã‚Šã«ä¹—ã‚Šè¾¼ã‚ã¨è¨€ã£ãŸã€‚</p>
      <p>ã‚·ãƒªã‚¦ã‚¹å¤§ç¯å°ã®è¿‘ãã§ã€ãƒ€ãƒ´ã‚£ãƒƒãƒ‰ãŒã‚ãªãŸã‚’å‘¼ã³æ­¢ã‚ã‚‹ã€‚ã“ã“ã¯ç¾åœ¨ç«‹å…¥ãŒåˆ¶é™ã•ã‚Œã¦ã„ã‚‹ã®ã«ã€ã©ã†ã‚„ã£ã¦æ¥ãŸã®ã‹ã¨å•ã„ãŸã ã—ãŸã€‚</p>
      <p>ã‚ãªãŸãŒå¤ã„å£ºã‚’ç¤ºã—ã€æ±šæŸ“ã•ã‚ŒãŸã‚¯ãƒªã‚¹ã‚¿ãƒ«ã‚’æ¡å–ã—ã«æ¥ãŸã®ã ã¨ä¼ãˆã‚‹ã¨ã€ãƒ€ãƒ´ã‚£ãƒƒãƒ‰ã¯é¦–ã‚’ã‹ã—ã’ã¦ã‹ã‚‰äº‹æƒ…ã‚’å¯Ÿã™ã‚‹ã€‚ã ãŒç”³ã—è¨³ãªã•ãã†ã«ã€æ‰‹ã¶ã‚‰ã§æˆ»ã‚‹ã“ã¨ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã¨è¨€ã£ãŸã€‚</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>ã‚¯ã‚¨ã‚¹ãƒˆç™ºè¡Œ</b> ã‚·ã‚¢ãƒ¼ãƒŠã€€<small class="muted">ãƒ©ãƒã‚·ã‚¢ï¼šè¥¿ãƒ©ãƒã‚·ã‚¢ (X:27.9, Y:27.0)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="representing-the-representative.html">å¹»å½±è«¸å³¶å¥‡è«‡</a></div>
      <div class="row">ã™ã¹ã¦ï¼ˆãƒªãƒŸãƒ†ãƒƒãƒ‰ã‚¸ãƒ§ãƒ–ã‚’é™¤ãï¼‰Lv 42ï½</div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="sweet-somethings.html">æ³¢é–“ã‚ˆã‚Šã„ãšã‚‹è€…</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'ä¸æƒ…é¡˜çš„ç ”ç©¶å“¡ï¼Œä¹Ÿå¾—ç™»å³¶å‡ºç™¼',
    tabs:{ story:'æ•…äº‹æ¦‚è¦', acq:'å–å¾—æ–¹å¼', unlockq:'è§£é–ä»»å‹™', followq:'å¾ŒçºŒä»»å‹™', comments:'ç•™è¨€' },
    readMore:'å±•é–‹å…¨æ–‡', readLess:'æ”¶åˆå…§å®¹',
    story:`<div class="clamp" data-collapsed="true">
      <p>Ceana é•·å˜†ä¸€å£æ°£ï¼Œçµ‚æ–¼é»é ­ç­”æ‡‰ã€‚å¥¹ä»ç„¶ä¸æ˜ç™½ä½ ç‚ºä½•éå¾—æŠŠå¥¹æ‹–ä¸Šé€™è¶Ÿæ—…ç¨‹ï¼Œä½†æ—¢ç„¶ä½ å …æŒï¼Œå¥¹ä¹Ÿåªèƒ½è·Ÿè‘—ä¸€èµ·èµ°ã€‚</p>
      <p>å¥¹æ¥è‘—ä»¥åäºŒç¥ä½œè­‰ï¼Œè­¦å‘Šä½ ï¼šè¦æ˜¯ä½ æŠŠå¥¹ä¸Ÿåœ¨æŸè™•ï¼Œå®³å¥¹è¢«å¯æ€•çš„æ€ªç‰©åå™¬â€”â€”å¥¹ä¸€å®šæœƒå›ä¾†çºè‘—ä½ ã€‚</p>
      <p>åœ¨ Aleport çš„ç¢¼é ­ï¼Œä½ è«‹èˆ¹é ­å¸¶ä½ å‰å¾€ Isles of Umbraã€‚èˆ¹é ­å…ˆæ˜¯å¤§ç¬‘ï¼Œå½·å½¿é€™è¦æ±‚è’å”å¾—ä¸èƒ½å†è’å”ï¼Œä½†ç•¶ä»–çœ‹è¦‹ä½ æ‰‹ä¸Šçš„æ¸¡èˆªè¨±å¯è­‰ï¼Œä¾¿æ”¹å£è¦ä½ ä¸Šèˆ¹ã€‚</p>
      <p>æŠµé” Isles of Umbra çš„ç¢¼é ­å¾Œï¼ŒCeana æœ›è‘—å››å‘¨ï¼Œçµçµå·´å·´åœ°èªªé€™è£¡ä¼¼ä¹ä¹Ÿæ²’é‚£éº¼ç³Ÿã€‚å¯ä¸‹ä¸€ç¬é–“ï¼Œå¥¹ä¹¾è„†æ”¾æ£„é€å¼·ï¼ŒæŠŠä¸€åªèˆŠå£ºå¡é€²ä½ æ‰‹è£¡ï¼Œè¦ä½ è‡ªå·±ç¹¼çºŒå¾€å‰èµ°ã€‚</p>
      <p>å¥¹æé†’ä½ ä»¥å‰ä¹Ÿæ¡é›†éè¢«æ±¡æŸ“çš„æ°´æ™¶ï¼Œæ‰€ä»¥æ ¹æœ¬ä¸éœ€è¦å¥¹çš„å”åŠ©ã€‚ä½ åªè¦å»æ‰¾å®ˆåœ¨å¤§é–€å£çš„ç”·äººèªªä¸€è²â€”â€”å¥¹ç›¸ä¿¡å°æ–¹æœƒæ”¾ä½ é€²å»â€”â€”æ¥è‘—å¥¹ä¾¿æ€¥è‘—å‘Šè¾­ï¼Œåªæƒ³é›¢é€™åº§å³¶é ä¸€é»ã€‚</p>
      <p>ç­‰ä½ å›åˆ° Aleportï¼ŒCeana ç«‹åˆ»æ°£æ€¥æ•—å£åœ°ç½µä½ ï¼Œèªªå¥¹æ˜æ˜å†ä¸‰äº¤ä»£ä¸è¦æŠŠå¥¹ä¸Ÿä¸‹ï¼Œä½ å»é‚„æ˜¯åšäº†ã€‚å¯ç•¶ä½ åˆè¦æ±‚å¥¹å†æ¬¡é™ªåŒæ™‚ï¼Œå¥¹åªèƒ½ç„¡å¥ˆå˜†æ°£ï¼Œç­”æ‡‰å†èµ°ä¸€è¶Ÿï¼ŒåŒæ™‚å¼·èª¿å¥¹çµ•ä¸æœƒå¿˜è¨˜é€™ç­†å¸³ã€‚</p>
      <p>å›åˆ°ç¢¼é ­ï¼Œä½ å†æ¬¡è«‹èˆ¹é ­å¸¶ä½ å‰å¾€ Isles of Umbraã€‚èˆ¹é ­åˆæ˜¯ä¸€é™£å˜²ç¬‘ï¼Œå½·å½¿æ²’äººæœƒæƒ³å›åˆ°é‚£ç¨®åœ°æ–¹ï¼Œä½†çœ‹å‡ºä½ æ˜¯èªçœŸçš„ï¼Œä»–ä¾¿è¦ä½ ä¸Šèˆ¹ã€‚</p>
      <p>åœ¨ Pharos Sirius é™„è¿‘ï¼ŒDavyd æŠŠä½ æ””ä¸‹ï¼Œå›°æƒ‘åœ°å•ä½ æ˜¯æ€éº¼ä¾†åˆ°é€™è£¡çš„ï¼Œå› ç‚ºé€™åº§å³¶ç›®å‰å·²è¢«é™åˆ¶é€²å…¥ã€‚</p>
      <p>ä½ æ‹¿å‡ºé‚£åªèˆŠå£ºï¼Œè§£é‡‹è‡ªå·±æ˜¯ç‚ºäº†æ¡é›†è¢«æ±¡æŸ“çš„æ°´æ™¶è€Œä¾†ã€‚Davyd ä¸€æ™‚æ²’è½æ‡‚ï¼Œéš¨å¾Œæ‰æç„¶å¤§æ‚Ÿï¼Œå»ä¹Ÿåªèƒ½æ­‰ç„¶è¡¨ç¤ºï¼šä½ ææ€•å¾—ç©ºæ‰‹è€Œå›ã€‚</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>ä»»å‹™ç™¼å¸ƒ</b> è¥¿è‰¾å¨œã€€<small class="muted">æ‹‰è«¾è¥¿äº - è¥¿æ‹‰è«¾è¥¿äº (X:27.9, Y:27.0)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="representing-the-representative.html">è¸å…¥å¹»å½±è«¸å³¶</a></div>
      <div class="row">æ‰€æœ‰è·æ¥­ï¼ˆä¸å«é™å®šè·ï¼‰ ç­‰ç´š 42 ä»¥ä¸Š</div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="sweet-somethings.html">ä½ˆä¸‹ç”œèœœé™·é˜±ï¼Œèª°è‡ªæµªé–“ç¾èº«</a></div>
    </div>`
  }
};

const tabBtns = [...document.querySelectorAll('.tab-btn')];
const pageTitle = document.getElementById('pageTitle');
const langToggle = document.getElementById('langToggle');
const panels = {
  story: document.getElementById('panel-story'),
  acq: document.getElementById('panel-acq'),
  unlockq: document.getElementById('panel-unlockq'),
  followq: document.getElementById('panel-followq'),
  comments: document.getElementById('panel-comments')
};

function getLang(){ return localStorage.getItem('ffxiv-guide-lang') || 'EN'; }

function wireClamp(panelEl, t){
  const clamp = panelEl.querySelector('.clamp');
  const btn = panelEl.querySelector('[data-role="expand"]');
  if(!clamp || !btn) return;
  function setLabel(){
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    btn.textContent = collapsed ? t.readMore : t.readLess;
  }
  setLabel();
  btn.addEventListener('click', ()=>{
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    clamp.setAttribute('data-collapsed', collapsed ? 'false' : 'true');
    setLabel();
  });
}

function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  if (key !== 'comments') panels[key].innerHTML = t[key];
  if (key === 'story') wireClamp(panels[key], t);
  if (key === 'comments') loadGiscusForCurrentLang();
}

function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `ğŸŒ ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}

tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});

langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem('ffxiv-guide-lang', next);
  applyLang(next);
});

applyLang(getLang());

const GISCUS_CFG = {
  repo: 'BELAUG-FFXIV/FFXIV_Library',
  repoId: 'R_kgDOPyh4Kw',
  category: 'General',
  categoryId: 'DIC_kwDOPyh4K84CwPjL',
  theme: 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  mount.innerHTML = '';
  const langCode = getLang();
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + 'ï½œ' + langCode);
  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;
  mount.appendChild(s);
}
</script>
</body>
</html>
