<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>A Bad Bladder | BELAUG · FFXIV Library</title>
  <meta name="description" content="Allied Society – A Bad Bladder (ARR Patch 2.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:var(--fg);border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}

    /* 展開/收合 */
    .clamp{position:relative; max-height:360px; overflow:hidden}
    .clamp[data-collapsed="false"]{max-height:none}
    .clamp[data-collapsed="true"]::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:72px;
      background:linear-gradient(to bottom, rgba(255,255,255,0), var(--card)); pointer-events:none;
    }
    .expand-wrap{ margin-top:12px; }
    .expand-btn{
      display:inline-block; padding:8px 14px; border-radius:10px;
      background:var(--card); border:1px solid var(--border); cursor:pointer; font-weight:600;
    }
    .expand-btn:hover{ background:#fffef8; }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">🏠 Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="切換語言">🌐 EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <!-- 左：影片 -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/VMVTOJ5zSjk"
              title="A Bad Bladder" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- 右：標題 + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">A Bad Bladder</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story"    class="tab-panel active"></div>
          <div id="panel-acq"      class="tab-panel"></div>
          <div id="panel-unlockq"  class="tab-panel"></div>
          <div id="panel-followq"  class="tab-panel"></div>
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const LANG_KEY = 'ffxiv-guide-lang';
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:'A Bad Bladder',
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    readMore:'Show more', readLess:'Show less',
    story:`<div class="clamp" data-collapsed="true">
      <p>Lieutenant Scarlet briefs you: scouts at E–Tatt’s Spire report the Ixal are attacking, their war balloon having strafed the garrison and caused heavy casualties. You hurry north into the North Shroud and reach E–Tatt’s, where Captain Guithrit thanks Nophica that the worst has passed—though the tower’s defenders are wounded and weary. A private’s arrow punched the balloon’s bladder and brought the beastmen craft down into the trees, but Guithrit fears the Ixal may yet press the attack. He sends you to Peacegarden to inspect the crash site and search for any signs of the enemy.</p>
      <p>At the wreck you encounter a squawking, unruly band of Ixal. Their chief, Sezul Totoloc, stops the bickering and speaks to you: these are not the tower-raiding sort, he says, and he proposes a bargain—bring him the balloon part you found, and he will show you his people’s work inside the gate. His hunters warn that betrayal will be met with violence, but Sezul’s tone is oddly proud rather than hostile. You accept and follow him into the camp.</p>
      <p>Sezul greets you as one who has braved the Ixal den and thanks you for the balloon fragment. He shows you a special stone—rare Xelphatol material used to make wind gauges—and explains that his group calls themselves the Ehcatl Nine, outcasts who do not fight forest folk but dream only of flying free like the wind. They are not here for war with the Twelveswood; their focus lies in the heavens. With this uneasy understanding, you leave the camp mindful that not all beastmen share the same purpose—and that E–Tatt’s Spire still needs your aid.</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> Scarlet <small class="muted">(New Gridania, X:9.9, Y:11.4)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="#">In Pursuit of the Past</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="#">Reaching for Cloud Nine</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'雷雨来たりなば',
    tabs:{ story:'ストーリー', acq:'入手方法', unlockq:'開放クエスト', followq:'後続クエスト', comments:'コメント' },
    readMore:'全文を表示', readLess:'折りたたむ',
    story:`<div class="clamp" data-collapsed="true">
      <p>スカーレット中尉はあなたに告げる。E–Tatt’s Spire の哨戒隊から、イクサルが襲撃しており、戦闘気球による編隊射撃で守備隊に多数の被害が出たという。あなたは北の North Shroud へ急行し、E–Tatt’s に到着する。ギュイトリット隊長は最悪は免れたと安堵しつつも、負傷者は疲弊している。ある一兵の矢が気球を貫いて機体を木立に落としたが、なお敵の増勢を懸念し、あなたに Peacegarden の墜落地点の捜索を命じる。</p>
      <p>墜落現場で、あなたは喧嘩腰のイクサル一団に出くわす。族長のセズル・トトロクが仲裁に入り、彼らは塔を襲う者たちとは別種であると告げる。セズルは取引を持ちかける──あなたが見つけた気球の部品を渡せば、彼らの働きを門の内側で見せようと。仲間たちは裏切れば暴力で報いると警告するが、セズルの口ぶりは敵意よりも誇りに満ちている。あなたは承諾し、彼の後についてキャンプの中へ入る。</p>
      <p>セズルは、イクサルの巣へ足を踏み入れた勇敢さを称え、気球の断片に感謝する。彼は Xelphatol 産の稀少な石を示し、それが風速計を作る材料だと説明する。彼らは自らを「Ehcatl Nine」と名乗る流浪の者たちで、森の民と争うことを望まず、ただ風のように自由に飛ぶことを夢見ているという。彼らは Twelveswood と戦うためにここにいるのではない──その言葉を胸にあなたはキャンプを後にし、E–Tatt’s Spire の防衛がなおもあなたの助けを必要としていることを改めて心に刻む。</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>クエスト発行</b> スカーレット少牙士 <small class="muted">（グリダニア：新市街, X:9.9, Y:11.4）</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="#">ストーンヴィジルに眠る翼</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="#">疾風の空力団</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'狂雨將至',
    tabs:{ story:'故事概要', acq:'取得方式', unlockq:'解鎖任務', followq:'後續任務', comments:'留言' },
    readMore:'展開全文', readLess:'收合內容',
    story:`<div class="clamp" data-collapsed="true">
      <p>Scarlet 中尉向你報告：駐紮於 E–Tatt’s Spire 的偵查隊傳回消息，Ixal 正在發動攻擊，一隻戰鬥氣球對守軍進行掃射，造成大量傷亡。你立刻北行進入 North Shroud 抵達 E–Tatt’s，隊長 Guithrit 感謝諸神庇佑雖渡險境，守軍卻已疲憊不堪。一名士兵的箭正中浮囊，使鳥人飛船墜入樹梢，但他仍憂心敵軍再犯，囑你前往 Peacegarden 勘察墜落點並搜尋敵跡。</p>
      <p>殘骸處，你撞見一群吵鬧的 Ixal。首領 Sezul Totoloc 平息爭執，表示他們並非襲塔之輩，並提議交易：將你撿到的氣球零件交給他，他便帶你入營見識他們的工藝。獵人們警告若背信必遭報復，然而 Sezul 的語氣更多是自傲而非敵意。你於是隨他入營。</p>
      <p>Sezul 稱讚你膽識過人，感謝你帶來碎片。他展示稀有的 Xelphatol 石，說是製作風速儀的材料，並表明他們自稱「Ehcatl Nine」，是不與森林之民為敵的放逐者，只盼如風般自由飛翔。他們非為戰事而來，而是為了天空。你帶著這份理解離開營地，心知並非所有獸族都抱持同一目的，而 E–Tatt’s Spire 仍需你的協助。</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>任務發布</b> Scarlet <small class="muted">（新格里達尼亞, X:9.9, Y:11.4）</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="#">追憶之翼</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="#">追風之翼</a></div>
    </div>`
  }
};

const langToggle  = document.getElementById('langToggle');
const pageTitle   = document.getElementById('pageTitle');
const tabBtns     = [...document.querySelectorAll('.tab-btn')];
const panels = {
  story:  document.getElementById('panel-story'),
  acq:    document.getElementById('panel-acq'),
  unlockq:document.getElementById('panel-unlockq'),
  followq:document.getElementById('panel-followq'),
  comments: document.getElementById('panel-comments')
};

function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }
function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `🌐 ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}

function wireClamp(panelEl, t){
  const clamp = panelEl.querySelector('.clamp');
  const btn = panelEl.querySelector('[data-role="expand"]');
  if(!clamp || !btn) return;
  function setLabel(){
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    btn.textContent = collapsed ? t.readMore : t.readLess;
  }
  setLabel();
  btn.addEventListener('click', ()=>{
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    clamp.setAttribute('data-collapsed', collapsed ? 'false' : 'true');
    setLabel();
  });
}

function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  if (key !== 'comments') panels[key].innerHTML = t[key];
  if (key === 'story') wireClamp(panels[key], t);
  if (key === 'comments') loadGiscusForCurrentLang();
}

tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});

langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem(LANG_KEY, next);
  applyLang(next);
});

applyLang(getLang());

/* === Giscus：Comments 分頁 === */
const GISCUS_CFG = {
      repo: 'BELAUG-FFXIV/FFXIV_Library',
      repoId: 'R_kgDOPyh4Kw',
      category: 'General',
      categoryId: 'DIC_kwDOPyh4K84CwPjL',
      theme: 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  mount.innerHTML = '';
  const langCode = getLang();
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + '｜' + langCode);
  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;
  mount.appendChild(s);
}
</script>
</body>
</html>
