<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Three for Three | BELAUG Â· FFXIV Library</title>
  <meta name="description" content="MSQ â€“ Three for Three (ARR Patch 2.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:var(--fg);border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}
    .clamp{position:relative; max-height:360px; overflow:hidden}
    .clamp[data-collapsed="false"]{max-height:none}
    .clamp[data-collapsed="true"]::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:72px;
      background:linear-gradient(to bottom, rgba(255,255,255,0), var(--card)); pointer-events:none;
    }
    .expand-wrap{ margin-top:12px; }
    .expand-btn{
      display:inline-block; padding:8px 14px; border-radius:10px;
      background:var(--card); border:1px solid var(--border); cursor:pointer; font-weight:600;
    }
    .expand-btn:hover{ background:#fffef8; }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">ğŸ  Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="åˆ‡æ›èªè¨€">ğŸŒ EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/jj4qVkewWk4"
              title="Three for Three" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="hd" id="pageTitle">Three for Three</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story" class="tab-panel active"></div>
          <div id="panel-acq" class="tab-panel"></div>
          <div id="panel-unlockq" class="tab-panel"></div>
          <div id="panel-followq" class="tab-panel"></div>
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:'Three for Three',
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    readMore:'Show more', readLess:'Show less',
    story:`<div class="clamp" data-collapsed="true">
      <p>Portelaine notes the commotion you have caused in so short a timeâ€”striking down heretics, rescuing a knight, and even pulling a member of his house back from danger. It is only natural, he says, that you would want something in return. When you ask for introductions to the other High Houses, he concedes you have given them no cause to distrust youâ€”but he will not offer such endorsements without one more service.</p>
      <p>He bids you not to worry. A porter bound for Skyfire Locks was ambushed on the road west of Dragonhead, and though the man escaped with his life, his wares were taken. Portelaine sends you to the scene to recover what remains, reminding you that returning the shipment would also endear you to House Haillenarteâ€”making your request for aid all the easier to grant.</p>
      <p>You go to the place of the robbery and find the danger not yet passed. Steel rings out, and in the midst of the struggle a chilling certainty returnsâ€”someone is watching you, measuring your movements from somewhere just beyond sight.</p>
      <p>When you bring back what you can, the porterâ€™s relief is immediate. He checks the recovered goods and insists nearly everything is thereâ€”until his gaze catches on a chest that looks tampered with. Worse still, he recognizes it as personal property belonging to Lord Francel.</p>
      <p>Portelaine has you verify the contents against the manifest, and the truth hits like ice: a draconian rosaryâ€”an unmistakable heretical tokenâ€”hidden among what should have been a noblemanâ€™s effects. Under his breath, Portelaine voices what the finding suggests, and what it would mean if true.</p>
      <p>He thanks you for bringing the matter to his attention and says he will inform the inquisitors at once. Until this is resolved, he urges you to keep your distance from House Haillenarteâ€”and with that, the introductions you sought must be set aside. In Ishgard, he reminds you, rooting out heretics comes before all else.</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> Portelaine <small class="muted">Coerthas Central Highlands (X:24.8, Y:28.8)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="men-of-honor.html">Men of Honor</a></div>
      <div class="row">All classes and jobs (excluding limited jobs) (Level 36 or above)</div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="the-rose-and-the-unicorn.html">The Rose and the Unicorn</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'ç ¦ã«å®›ã¦ã‚‰ã‚ŒãŸè·ç‰©',
    tabs:{ story:'ã‚¹ãƒˆãƒ¼ãƒªãƒ¼', acq:'å…¥æ‰‹æ–¹æ³•', unlockq:'é–‹æ”¾ã‚¯ã‚¨ã‚¹ãƒˆ', followq:'å¾Œç¶šã‚¯ã‚¨ã‚¹ãƒˆ', comments:'ã‚³ãƒ¡ãƒ³ãƒˆ' },
    readMore:'å…¨æ–‡ã‚’è¡¨ç¤º', readLess:'æŠ˜ã‚ŠãŸãŸã‚€',
    story:`<div class="clamp" data-collapsed="true">
      <p>ãƒãƒ«ãƒˆã‚¥ãƒ¬ãƒ¼ãƒ³ã¯ã€ã‚ãªãŸãŒçŸ­ã„æ»åœ¨ã®é–“ã«èµ·ã“ã—ãŸé¨’ãã‚’å£ã«ã™ã‚‹ã€‚ç•°ç«¯è€…ã‚’è¨ã¡ã€é¨å…µã‚’æ•‘ã„ã€ã•ã‚‰ã«ãƒ‡ãƒ¥ãƒ©ãƒ³ãƒ‡ãƒ«å®¶ã®è€…ã¾ã§ã‚‚åŠ©ã‘ãŸâ€•â€•ãã‚Œã»ã©ã®åƒãã‚’ã—ãŸã®ãªã‚‰ã€è¦‹è¿”ã‚Šã‚’æœ›ã‚€ã®ã‚‚å½“ç„¶ã ã€ã¨ã€‚ã‚ãªãŸãŒä»–ã®åå®¶ã¸ã®ç´¹ä»‹ã‚’æ±‚ã‚ã‚‹ã¨ã€å½¼ã¯ä¸ä¿¡ã‚’æŠ±ãç†ç”±ã¯ãªã„ã¨èªã‚ã¤ã¤ã‚‚ã€ä¸‰ã¤ã®åå®¶ã¸å–ã‚Šæ¬¡ãã«ã¯ã€ã‚‚ã†ä¸€ã¤åƒããŒå¿…è¦ã ã¨è¨€ã†ã€‚</p>
      <p>å¿ƒé…ã¯ç„¡ç”¨ã ã€ã¨å½¼ã¯ç¶šã‘ã‚‹ã€‚å°‘ã—å‰ã€ã‚¢ãƒ¼ãƒˆãƒœãƒ«ã‚°ç ¦ç¾¤ã¸å‘ã‹ã†è·é‹ã³äººãŒã€ã“ã“ã‹ã‚‰è¥¿ã®è¡—é“ã§è¥²æ’ƒã‚’å—ã‘ãŸã€‚å‘½ã¯åŠ©ã‹ã£ãŸãŒã€ç©ã¿è·ã¯å¥ªã‚ã‚ŒãŸã®ã ã¨ã„ã†ã€‚ç¾å ´ã¸èµ´ãã€æ®‹ã£ã¦ã„ã‚‹ã‚‚ã®ãŒã‚ã‚Œã°å›åã—ã¦æˆ»ã‚Œâ€•â€•ãã‚ŒãŒã‚¢ã‚¤ãƒ³ãƒãƒ«ãƒˆå®¶ã®å¿ƒè¨¼ã‚‚è‰¯ãã—ã€ã‚ãªãŸã®é¡˜ã„ã‚’é€šã™åŠ©ã‘ã«ãªã‚‹ã¯ãšã ã€ã¨ã€‚</p>
      <p>ã‚ãªãŸã¯å¼·å¥ªã®ç¾å ´ã¸å‘ã‹ã†ã€‚ã ãŒã€ãã“ã¯ã¾ã å±é™ºãŒå»ã£ã¦ã„ãªã‹ã£ãŸã€‚å¿œæˆ¦ã™ã‚‹æœ€ä¸­ã€å†·ãŸã„ç¢ºä¿¡ãŒèƒ¸ã‚’åˆºã™ã€‚èª°ã‹ã«è¦‹ã‚‰ã‚Œã¦ã„ã‚‹â€•â€•å§¿ã¯è¦‹ãˆãšã¨ã‚‚ã€ã‚ãªãŸã®å‹•ãã‚’è¿½ã£ã¦ã„ã‚‹æ°—é…ã ã‘ãŒã€ã¯ã£ãã‚Šã¨æ®‹ã‚‹ã€‚</p>
      <p>å›åã—ãŸå“ã‚’æºãˆã¦æˆ»ã‚‹ã¨ã€è·é‹ã³äººã¯å®‰å µã®å£°ã‚’ä¸Šã’ã‚‹ã€‚ã»ã¨ã‚“ã©æƒã£ã¦ã„ã‚‹ã€ã™ã¹ã¦æˆ»ã£ãŸâ€•â€•ãã†è¨€ã„ã‹ã‘ãŸå½¼ã®ç›®ãŒã€ã“ã˜é–‹ã‘ã‚‰ã‚Œã‹ã‘ãŸç®±ã«ç•™ã¾ã‚‹ã€‚ã—ã‹ã‚‚ãã‚Œã¯ã€ãƒ•ãƒ©ãƒ³ã‚»ãƒ«å¿ã®ç§ç‰©ã ã¨ã„ã†ã€‚</p>
      <p>ãƒãƒ«ãƒˆã‚¥ãƒ¬ãƒ¼ãƒ³ã¯é€ã‚ŠçŠ¶ã¨ç…§ã‚‰ã—åˆã‚ã›ã‚‹ã‚ˆã†ä¿ƒã—ã€ç®±ã®ä¸­èº«ã‚’ç¢ºã‹ã‚ã•ã›ã‚‹ã€‚ãã“ã§è¦‹ã¤ã‹ã£ãŸã®ã¯ã€ã€Œç«œçœ¼ã®ç¥ˆé–ã€â€•â€•ç•°ç«¯ã®è¨¼ã«ä»–ãªã‚‰ãªã„å“ã ã£ãŸã€‚ãªãœãã‚ŒãŒãƒ•ãƒ©ãƒ³ã‚»ãƒ«å¿ã®è·ã«ç´›ã‚Œã¦ã„ãŸã®ã‹ã€‚å½¼ã¯ã€å™‚ã•ã‚Œã‚‹ã‚¢ã‚¤ãƒ³ãƒãƒ«ãƒˆå®¶ã®ç•°ç«¯ç–‘æƒ‘ã¸ã¨è€ƒãˆã‚’å·¡ã‚‰ã›ã‚‹ã€‚</p>
      <p>ã‚ãªãŸã«ç¤¼ã‚’è¿°ã¹ãŸã†ãˆã§ã€ãƒãƒ«ãƒˆã‚¥ãƒ¬ãƒ¼ãƒ³ã¯ç•°ç«¯å¯©å•å®˜ã¸ç›´ã¡ã«å ±å‘Šã™ã‚‹ã¨å‘Šã’ã‚‹ã€‚ã“ã®çŠ¶æ³ã§ã¯ã€ã‚¢ã‚¤ãƒ³ãƒãƒ«ãƒˆå®¶ã¨é–¢ã‚ã‚‹ã¹ãã§ã¯ãªã„ã€ã¨å¼·ãå¿ å‘Šã—ã€ä»–ã®åå®¶ã¸ã®ç´¹ä»‹ã‚‚å»¶æœŸã›ã–ã‚‹ã‚’å¾—ãªã„ã¨è¨€ã†ã€‚ã‚¤ã‚·ãƒ¥ã‚¬ãƒ«ãƒ‰ã§ã¯ã€ç•°ç«¯ã‚’è¨ã¡æ»…ã¼ã™ã“ã¨ãŒä½•ã‚ˆã‚Šã‚‚å„ªå…ˆã•ã‚Œã‚‹â€•â€•ãã‚ŒãŒå½¼ã®çµè«–ã ã£ãŸã€‚</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>ã‚¯ã‚¨ã‚¹ãƒˆç™ºè¡Œ</b> ãƒãƒ«ãƒˆã‚¥ãƒ¬ãƒ¼ãƒ³ <small class="muted">ã‚¯ãƒ«ã‚¶ã‚¹ä¸­å¤®é«˜åœ° (X:24.8, Y:28.8)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="men-of-honor.html">ãƒ‡ãƒ¥ãƒ©ãƒ³ãƒ‡ãƒ«å®¶ã®æµå„€</a></div>
      <div class="row">ã™ã¹ã¦ï¼ˆãƒªãƒŸãƒ†ãƒƒãƒ‰ã‚¸ãƒ§ãƒ–ã‚’é™¤ãï¼‰Lv 36ï½</div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="the-rose-and-the-unicorn.html">ã‚¢ã‚¤ãƒ³ãƒãƒ«ãƒˆå®¶ã®å—é›£</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'å¯„å¾€å ¡å£˜çš„åŒ…è£¹',
    tabs:{ story:'æ•…äº‹æ¦‚è¦', acq:'å–å¾—æ–¹å¼', unlockq:'è§£é–ä»»å‹™', followq:'å¾ŒçºŒä»»å‹™', comments:'ç•™è¨€' },
    readMore:'å±•é–‹å…¨æ–‡', readLess:'æ”¶åˆå…§å®¹',
    story:`<div class="clamp" data-collapsed="true">
      <p>Portelaine æåˆ°ä½ åœ¨é€™éº¼çŸ­çš„æ™‚é–“å…§ï¼Œå·²ç¶“åœ¨ Dragonhead å¼•èµ·ä¸å°çš„é¨·å‹•â€”â€”ä½ è¨ä¼äº†ç•°ç«¯è€…ã€æ•‘å›äº†é¨å£«ï¼Œç”šè‡³é‚„æŠŠä»–å€‘ House çš„äººå¾éšªå¢ƒä¸­å¸¶äº†å›ä¾†ã€‚ç•¶ä½ æå‡ºå¸Œæœ›ä»–èƒ½å¼•è–¦ä½ å»è¦‹å…¶ä»– High Houses æ™‚ï¼Œä»–æ‰¿èªä½ ç¢ºå¯¦æ²’æœ‰è®“ä»–å€‘ä¸ä¿¡ä»»çš„ç†ç”±ï¼Œä½†è¦ä»–ä»¥å…©æ¬¡åŠŸç¸¾æ›ä¾†ä¸‰å€‹å®¶æ—çš„èƒŒæ›¸ï¼Œé‚„å·®æœ€å¾Œä¸€æ­¥ã€‚</p>
      <p>ä»–å«ä½ åˆ¥æ“”å¿ƒï¼Œèªªé€™ä»½å·®äº‹å°ä½ ä¾†èªªåªéœ€ç‰‡åˆ»ï¼šä¸ä¹…å‰ï¼Œä¸€åå‰å¾€ Skyfire Locks çš„é‹é€è€…åœ¨ Dragonhead ä»¥è¥¿çš„é“è·¯é­åˆ°è¥²æ“Šï¼Œé›–ç„¶æ’¿å›ä¸€æ¢å‘½ï¼Œè²¨ç‰©å»è¢«æ¶èµ°ã€‚Portelaine è¦ä½ å‰å¾€ç¾å ´ï¼ŒæŠŠèƒ½æ‰¾å›çš„æ±è¥¿éƒ½å¸¶å›ä¾†â€”â€”è‹¥èƒ½å–å›å¤±ç‰©ï¼Œä¹Ÿæœƒè®“ House Haillenarte æ›´é¡˜æ„æ¥å—ä½ çš„è«‹æ±‚ã€‚</p>
      <p>ä½ æŠµé”è¢«æ¶çš„åœ°é»ï¼Œç™¼ç¾å±éšªå°šæœªè§£é™¤ã€‚äº¤æˆ°çš„æ··äº‚ä¹‹ä¸­ï¼Œä½ å†æ¬¡æ¸…æ¥šåœ°æ„Ÿè¦ºåˆ°ï¼Œé‚£è‚¡é™°å½±èˆ¬çš„è¦–ç·šæ­£è½åœ¨ä½ èº«ä¸Šâ€”â€”æœ‰äººåœ¨æš—è™•æ³¨è¦–è‘—ä½ ï¼Œåƒæ˜¯åœ¨è§€å¯Ÿã€è¡¡é‡ä½ çš„ä¸€èˆ‰ä¸€å‹•ã€‚</p>
      <p>ç•¶ä½ å¸¶è‘—å›æ”¶çš„è²¨ç‰©å›åˆ° Portelaine é¢å‰ï¼Œé‹é€è€…å¹¾ä¹è¦æ­¡å‘¼å‡ºè²ï¼Œèªªä¸€åˆ‡éƒ½åœ¨ã€æ¯ä¸€ä»¶éƒ½æ‰¾å›ä¾†äº†â€”â€”å¯è©±éŸ³ä¸€è½‰ï¼Œä»–æ³¨æ„åˆ°æ—é‚Šæœ‰å€‹ç®±å­ä¼¼ä¹è¢«äººå‹•éæ‰‹è…³ã€‚æ›´ç³Ÿçš„æ˜¯ï¼Œé‚£æ˜¯ Lord Francel çš„ç§äººç‰©å“ã€‚</p>
      <p>Portelaine è®“ä½ å°ç…§æ¸…å–®ç¢ºèªå…§å®¹ï¼Œé–é›–åƒæ˜¯æ’ä½äº†ï¼Œç®±å…§å»è—è‘—ä»¤äººç™¼å¯’çš„æ±è¥¿ï¼šä¸€ä¸²è±¡å¾µç•°ç«¯çš„ç¥ˆé–â€”â€”ä¸è©²å‡ºç¾åœ¨ Lord Francel çš„ç‰©ä»¶è£¡ã€‚Portelaine ä½è²é“å‡ºé€™æ„å‘³è‘—ä»€éº¼ï¼Œä¹Ÿè®“äººç„¡æ³•ä¸è¯æƒ³åˆ°é—œæ–¼ House Haillenarte çš„è€³èªã€‚</p>
      <p>ä»–å‘ä½ è‡´è¬ï¼Œè¡¨ç¤ºæœƒç«‹åˆ»æŠŠæ­¤äº‹é€šå ±ç•°ç«¯å¯©å•å®˜ï¼Œä¸¦åš´æ­£å‹¸ä½ åœ¨èª¿æŸ¥çµæœå‡ºä¾†å‰ä¸è¦èˆ‡ House Haillenarte æœ‰ä»»ä½•ç‰½é€£ã€‚è‡³æ–¼ä½ åŸæœ¬æƒ³è¦çš„å¼•è–¦ï¼Œä¹Ÿåªèƒ½æš«æ™‚å»¶å¾Œâ€”â€”åœ¨ Ishgardï¼Œæ¸…å‰¿ç•°ç«¯è€…æ°¸é å„ªå…ˆæ–¼å…¶ä»–ä¸€åˆ‡ã€‚</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>ä»»å‹™ç™¼å¸ƒ</b> æ³¢çˆ¾åœ–é›·æ© <small class="muted">åº«çˆ¾æœ­æ–¯ä¸­å¤®é«˜åœ° (X:24.8, Y:28.8)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="men-of-honor.html">æ¦®è­½ä¹‹å£«ï¼šDurandel å®¶çš„é–€é¢¨</a></div>
      <div class="row">æ‰€æœ‰è·æ¥­ï¼ˆä¸å«é™å®šè·ï¼‰ ç­‰ç´š 36 ä»¥ä¸Š</div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="the-rose-and-the-unicorn.html">è–”è–‡èˆ‡ç¨è§’ç¸ï¼ŒHouse Haillenarte å®¶è’™é›£</a></div>
    </div>`
  }
};

const LANG_KEY = 'ffxiv-guide-lang';
const langToggle  = document.getElementById('langToggle');
const pageTitle   = document.getElementById('pageTitle');
const tabBtns     = [...document.querySelectorAll('.tab-btn')];
const panels = {
  story:  document.getElementById('panel-story'),
  acq:    document.getElementById('panel-acq'),
  unlockq:document.getElementById('panel-unlockq'),
  followq:document.getElementById('panel-followq'),
  comments: document.getElementById('panel-comments')
};

function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }
function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `ğŸŒ ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}

function wireClamp(panelEl, t){
  const clamp = panelEl.querySelector('.clamp');
  const btn = panelEl.querySelector('[data-role="expand"]');
  if(!clamp || !btn) return;
  function setLabel(){
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    btn.textContent = collapsed ? t.readMore : t.readLess;
  }
  setLabel();
  btn.addEventListener('click', ()=>{
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    clamp.setAttribute('data-collapsed', collapsed ? 'false' : 'true');
    setLabel();
  });
}

function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  if (key !== 'comments') panels[key].innerHTML = t[key];
  if (key === 'story') wireClamp(panels[key], t);
  if (key === 'comments') loadGiscusForCurrentLang();
}

tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});

langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem(LANG_KEY, next);
  applyLang(next);
});

applyLang(getLang());

const GISCUS_CFG = {
  repo: 'BELAUG-FFXIV/FFXIV_Library',
  repoId: 'R_kgDOPyh4Kw',
  category: 'General',
  categoryId: 'DIC_kwDOPyh4K84CwPjL',
  theme: 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  mount.innerHTML = '';
  const langCode = getLang();
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + 'ï½œ' + langCode);
  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;
  mount.appendChild(s);
}
</script>
</body>
</html>
