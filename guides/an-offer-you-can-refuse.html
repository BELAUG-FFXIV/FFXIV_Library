<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>An Offer You Can Refuse | BELAUG · FFXIV Library</title>
  <meta name="description" content="MSQ – An Offer You Can Refuse (ARR Patch 2.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:var(--fg);border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}
    /* 展開/收合 */
    .clamp{position:relative; max-height:360px; overflow:hidden}
    .clamp[data-collapsed="false"]{max-height:none}
    .clamp[data-collapsed="true"]::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:72px;
      background:linear-gradient(to bottom, rgba(255,255,255,0), var(--card)); pointer-events:none;
    }
    .expand-wrap{ margin-top:12px; }
    .expand-btn{
      display:inline-block; padding:8px 14px; border-radius:10px;
      background:var(--card); border:1px solid var(--border); cursor:pointer; font-weight:600;
    }
    .expand-btn:hover{ background:#fffef8; }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">🏠 Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="切換語言">🌐 EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <!-- 左：影片 -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/LGQS53L_Slc"
              title="An Offer You Can Refuse" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- 右：標題 + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">An Offer You Can Refuse</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story"   class="tab-panel active"></div>
          <div id="panel-acq"     class="tab-panel"></div>
          <div id="panel-unlockq" class="tab-panel"></div>
          <div id="panel-followq" class="tab-panel"></div>
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const LANG_KEY = 'ffxiv-guide-lang';
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:'An Offer You Can Refuse',
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    readMore:'Show more', readLess:'Show less',
    story:`<div class="clamp" data-collapsed="true">
      <p>In Wineport, Shamani Lohmani speaks of life’s crooked generosity: he always loved wine, yet only after retirement—funded by coin earned in mercenary days—could passion become vocation. But there’s a hitch: nothing in his cellar suits the banquet. The town’s finest vintages are hoarded by Byrglaent, master of Vylbrand’s largest winery. He doubts the Wine Baron will receive you kindly, but given the circumstances, you must ask all the same.</p>
      <p>You find Byrglaent mid-tirade over a ruined bottling—“undrinkable,” and the culprit deserves to swallow every last drop. Your interruption earns a harsher verdict: neither you nor your “neophyte vintner” friend can appreciate the subtleties of his private stock. He’d sooner serve goobbue urine than sell you his worst vintage. Begone.</p>
      <p>Back with Shamani, he needs no guess: a refusal—yes, in those very words. The Wine Baron’s skill is beyond reproach; his tact, less so. Very well, he says—time for an alternative approach.</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> Shamani Lohmani <small class="muted">(Eastern La Noscea, X:21.6, Y:21.1)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="what-do-you-mean-you-forgot-the-wine.html">What Do You Mean You Forgot the Wine</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="it-wont-work.html">It Won’t Work</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'シャマニ・ローマニの求める香り',
    tabs:{ story:'ストーリー', acq:'入手方法', unlockq:'開放クエスト', followq:'後続クエスト', comments:'コメント' },
    readMore:'全文を表示', readLess:'折りたたむ',
    story:`<div class="clamp" data-collapsed="true">
      <p>ワインポートで、シャマニ・ローマニは人生の気まぐれな恩寵を語る。ワインを愛してきたが、本気で打ち込めたのは引退してから――傭兵稼業で蓄えた貯えがあったからこそだ。だが困ったことに、手持ちのどれも宴にふさわしい出来ではない。街で最上のヴィンテージは、バイルブランド最大のワイナリーを率いるビルギレントが抱え込んでいる。あの「ワインバロン」が取り合うとは思えないが、状況が状況だ。頼みに行くしかない。</p>
      <p>そのビルギレントは、劣悪な瓶詰めをこき下ろす最中だった――「不純物だらけで飲めたものではない。責任者にはこの濁り酒を一滴残らず飲ませてやれ」。話しかければ、さらに辛辣だ。「あの新米醸造家が私に会えと？　お前にもそやつにも、私の秘蔵の妙味などわかるまい。最悪の一本ですら売るくらいならグゥーブーの小便でも出してやる。失せろ」。</p>
      <p>シャマニのもとへ戻れば、答えは聞くまでもない――そうか、やはり断られたか。情熱も腕も確かだが、リムサ・ロミンサの「ワインバロン」は礼に欠ける男だ。ならば、別の手でいこう。</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>クエスト発行</b> シャマニ・ローマニ　東ラノシア <small class="muted">(X:21.6, Y:21.1)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="what-do-you-mean-you-forgot-the-wine.html">ごちそうには美酒を</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="it-wont-work.html">失われた伝説を訪ねて</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'夏瑪尼・羅瑪尼追尋的香氣',
    tabs:{ story:'故事概要', acq:'取得方式', unlockq:'解鎖任務', followq:'後續任務', comments:'留言' },
    readMore:'展開全文', readLess:'收合內容',
    story:`<div class="clamp" data-collapsed="true">
      <p>在 Wineport，Shamani Lohmani 淡淡說起命運的戲法：他向來熱愛葡萄酒，卻直到退休後——靠著當傭兵時累積的積蓄——才能把興趣化為正業。問題在於，他酒窖裡沒有任何一款配得上那場盛宴。全鎮最好的年份酒，都被 Vylbrand 最大酒莊的主理人 Byrglaent 囤著。就他對那位 Wine Baron of Limsa Lominsa 的了解，十有八九不會賞光，但在此情況下也只能硬著頭皮去求。</p>
      <p>你找到 Byrglaent 時，他正痛罵一瓶幾乎「難以下嚥」的劣釀，甚至說該讓失職之人把那桶渾濁的髒酒全喝下肚。你開口說明來意，換來更不客氣的斷語：你和那位「新手釀酒師」都沒有資格品味他的私藏；就算是他最差的一批，他也寧可端出 goobbue 的尿給你。走開。</p>
      <p>回到 Shamani 身邊，他不用聽就知道——果然被回絕，而且還是用那種話。Byrglaent 的技藝毋庸置疑，禮數卻少得可憐。好吧，他說，那就換一條路。</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>任務發布</b> 夏瑪尼・羅瑪尼　拉諾西亞東部 <small class="muted">(X:21.6, Y:21.1)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="what-do-you-mean-you-forgot-the-wine.html">盛宴怎能少美酒</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="it-wont-work.html">尋訪失落的傳說</a></div>
    </div>`
  }
};

const langToggle  = document.getElementById('langToggle');
const pageTitle   = document.getElementById('pageTitle');
const tabBtns     = [...document.querySelectorAll('.tab-btn')];
const panels = {
  story:  document.getElementById('panel-story'),
  acq:    document.getElementById('panel-acq'),
  unlockq:document.getElementById('panel-unlockq'),
  followq:document.getElementById('panel-followq'),
  comments: document.getElementById('panel-comments')
};

function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }
function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `🌐 ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}

function wireClamp(panelEl, t){
  const clamp = panelEl.querySelector('.clamp');
  const btn = panelEl.querySelector('[data-role="expand"]');
  if(!clamp || !btn) return;
  function setLabel(){
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    btn.textContent = collapsed ? t.readMore : t.readLess;
  }
  setLabel();
  btn.addEventListener('click', ()=>{
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    clamp.setAttribute('data-collapsed', collapsed ? 'false' : 'true');
    setLabel();
  });
}

function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  if (key !== 'comments') panels[key].innerHTML = t[key];
  if (key === 'story') wireClamp(panels[key], t);
  if (key === 'comments') loadGiscusForCurrentLang();
}

tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});

langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem(LANG_KEY, next);
  applyLang(next);
});

applyLang(getLang());

/* === Giscus：Comments 分頁 === */
const GISCUS_CFG = {
  repo: 'BELAUG-FFXIV/FFXIV_Library',
  repoId: 'R_kgDOPyh4Kw',
  category: 'General',
  categoryId: 'DIC_kwDOPyh4K84CwPjL',
  theme: 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  mount.innerHTML = '';
  const langCode = getLang();
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + '｜' + langCode);
  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;
  mount.appendChild(s);
}
</script>
</body>
</html>
