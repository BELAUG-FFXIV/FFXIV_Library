<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>An Offer You Can Refuse | BELAUG Â· FFXIV Library</title>
  <meta name="description" content="MSQ â€“ An Offer You Can Refuse (ARR Patch 2.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:var(--fg);border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}
    .clamp{position:relative; max-height:360px; overflow:hidden}
    .clamp[data-collapsed="false"]{max-height:none}
    .clamp[data-collapsed="true"]::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:72px;
      background:linear-gradient(to bottom, rgba(255,255,255,0), var(--card)); pointer-events:none;
    }
    .expand-wrap{ margin-top:12px; }
    .expand-btn{
      display:inline-block; padding:8px 14px; border-radius:10px;
      background:var(--card); border:1px solid var(--border); cursor:pointer; font-weight:600;
    }
    .expand-btn:hover{ background:#fffef8; }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">ğŸ  Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="åˆ‡æ›èªè¨€">ğŸŒ EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <!-- å·¦ï¼šå½±ç‰‡ -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/LGQS53L_Slc"
              title="An Offer You Can Refuse" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- å³ï¼šæ¨™é¡Œ + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">An Offer You Can Refuse</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story"   class="tab-panel active"></div>
          <div id="panel-acq"     class="tab-panel"></div>
          <div id="panel-unlockq" class="tab-panel"></div>
          <div id="panel-followq" class="tab-panel"></div>
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const LANG_KEY = 'ffxiv-guide-lang';
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:'An Offer You Can Refuse',
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    readMore:'Show more', readLess:'Show less',
    story:`<div class="clamp" data-collapsed="true">
      <p>Life has a way of turning without warning, and Shamani Lohmani speaks of it with an easy, practiced calmâ€”how he always loved wine, yet only after being forced into retirement did he finally have the time to pursue that love as something more than a pastime.</p>
      <p>He makes it plain that the dream would never have taken shape without the coin he saved as a mercenary. Whatever people may think of such work, he admits, it is difficult to deny its rewardsâ€”rewards that now bankroll his quieter ambition.</p>
      <p>But the moment of reflection does not last. He notes your impatience, and reminds you that Wheiskaet is waiting on his wine. That urgency exposes the real trouble: nothing Shamani has on hand is worthy of the occasion.</p>
      <p>The finest vintages, he says, are kept out of reachâ€”hoarded by Byrglaent, who owns and runs the largest winery on Vylbrand. Shamani doubts the man will welcome your request, but in these circumstances, there is little choice but to go and ask.</p>
      <p>When you approach Byrglaent, he is already in the middle of a furious tirade over a bottle he deems ruined by impurities. Your interruption earns only sharper scorn: he laughs at the very idea that youâ€”or your companionâ€”could appreciate what he keeps for himself, and snarls that he would sooner serve you goobbue urine than part with even his worst vintage. When you return with that refusal, Shamani only asks if he said no, then accepts the answer without surpriseâ€”acknowledging the Wine Baron of Limsa Lominsaâ€™s skill and passion, and his complete lack of tactâ€”before telling you the two of you will have to find another way.</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> Shamani Lohmani <small class="muted">Eastern La Noscea (X:21.6, Y:21.1)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="what-do-you-mean-you-forgot-the-wine.html">What Do You Mean You Forgot the Wine</a></div>
      <div class="row">All classes and jobs (excluding limited jobs) (Level 32 or above)</div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="it-wont-work.html">It Wonâ€™t Work</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'ã‚·ãƒ£ãƒãƒ‹ãƒ»ãƒ­ãƒ¼ãƒãƒ‹ã®æ±‚ã‚ã‚‹é¦™ã‚Š',
    tabs:{ story:'ã‚¹ãƒˆãƒ¼ãƒªãƒ¼', acq:'å…¥æ‰‹æ–¹æ³•', unlockq:'é–‹æ”¾ã‚¯ã‚¨ã‚¹ãƒˆ', followq:'å¾Œç¶šã‚¯ã‚¨ã‚¹ãƒˆ', comments:'ã‚³ãƒ¡ãƒ³ãƒˆ' },
    readMore:'å…¨æ–‡ã‚’è¡¨ç¤º', readLess:'æŠ˜ã‚ŠãŸãŸã‚€',
    story:`<div class="clamp" data-collapsed="true">
      <p>äººç”Ÿã¯ã€æ™‚ã«é©šãã»ã©æ°—ã¾ãã‚Œãªå½¢ã§é“ç­‹ã‚’å¤‰ãˆã‚‹â€•â€•ã‚·ãƒ£ãƒãƒ‹ãƒ»ãƒ­ãƒ¼ãƒãƒ‹ã¯ãã†èªã‚Šã€æ˜”ã‹ã‚‰è‘¡è„é…’ã«å¿ƒæƒ¹ã‹ã‚Œã¦ã„ãŸã“ã¨ã€ãã—ã¦å¼•é€€ã‚’ä½™å„€ãªãã•ã‚Œã¦ã‹ã‚‰ã‚ˆã†ã‚„ãã€ãã‚Œã‚’å˜ãªã‚‹è¶£å‘³ã§ã¯ãªãçœŸå‰£ã«è¿½ã„ã‹ã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã ã¨é™ã‹ã«æ˜ã‹ã™ã€‚</p>
      <p>ã‚‚ã£ã¨ã‚‚ã€ãã‚Œã‚‚å‚­å…µã¨ã—ã¦ç¨¼ãè“„ãˆãŸè³‡é‡‘ãŒã‚ã£ã¦ã“ãã ã€ã¨å½¼ã¯ä»˜ã‘åŠ ãˆã‚‹ã€‚ä»•äº‹ã®æ€§è³ªã‚’ã©ã†è¨€ã‚ã‚Œã‚ˆã†ã¨ã€å ±é…¬ãŒè‰¯ã„ã¨ã„ã†äº‹å®Ÿã ã‘ã¯å¦å®šã§ããªã„â€•â€•ãã®è“„ãˆãŒã€ä»Šã®å½¼ã®å¤¢ã‚’æ”¯ãˆã¦ã„ã‚‹ã®ã ã€‚</p>
      <p>ã ãŒã€æ„Ÿæ…¨ã«æµ¸ã‚‹æ™‚é–“ã¯é•·ããªã„ã€‚ã‚ãªãŸãŒæ€¥ã„ã¦ã„ã‚‹ã“ã¨ã‚’å¯Ÿã—ãŸã‚·ãƒ£ãƒãƒ‹ãƒ»ãƒ­ãƒ¼ãƒãƒ‹ã¯ã€ãƒ´ã‚§ã‚¤ã‚¹ã‚±ãƒ¼ãƒˆãŒè‘¡è„é…’ã‚’å¾…ã£ã¦ã„ã‚‹ã®ã ã‚ã†ã¨å£ã«ã—ã€ãã®å ´ã«ãµã•ã‚ã—ã„å“è³ªã®é…’ãŒè‡ªåˆ†ã®æ‰‹å…ƒã«ã¯ãªã„ã“ã¨ã‚’ç‡ç›´ã«ç¤ºã™ã€‚</p>
      <p>ã“ã®ç”ºã§æœ€ä¸Šã®å¹´ä»£ç‰©ã¯ã€ãƒ“ãƒ«ã‚®ãƒ¬ãƒ³ãƒˆãŒæŠ±ãˆè¾¼ã‚“ã§ã„ã‚‹â€•â€•ãƒã‚¤ãƒ«ãƒ–ãƒ©ãƒ³ãƒ‰æœ€å¤§ã®é†¸é€ æ‰€ã‚’æ‰€æœ‰ã—ã€é‹å–¶ã™ã‚‹ç”·ã ã€‚ç›¸æ‰‹ãŒå¥½æ„çš„ã«å¿œã˜ã‚‹ã¨ã¯æ€ãˆãªã„ãŒã€çŠ¶æ³ãŒçŠ¶æ³ã ã€åŠ©åŠ›ã‚’ä¹ã†ã—ã‹ãªã„ã¨ã‚·ãƒ£ãƒãƒ‹ãƒ»ãƒ­ãƒ¼ãƒãƒ‹ã¯è¨€ã†ã€‚</p>
      <p>ã‚ãªãŸãŒãƒ“ãƒ«ã‚®ãƒ¬ãƒ³ãƒˆã®ã‚‚ã¨ã‚’è¨ªã­ã‚‹ã¨ã€å½¼ã¯ä¸ç´”ç‰©ã¾ã¿ã‚Œã®é…’ã‚’æ¿€ã—ãç½µã‚Šã€è²¬ä»»è€…ã«ã¯å‡¦åˆ†ã§ã¯ç”Ÿã¬ã‚‹ã„ã€æ±šã‚ŒãŸé…’ã‚’ä¸€æ»´æ®‹ã‚‰ãšé£²ã¾ã›ã‚‹ã¹ãã ã¨è¨€ã„æ”¾ã£ã¦ã„ãŸã€‚å–ã‚Šè¾¼ã¿ä¸­ã ã¨ã—ã¦é®ã‚‰ã‚Œã€ã•ã‚‰ã«ã‚·ãƒ£ãƒãƒ‹ãƒ»ãƒ­ãƒ¼ãƒãƒ‹ã®åã‚’å‡ºã—ãŸã¨ã“ã‚ã§å˜²ç¬‘ãŒè¿”ã‚‹ã ã‘ã ã£ãŸã€‚ã‚ãªãŸã«ã‚‚é€£ã‚Œã®è€…ã«ã‚‚ç§è”µé…’ã®å¦™å‘³ã¯ã‚ã‹ã‚‰ãªã„ã¨è¨€ã„åˆ‡ã‚Šã€æœ€æ‚ªã®å¹´ä»£ç‰©ã‚’å£²ã‚‹ãã‚‰ã„ãªã‚‰ã‚°ã‚¥ãƒ¼ãƒ–ãƒ¼ã®å°¿ã‚’å‡ºã™æ–¹ãŒã¾ã—ã ã¨åãæ¨ã¦ã¦è¿½ã„æ‰•ã†ã€‚æˆ»ã£ãŸã‚ãªãŸã«ã€ã‚·ãƒ£ãƒãƒ‹ãƒ»ãƒ­ãƒ¼ãƒãƒ‹ã¯æ–­ã‚‰ã‚ŒãŸã‹ã¨ç¢ºã‹ã‚ã€è¨€è‘‰ã¾ã§èã„ã¦å°ã•ãé ·ãâ€•â€•è…•ã¨æƒ…ç†±ã¯èªã‚ã‚‹ãŒã€ãƒªãƒ ã‚µãƒ»ãƒ­ãƒŸãƒ³ã‚µã®è‘¡è„é…’ç”·çˆµã¯ç¤¼ç¯€ã«æ¬ ã‘ã‚‹ç”·ã ã€ã¨ã€‚ãã†ã—ã¦å½¼ã¯ã€åˆ¥ã®æ‰‹ã‚’è€ƒãˆã‚‹ã—ã‹ãªã„ã¨å‘Šã’ã‚‹ã€‚</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>ã‚¯ã‚¨ã‚¹ãƒˆç™ºè¡Œ</b> ã‚·ãƒ£ãƒãƒ‹ãƒ»ãƒ­ãƒ¼ãƒãƒ‹ã€€<small class="muted">æ±ãƒ©ãƒã‚·ã‚¢ (X:21.6, Y:21.1)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="what-do-you-mean-you-forgot-the-wine.html">ã”ã¡ãã†ã«ã¯ç¾é…’ã‚’</a></div>
      <div class="row">ã™ã¹ã¦ï¼ˆãƒªãƒŸãƒ†ãƒƒãƒ‰ã‚¸ãƒ§ãƒ–ã‚’é™¤ãï¼‰Lv 32ï½</div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="it-wont-work.html">å¤±ã‚ã‚ŒãŸä¼èª¬ã‚’è¨ªã­ã¦</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'å¤ç‘ªå°¼ãƒ»ç¾…ç‘ªå°¼è¿½å°‹çš„é¦™æ°£',
    tabs:{ story:'æ•…äº‹æ¦‚è¦', acq:'å–å¾—æ–¹å¼', unlockq:'è§£é–ä»»å‹™', followq:'å¾ŒçºŒä»»å‹™', comments:'ç•™è¨€' },
    readMore:'å±•é–‹å…¨æ–‡', readLess:'æ”¶åˆå…§å®¹',
    story:`<div class="clamp" data-collapsed="true">
      <p>äººç”Ÿæœ‰æ™‚å°±æ˜¯é€™éº¼å«äººæªæ‰‹ä¸åŠã€‚Shamani Lohmani è«‡èµ·è‡ªå·±çš„éå»æ™‚èªæ°£å¹³éœâ€”â€”ä»–ä¸€ç›´éƒ½å°è‘¡è„é…’æ‡·æœ‰ç†±æƒ…ï¼Œåªæ˜¯ç›´åˆ°è¢«è¿«é€€ä¼‘ä¹‹å¾Œï¼Œä»–æ‰çµ‚æ–¼èƒ½æŠŠé€™ä»½ç†±æ„›å¾èˆˆè¶£æ¨é€²åˆ°çœŸæ­£æƒ³èµ°çš„é“è·¯ã€‚</p>
      <p>ä»–ä¹Ÿä¸é¿è«±åœ°èªªæ˜ï¼šè‹¥ä¸æ˜¯ç•¶å¹´ä»¥å‚­å…µèº«åˆ†ç´¯ç©ä¸‹ä¾†çš„å­˜æ¬¾ï¼Œé€™æ¢è·¯æ ¹æœ¬ä¸å¯èƒ½é–‹å§‹ã€‚é‚£ä»½å·¥ä½œæ€§è³ªæˆ–è¨±æƒ¹äººéè­°ï¼Œä½†æ”¶å…¥ç¢ºå¯¦è±åšâ€”â€”è€Œå¦‚ä»Šï¼Œæ­£æ˜¯é‚£ç­†éŒ¢åœ¨æ”¯æ’ä»–çš„é¸æ“‡ã€‚</p>
      <p>ç„¶è€Œï¼Œä½ çš„ç„¦èºå¾ˆå¿«æŠŠè©±é¡Œæ‹‰å›çœ¼å‰ã€‚Shamani Lohmani æ³¨æ„åˆ°ä½ å·²ç¶“æŒ‰æºä¸ä½ï¼Œä¾¿æèµ· Wheiskaet æ­£ç­‰è‘—é…’ä¸Šæ¡Œï¼Œä¹Ÿå› æ­¤é»å‡ºäº†çœ¼ä¸‹æœ€å¤§çš„å•é¡Œï¼šä»–æ‰‹é‚Šæ²’æœ‰ä»»ä½•ä¸€ç“¶ï¼Œé…å¾—ä¸Šé€™æ¬¡çš„å ´é¢ã€‚</p>
      <p>ä»–å‘Šè¨´ä½ ï¼ŒåŸè£¡æœ€å¥½çš„å¹´ä»½é…’éƒ½è¢« Byrglaent å›¤è‘—â€”â€”é‚£äººæŒæ¡è‘— Vylbrand ä¸Šè¦æ¨¡æœ€å¤§çš„é…’èŠï¼Œç”Ÿæ„èˆ‡åè²éƒ½ä¸å®¹å°è¦·ã€‚Shamani Lohmani ç›´è¦ºå°æ–¹ä¸æœƒé¡˜æ„é…åˆä½ çš„è«‹æ±‚ï¼Œä½†åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œä¹Ÿåªèƒ½ç¡¬è‘—é ­çš®å»æ±‚ä»–å¹«å¿™ã€‚</p>
      <p>ä½ å‰å»æ‹œè¨ª Byrglaent æ™‚ï¼Œä»–æ­£å› ä¸€ç“¶é…’çš„é›œè³ªè€Œæš´æ€’ï¼Œæ–¥è²¬é‚£é…’å¹¾ä¹é›£ä»¥ä¸‹åš¥ï¼Œç”šè‡³æšè¨€è™•ç†è²¬ä»»äººéƒ½å«Œå¤ªä¾¿å®œï¼Œæ‡‰è©²é€¼å°æ–¹æŠŠé‚£ã€Œæ±™æ¿çš„åŠ£é…’ã€ä¸€æ»´ä¸å‰©å–å®Œã€‚ä½ çš„åˆ°ä¾†åªæ›ä¾†æ›´ä¸è€ç…©çš„é©…è¶•â€”â€”ä»–å˜²ç¬‘ Shamani Lohmani æ´¾ä½ ä¾†èªªæƒ…ï¼Œä¹Ÿæ–·è¨€ä½ èˆ‡ä½ çš„åŒä¼´æ ¹æœ¬æ²’æœ‰å‘³è¦ºå»ç†è§£ä»–ç§è—é…’çš„ç´°ç·»ï¼Œæœ€å¾Œæ›´å†·é…·åœ°æ”¾è©±ï¼šèˆ‡å…¶æŠŠæœ€å·®çš„å¹´ä»½é…’è³£çµ¦ä½ ï¼Œä»–å¯§å¯ç«¯ä¸Š goobbue çš„å°¿ã€‚ä½ å¸¶è‘—é€™æ¨£çš„æ‹’çµ•å›å»ï¼ŒShamani Lohmani åªæ˜¯å•ä½ ä»–æ˜¯ä¸æ˜¯èªªäº†ã€Œä¸ã€ï¼Œæ¥è‘—åœ¨è½è¦‹åŸè©±å¾Œä¸¦ä¸æ„å¤–â€”â€”ä»–æ‰¿èªé‚£ä½ä¾†è‡ª Limsa Lominsa çš„ã€ŒWine Baronã€ç¢ºå¯¦æœ‰ç†±æƒ…ä¹Ÿæœ‰æœ¬äº‹ï¼Œä½†å¾ä¾†ä¸æ˜¯å€‹æ‡‚å¾—å®¢æ°£çš„äººã€‚æ–¼æ˜¯ï¼Œä»–å‘Šè¨´ä½ ï¼šæ¥ä¸‹ä¾†åªèƒ½æ›ä¸€æ¢è·¯èµ°äº†ã€‚</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>ä»»å‹™ç™¼å¸ƒ</b> å¤é¦¬å°¼ãƒ»æ´›é¦¬å°¼ã€€<small class="muted">æ‹‰è«¾è¥¿äºæ±éƒ¨ (X:21.6, Y:21.1)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="what-do-you-mean-you-forgot-the-wine.html">ç››å®´æ€èƒ½å°‘ç¾é…’</a></div>
      <div class="row">æ‰€æœ‰è·æ¥­ï¼ˆä¸å«é™å®šè·ï¼‰ ç­‰ç´š 32 ä»¥ä¸Š</div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="it-wont-work.html">å°‹è¨ªå¤±è½çš„å‚³èªª</a></div>
    </div>`
  }
};

const langToggle  = document.getElementById('langToggle');
const pageTitle   = document.getElementById('pageTitle');
const tabBtns     = [...document.querySelectorAll('.tab-btn')];
const panels = {
  story:  document.getElementById('panel-story'),
  acq:    document.getElementById('panel-acq'),
  unlockq:document.getElementById('panel-unlockq'),
  followq:document.getElementById('panel-followq'),
  comments: document.getElementById('panel-comments')
};

function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }
function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `ğŸŒ ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}

function wireClamp(panelEl, t){
  const clamp = panelEl.querySelector('.clamp');
  const btn = panelEl.querySelector('[data-role="expand"]');
  if(!clamp || !btn) return;
  function setLabel(){
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    btn.textContent = collapsed ? t.readMore : t.readLess;
  }
  setLabel();
  btn.addEventListener('click', ()=>{
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    clamp.setAttribute('data-collapsed', collapsed ? 'false' : 'true');
    setLabel();
  });
}

function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  if (key !== 'comments') panels[key].innerHTML = t[key];
  if (key === 'story') wireClamp(panels[key], t);
  if (key === 'comments') loadGiscusForCurrentLang();
}

tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});

langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem(LANG_KEY, next);
  applyLang(next);
});

applyLang(getLang());

const GISCUS_CFG = {
  repo: 'BELAUG-FFXIV/FFXIV_Library',
  repoId: 'R_kgDOPyh4Kw',
  category: 'General',
  categoryId: 'DIC_kwDOPyh4K84CwPjL',
  theme: 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  mount.innerHTML = '';
  const langCode = getLang();
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + 'ï½œ' + langCode);
  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;
  mount.appendChild(s);
}
</script>
</body>
</html>
