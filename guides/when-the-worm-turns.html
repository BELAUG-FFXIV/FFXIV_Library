<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>When the Worm Turns | BELAUG Â· FFXIV Library</title>
  <meta name="description" content="MSQ â€“ When the Worm Turns (ARR Patch 2.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:var(--fg);border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}
    /* å±•é–‹/æ”¶åˆ */
    .clamp{position:relative; max-height:360px; overflow:hidden}
    .clamp[data-collapsed="false"]{max-height:none}
    .clamp[data-collapsed="true"]::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:72px;
      background:linear-gradient(to bottom, rgba(255,255,255,0), var(--card)); pointer-events:none;
    }
    .expand-wrap{ margin-top:12px; }
    .expand-btn{
      display:inline-block; padding:8px 14px; border-radius:10px;
      background:var(--card); border:1px solid var(--border); cursor:pointer; font-weight:600;
    }
    .expand-btn:hover{ background:#fffef8; }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">ğŸ  Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="åˆ‡æ›èªè¨€">ğŸŒ EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <!-- å·¦ï¼šå½±ç‰‡ -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/28BttoU71WU"
              title="When the Worm Turns" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- å³ï¼šæ¨™é¡Œ + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">When the Worm Turns</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story"   class="tab-panel active"></div>
          <div id="panel-acq"     class="tab-panel"></div>
          <div id="panel-unlockq" class="tab-panel"></div>
          <div id="panel-followq" class="tab-panel"></div>
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const LANG_KEY = 'ffxiv-guide-lang';
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:'When the Worm Turns',
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    readMore:'Show more', readLess:'Show less',
    story:`<div class="clamp" data-collapsed="true">
      <p>Uâ€™odh Nunh muses that itâ€™s a pity you didnâ€™t meet when he still marched with the Company of Heroesâ€”youâ€™d have made a fine recruit. But thereâ€™s no use dwelling on what canâ€™t be changed. Your quarry is the Wellwick worm: sandworms roam the dunes openly, yet Wellwicks are rare, and rarity makes for prized delicacies. To catch one, youâ€™ll need bait it cannot resist. In the Sagolii, these worms prey on smaller creatures; a freshly slaughtered angler carcass will do. He marks two places on your mapâ€”an eastern stretch teeming with anglers, and another where Wellwicks are most often sightedâ€”and warns that blood will drive the worm into a feeding frenzy. If your skills are lacking, youâ€™ll be devoured alongside your bait.</p>
      <p>You return with your prize. Uâ€™odh Nunh weighs the meat and nodsâ€”your hunting rivals the best of his people. It must be heavily smoked before he ships it to Wheiskaet, but he gives his word it will reach Costa del Sol in time for the banquet. As for the third ingredient, he knows nothing; for now, return to Wheiskaet for counsel. One more thing: since youâ€™ll see the captain soon, he has something he wishes you to deliver.</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> Uâ€™odh Nunh <small class="muted">(Southern Thanalan, X:14.3, Y:29.9)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="the-perfect-prey.html">The Perfect Prey</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="there-and-back-again.html">There and Back Again</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'ãƒ©ãƒ ãƒˆãƒ³ã‚¦ã‚©ãƒ¼ãƒ ã®è‚‰',
    tabs:{ story:'ã‚¹ãƒˆãƒ¼ãƒªãƒ¼', acq:'å…¥æ‰‹æ–¹æ³•', unlockq:'é–‹æ”¾ã‚¯ã‚¨ã‚¹ãƒˆ', followq:'å¾Œç¶šã‚¯ã‚¨ã‚¹ãƒˆ', comments:'ã‚³ãƒ¡ãƒ³ãƒˆ' },
    readMore:'å…¨æ–‡ã‚’è¡¨ç¤º', readLess:'æŠ˜ã‚ŠãŸãŸã‚€',
    story:`<div class="clamp" data-collapsed="true">
      <p>ã‚¦ãƒ»ã‚ªãƒ‰ãƒ»ãƒŒãƒ³ã¯ã€è‹¥ãæ—¥ã«æµ·é›„æ—…å›£ã«ã„ãŸé ƒã«å·¡ã‚Šä¼šãˆã¦ã„ã‚Œã°ã€ãŠã¾ãˆã¯è¦‹äº‹ãªæ–°å…µã«ãªã£ã¦ã„ãŸã‚ã†ã¨å‘Ÿãã€‚ã ãŒéå»ã‚’æƒœã—ã‚“ã§ã‚‚å§‹ã¾ã‚‰ãªã„ã€‚ç‹™ã†ã¯ã‚¦ã‚§ãƒ«ã‚¦ã‚£ãƒƒã‚¯ãƒ¯ãƒ¼ãƒ ã ã€‚ç ‚æ¼ ã‚’ã®ãŸã†ã¤ç ‚è™«ã¯å¤šã„ãŒã€ã‚¦ã‚§ãƒ«ã‚¦ã‚£ãƒƒã‚¯ã¯ç¨€å°‘â€•â€•ã‚†ãˆã«ãã®è‚‰ã¯çå‘³ã¨ã—ã¦çé‡ã•ã‚Œã‚‹ã€‚ä»•ç•™ã‚ã‚‹ã«ã¯ã€æŠ—ãˆãªã„é¤Œã§ãŠã³ãå¯„ã›ã‚‹ã“ã¨ã€‚ã‚µã‚´ãƒªãƒ¼ã§ã¯ã€ã“ã®è™«ã¯å°å‹ã®ç²ç‰©ã‚’æ•é£Ÿã™ã‚‹ã€‚æ–°é®®ãªå±è‚‰â€•â€•ãŸã¨ãˆã°æ–ƒã—ãŸã°ã‹ã‚Šã®ç²ç‰©ãŒã‚ˆã„ã€‚æ±æ–¹ã«ç²ç‰©ã®ç¾¤ã‚Œã‚‹å ´æ‰€ã¨ã€ã‚¦ã‚§ãƒ«ã‚¦ã‚£ãƒƒã‚¯ã®å‡ºæ²¡åœ°ã‚’åœ°å›³ã«è¨˜ã—ã¦ãã‚Œã‚‹ãŒã€è¡€ã®åŒ‚ã„ã¯å¥´ã‚’ç‹‚å¥”ã•ã›ã‚‹ã¨å¿µã‚’æŠ¼ã™ã€‚è…•ãŒè¶³ã‚Šã­ã°ã€é¤Œã¨ä¸€ç·’ã«å‘‘ã¾ã‚Œã‚‹ã ã‘ã ã€‚</p>
      <p>ã‚„ãŒã¦ç²ç‰©ã‚’æºãˆã¦æˆ»ã‚‹ã¨ã€ã‚¦ãƒ»ã‚ªãƒ‰ãƒ»ãƒŒãƒ³ã¯æº€è¶³ã’ã«é ·ãã€‚çŒŸå¸«ã¨ã—ã¦ã®è…•å‰ã¯åŒèƒã®ç²¾é‹­ã«ä¸¦ã¶ã€ã¨ã€‚è‚‰ã¯ç‡»ã—ã‚’å¼·ãã‹ã‘ã¦ã‹ã‚‰ãƒ´ã‚§ã‚¤ã‚¹ã‚±ãƒ¼ãƒˆã¸é€ã‚‹ã‚†ãˆã€ã‚³ã‚¹ã‚¿ãƒ»ãƒ‡ãƒ«ãƒ»ã‚½ãƒ«ã®å®´ã«ã‚‚é…ã‚Œã¯å–ã‚‰ã›ã¬ã¨ã„ã†ã€‚ä¸‰ã¤ç›®ã®é£Ÿæã«ã¤ã„ã¦ã¯çŸ¥ã‚‰ã¬ã‚†ãˆã€å½“é¢ã¯éšŠé•·ã«ç›¸è«‡ã—ã¦ã“ã„ã€ã¨ç¶šã‘ã‚‹ã€‚â€•â€•ãã‚Œã‹ã‚‰ã‚‚ã†ä¸€ã¤ã€‚ã¾ã‚‚ãªãéšŠé•·ã«ä¼šã†ã®ãªã‚‰ã€å½¼ã«è¨—ã—ãŸã„å“ãŒã‚ã‚‹ã€ã¨ã€‚</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>ã‚¯ã‚¨ã‚¹ãƒˆç™ºè¡Œ</b> ã‚¦ãƒ»ã‚ªãƒ‰ãƒ»ãƒŒãƒ³ã€€å—ã‚¶ãƒŠãƒ©ãƒ¼ãƒ³ <small class="muted">(X:14.3, Y:29.9)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="the-perfect-prey.html">ã‚¦æ—ã®è©¦ç·´</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="there-and-back-again.html">æ€ã„å‡ºã®åœŸç”£é…’</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'ç•¶å±€å‹¢é€†è½‰',
    tabs:{ story:'æ•…äº‹æ¦‚è¦', acq:'å–å¾—æ–¹å¼', unlockq:'è§£é–ä»»å‹™', followq:'å¾ŒçºŒä»»å‹™', comments:'ç•™è¨€' },
    readMore:'å±•é–‹å…¨æ–‡', readLess:'æ”¶åˆå…§å®¹',
    story:`<div class="clamp" data-collapsed="true">
      <p>Uâ€™odh Nunh èªªè‹¥åœ¨ä»–é‚„åœ¨ Company of Heroes çš„å¹´ä»£é‡è¦‹ä½ ï¼Œä½ æœƒæ˜¯ä¸Šå¥½çš„äººé¸ã€‚ä½†éå»ç„¡å¯æŒ½å›â€”â€”ä½ ç¾åœ¨è¦çµçš„æ˜¯ Wellwick wormã€‚æ²™æ¼ ä¸­çš„ sandworm éš¨è™•å¯è¦‹ï¼ŒWellwick å»ç¨€æœ‰ï¼Œå› è€Œå…¶è‚‰è¢«è¦–ç‚ºçé¥ˆã€‚è¦å¼•å®ƒç¾èº«ï¼Œå¿…é ˆç”¨å®ƒç„¡æ³•æŠ—æ‹’çš„é¤Œã€‚é€™äº›èŸ²åœ¨ Sagolii æ•é£Ÿå°å‹ç”Ÿç‰©ï¼›ä¸€å…·å‰›å‰›å®°ä¸‹çš„ angler å±é«”æœ€åˆé©ã€‚ä»–åœ¨ä½ çš„åœ°åœ–ä¸Šæ¨™å‡ºå…©è™•ï¼šæ±é‚Šå……æ»¿ anglers çš„åœ°å¸¶ï¼Œä»¥åŠ Wellwick æœ€å¸¸å‡ºæ²’çš„ä½ç½®ï¼›åŒæ™‚è­¦å‘Šè¡€è…¥æœƒè®“ç‰ é™·å…¥è¦“é£Ÿç‹‚ç†±â€”â€”è‹¥èº«æ‰‹ä¸æ¿Ÿï¼Œä½ æœƒé€£åŒé¤Œä¸€èµ·è¢«åä¸‹ã€‚</p>
      <p>ä½ å¸¶å›çµç‰©ã€‚Uâ€™odh Nunh ç«¯è©³é‚£å¡Šè‚‰ï¼Œè®šè³ä½ çš„ç‹©çµæœ¬äº‹å·²èˆ‡æ—ä¸­å¥½æ‰‹æ¯”è‚©ã€‚é€™è‚‰å¿…é ˆé‡åº¦ç…™ç‡»ï¼Œä»–æœƒå†å¯„çµ¦ Wheiskaetï¼Œä¿è­‰èƒ½è¶•ä¸Š Costa del Sol çš„å®´å¸­ã€‚è‡³æ–¼ç¬¬ä¸‰æ¨£ææ–™ï¼Œä»–ä¸€ç„¡æ‰€çŸ¥ï¼›æš«æ™‚è¿”å› Wheiskaet é‚£è£¡è«‹ç¤ºã€‚è‡¨èµ°å‰ï¼Œä»–æƒ³èµ·ä¸€äº‹ï¼šæ—¢ç„¶ä½ å¾ˆå¿«æœƒè¦‹åˆ°éšŠé•·ï¼Œè«‹é †é“æ›¿ä»–è½‰äº¤ä¸€æ¨£æ±è¥¿ã€‚</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>ä»»å‹™ç™¼å¸ƒ</b> çƒãƒ»æ­å¾·ãƒ»åŠªæ©ã€€è–©ç´è˜­å—éƒ¨ <small class="muted">(X:14.3, Y:29.9)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="the-perfect-prey.html">å®Œç¾çš„çµç‰©</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="there-and-back-again.html">å¸¶è‘—å›æ†¶æ­¸ä¾†çš„é…’</a></div>
    </div>`
  }
};

const langToggle  = document.getElementById('langToggle');
const pageTitle   = document.getElementById('pageTitle');
const tabBtns     = [...document.querySelectorAll('.tab-btn')];
const panels = {
  story:  document.getElementById('panel-story'),
  acq:    document.getElementById('panel-acq'),
  unlockq:document.getElementById('panel-unlockq'),
  followq:document.getElementById('panel-followq'),
  comments: document.getElementById('panel-comments')
};

function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }
function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `ğŸŒ ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}

function wireClamp(panelEl, t){
  const clamp = panelEl.querySelector('.clamp');
  const btn = panelEl.querySelector('[data-role="expand"]');
  if(!clamp || !btn) return;
  function setLabel(){
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    btn.textContent = collapsed ? t.readMore : t.readLess;
  }
  setLabel();
  btn.addEventListener('click', ()=>{
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    clamp.setAttribute('data-collapsed', collapsed ? 'false' : 'true');
    setLabel();
  });
}

function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  if (key !== 'comments') panels[key].innerHTML = t[key];
  if (key === 'story') wireClamp(panels[key], t);
  if (key === 'comments') loadGiscusForCurrentLang();
}

tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});

langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem(LANG_KEY, next);
  applyLang(next);
});

applyLang(getLang());

/* === Giscusï¼šComments åˆ†é  === */
const GISCUS_CFG = {
  repo: 'BELAUG-FFXIV/FFXIV_Library',
  repoId: 'R_kgDOPyh4Kw',
  category: 'General',
  categoryId: 'DIC_kwDOPyh4K84CwPjL',
  theme: 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  mount.innerHTML = '';
  const langCode = getLang();
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + 'ï½œ' + langCode);
  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;
  mount.appendChild(s);
}
</script>
</body>
</html>
