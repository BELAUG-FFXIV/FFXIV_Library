<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>When the Worm Turns | BELAUG · FFXIV Library</title>
  <meta name="description" content="MSQ – When the Worm Turns (ARR Patch 2.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:var(--fg);border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}
    /* 展開/收合 */
    .clamp{position:relative; max-height:360px; overflow:hidden}
    .clamp[data-collapsed="false"]{max-height:none}
    .clamp[data-collapsed="true"]::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:72px;
      background:linear-gradient(to bottom, rgba(255,255,255,0), var(--card)); pointer-events:none;
    }
    .expand-wrap{ margin-top:12px; }
    .expand-btn{
      display:inline-block; padding:8px 14px; border-radius:10px;
      background:var(--card); border:1px solid var(--border); cursor:pointer; font-weight:600;
    }
    .expand-btn:hover{ background:#fffef8; }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">🏠 Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="切換語言">🌐 EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <!-- 左：影片 -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/28BttoU71WU"
              title="When the Worm Turns" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- 右：標題 + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">When the Worm Turns</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story"   class="tab-panel active"></div>
          <div id="panel-acq"     class="tab-panel"></div>
          <div id="panel-unlockq" class="tab-panel"></div>
          <div id="panel-followq" class="tab-panel"></div>
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const LANG_KEY = 'ffxiv-guide-lang';
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:'When the Worm Turns',
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    readMore:'Show more', readLess:'Show less',
    story:`<div class="clamp" data-collapsed="true">
      <p>U’odh Nunh muses that it’s a pity you didn’t meet when he still marched with the Company of Heroes—you’d have made a fine recruit. But there’s no use dwelling on what can’t be changed. Your quarry is the Wellwick worm: sandworms roam the dunes openly, yet Wellwicks are rare, and rarity makes for prized delicacies. To catch one, you’ll need bait it cannot resist. In the Sagolii, these worms prey on smaller creatures; a freshly slaughtered angler carcass will do. He marks two places on your map—an eastern stretch teeming with anglers, and another where Wellwicks are most often sighted—and warns that blood will drive the worm into a feeding frenzy. If your skills are lacking, you’ll be devoured alongside your bait.</p>
      <p>You return with your prize. U’odh Nunh weighs the meat and nods—your hunting rivals the best of his people. It must be heavily smoked before he ships it to Wheiskaet, but he gives his word it will reach Costa del Sol in time for the banquet. As for the third ingredient, he knows nothing; for now, return to Wheiskaet for counsel. One more thing: since you’ll see the captain soon, he has something he wishes you to deliver.</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> U’odh Nunh <small class="muted">(Southern Thanalan, X:14.3, Y:29.9)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="the-perfect-prey.html">The Perfect Prey</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="there-and-back-again.html">There and Back Again</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'ラムトンウォームの肉',
    tabs:{ story:'ストーリー', acq:'入手方法', unlockq:'開放クエスト', followq:'後続クエスト', comments:'コメント' },
    readMore:'全文を表示', readLess:'折りたたむ',
    story:`<div class="clamp" data-collapsed="true">
      <p>ウ・オド・ヌンは、若き日に海雄旅団にいた頃に巡り会えていれば、おまえは見事な新兵になっていたろうと呟く。だが過去を惜しんでも始まらない。狙うはウェルウィックワームだ。砂漠をのたうつ砂虫は多いが、ウェルウィックは稀少――ゆえにその肉は珍味として珍重される。仕留めるには、抗えない餌でおびき寄せること。サゴリーでは、この虫は小型の獲物を捕食する。新鮮な屍肉――たとえば斃したばかりの獲物がよい。東方に獲物の群れる場所と、ウェルウィックの出没地を地図に記してくれるが、血の匂いは奴を狂奔させると念を押す。腕が足りねば、餌と一緒に呑まれるだけだ。</p>
      <p>やがて獲物を携えて戻ると、ウ・オド・ヌンは満足げに頷く。猟師としての腕前は同胞の精鋭に並ぶ、と。肉は燻しを強くかけてからヴェイスケートへ送るゆえ、コスタ・デル・ソルの宴にも遅れは取らせぬという。三つ目の食材については知らぬゆえ、当面は隊長に相談してこい、と続ける。――それからもう一つ。まもなく隊長に会うのなら、彼に託したい品がある、と。</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>クエスト発行</b> ウ・オド・ヌン　南ザナラーン <small class="muted">(X:14.3, Y:29.9)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="the-perfect-prey.html">ウ族の試練</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="there-and-back-again.html">思い出の土産酒</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'當局勢逆轉',
    tabs:{ story:'故事概要', acq:'取得方式', unlockq:'解鎖任務', followq:'後續任務', comments:'留言' },
    readMore:'展開全文', readLess:'收合內容',
    story:`<div class="clamp" data-collapsed="true">
      <p>U’odh Nunh 說若在他還在 Company of Heroes 的年代遇見你，你會是上好的人選。但過去無可挽回——你現在要獵的是 Wellwick worm。沙漠中的 sandworm 隨處可見，Wellwick 卻稀有，因而其肉被視為珍饈。要引它現身，必須用它無法抗拒的餌。這些蟲在 Sagolii 捕食小型生物；一具剛剛宰下的 angler 屍體最合適。他在你的地圖上標出兩處：東邊充滿 anglers 的地帶，以及 Wellwick 最常出沒的位置；同時警告血腥會讓牠陷入覓食狂熱——若身手不濟，你會連同餌一起被吞下。</p>
      <p>你帶回獵物。U’odh Nunh 端詳那塊肉，讚賞你的狩獵本事已與族中好手比肩。這肉必須重度煙燻，他會再寄給 Wheiskaet，保證能趕上 Costa del Sol 的宴席。至於第三樣材料，他一無所知；暫時返回 Wheiskaet 那裡請示。臨走前，他想起一事：既然你很快會見到隊長，請順道替他轉交一樣東西。</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>任務發布</b> 烏・歐德・努恩　薩納蘭南部 <small class="muted">(X:14.3, Y:29.9)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="the-perfect-prey.html">完美的獵物</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="there-and-back-again.html">帶著回憶歸來的酒</a></div>
    </div>`
  }
};

const langToggle  = document.getElementById('langToggle');
const pageTitle   = document.getElementById('pageTitle');
const tabBtns     = [...document.querySelectorAll('.tab-btn')];
const panels = {
  story:  document.getElementById('panel-story'),
  acq:    document.getElementById('panel-acq'),
  unlockq:document.getElementById('panel-unlockq'),
  followq:document.getElementById('panel-followq'),
  comments: document.getElementById('panel-comments')
};

function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }
function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `🌐 ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}

function wireClamp(panelEl, t){
  const clamp = panelEl.querySelector('.clamp');
  const btn = panelEl.querySelector('[data-role="expand"]');
  if(!clamp || !btn) return;
  function setLabel(){
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    btn.textContent = collapsed ? t.readMore : t.readLess;
  }
  setLabel();
  btn.addEventListener('click', ()=>{
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    clamp.setAttribute('data-collapsed', collapsed ? 'false' : 'true');
    setLabel();
  });
}

function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  if (key !== 'comments') panels[key].innerHTML = t[key];
  if (key === 'story') wireClamp(panels[key], t);
  if (key === 'comments') loadGiscusForCurrentLang();
}

tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});

langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem(LANG_KEY, next);
  applyLang(next);
});

applyLang(getLang());

/* === Giscus：Comments 分頁 === */
const GISCUS_CFG = {
  repo: 'BELAUG-FFXIV/FFXIV_Library',
  repoId: 'R_kgDOPyh4Kw',
  category: 'General',
  categoryId: 'DIC_kwDOPyh4K84CwPjL',
  theme: 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  mount.innerHTML = '';
  const langCode = getLang();
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + '｜' + langCode);
  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;
  mount.appendChild(s);
}
</script>
</body>
</html>
