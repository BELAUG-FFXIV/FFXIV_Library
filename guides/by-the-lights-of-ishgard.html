<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>By the Lights of Ishgard | BELAUG Â· FFXIV Library</title>
  <meta name="description" content="MSQ â€“ By the Lights of Ishgard (ARR Patch 2.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:var(--fg);border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}
    .clamp{position:relative; max-height:360px; overflow:hidden}
    .clamp[data-collapsed="false"]{max-height:none}
    .clamp[data-collapsed="true"]::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:72px;
      background:linear-gradient(to bottom, rgba(255,255,255,0), var(--card)); pointer-events:none;
    }
    .expand-wrap{ margin-top:12px; }
    .expand-btn{
      display:inline-block; padding:8px 14px; border-radius:10px;
      background:var(--card); border:1px solid var(--border); cursor:pointer; font-weight:600;
    }
    .expand-btn:hover{ background:#fffef8; }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">ğŸ  Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="åˆ‡æ›èªè¨€">ğŸŒ EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <!-- å·¦ï¼šå½±ç‰‡ -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/ApYeOq0aHNI"
              title="By the Lights of Ishgard" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- å³ï¼šæ¨™é¡Œ + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">By the Lights of Ishgard</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story"   class="tab-panel active"></div>
          <div id="panel-acq"     class="tab-panel"></div>
          <div id="panel-unlockq" class="tab-panel"></div>
          <div id="panel-followq" class="tab-panel"></div>
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:'By the Lights of Ishgard',
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    readMore:'Show more', readLess:'Show less',
    story:`<div class="clamp" data-collapsed="true">
      <p>Alphinaud tells you something about the wounded knightâ€™s story will not sit right with him. The man said he fell while chasing a figure he glimpsed outside the eastern gateâ€”but that detail immediately strikes Alphinaud as strange.</p>
      <p>He points out that the main road leads to the southwestern gate, not the eastern one. Since your arrival at Whitebrim Front, you have not seen travelers coming in by the eastern gate at all. And the knight claimed he saw a â€œsilhouette illuminated by the light of the city,â€ which would mean the figure was north of the eastern gate, not south.</p>
      <p>Yet Alphinaud insists that cannot be trueâ€”beyond that direction lies nothing but a deep chasm. If Ser Joellaut is not misremembering, then the inquisitorâ€™s movements that night make no sense. Alphinaud asks you to retrace the supposed route, hoping the ground itself will explain what the testimony cannot.</p>
      <p>As you follow the trail, the air begins to crackle with aetherial energies, a faint warning that something has been disturbed. When you return, Alphinaud looks at you sharply, certain you have found something, and demands you show him at once.</p>
      <p>Reading what you recovered, Alphinaud concludes you have just met the real Inquisitor Guillaimeâ€”newly arrived in Coerthas, and murdered on the very day he came. He explains how easy it would have been for someone else to assume the title; even if the man behaved oddly, who would dare question the wisdom of a papal appointment? The document proves beyond dispute that the â€œinquisitorâ€ you have dealt with is an impostor, but his true identityâ€”and his reasons for opposing youâ€”remain unknown. Alphinaud urges you to move quickly, before the impostor learns his deception has been uncovered.</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> Alphinaud <small class="muted">Coerthas Central Highlands (X:12.7, Y:16.5)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="influencing-inquisitors.html">Influencing Inquisitors</a></div>
      <div class="row">All classes and jobs (excluding limited jobs) (Level 40 or above)</div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="blood-for-blood.html">Blood for Blood</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'æ²ˆé»™ã™ã‚‹çœŸå®Ÿ',
    tabs:{ story:'ã‚¹ãƒˆãƒ¼ãƒªãƒ¼', acq:'å…¥æ‰‹æ–¹æ³•', unlockq:'é–‹æ”¾ã‚¯ã‚¨ã‚¹ãƒˆ', followq:'å¾Œç¶šã‚¯ã‚¨ã‚¹ãƒˆ', comments:'ã‚³ãƒ¡ãƒ³ãƒˆ' },
    readMore:'å…¨æ–‡ã‚’è¡¨ç¤º', readLess:'æŠ˜ã‚ŠãŸãŸã‚€',
    story:`<div class="clamp" data-collapsed="true">
      <p>ã‚¢ãƒ«ãƒ•ã‚£ãƒã¯ã€è² å‚·ã—ãŸé¨å£«ã®è¨¼è¨€ã«ã©ã†ã«ã‚‚å¼•ã£ã‹ã‹ã‚‹ç‚¹ãŒã‚ã‚‹ã¨è¨€ã£ã¦ã€ã‚ãªãŸã«ç–‘å•ã‚’æŠ•ã’ã‹ã‘ã‚‹ã€‚å½¼ã¯æ±é–€ã®å¤–ã§é—‡ã®ä¸­ã®äººå½±ã‚’è¦‹ã¦è¿½ã„ã‹ã‘ã€ãã“ã§è»¢è½ã—ãŸã®ã ã‚ã†â€•â€•ã ãŒã€ãã®ç­‹ç«‹ã¦ãŒè…‘ã«è½ã¡ãªã„ã®ã ã¨ã€‚</p>
      <p>ä¸»è¦ãªè¡—é“ãŒé€šã˜ã¦ã„ã‚‹ã®ã¯å—è¥¿é–€ã§ã‚ã£ã¦ã€æ±é–€ã§ã¯ãªã„ã€‚ã‚ãªãŸãŸã¡ãŒãƒ›ãƒ¯ã‚¤ãƒˆãƒ–ãƒªãƒ å‰å“¨åœ°ã«æ¥ã¦ã‹ã‚‰ã€æ±é–€ã‹ã‚‰æ—…äººãŒå…¥ã£ã¦ãã‚‹ã®ã‚’ä¸€åº¦ã‚‚è¦‹ã¦ã„ãªã„ã€‚ã—ã‹ã‚‚é¨å£«ã¯ã€Œè¡—ã®ç¯ã‚Šã«ç…§ã‚‰ã•ã‚ŒãŸå½±ã€ã‚’è¦‹ãŸã¨è¨€ã£ãŸã€‚ãã‚Œãªã‚‰å½±ã¯æ±é–€ã®å—ã§ã¯ãªãåŒ—å´ã«ã„ãŸã¯ãšã ã€ã¨ã‚¢ãƒ«ãƒ•ã‚£ãƒã¯è¨€ã†ã€‚</p>
      <p>ã—ã‹ã—æ±é–€ã®åŒ—å´ã«ã¯ã€æ·±ã„å³¡è°·ãŒã‚ã‚‹ã ã‘ã§äººãŒæ¥ã‚‰ã‚Œã‚‹é“ãªã©ãªã„ã€‚ã‚‚ã—ã‚¸ãƒ§ã‚¨ãƒ­ãƒ¼ãŒè¨˜æ†¶é•ã„ã‚’ã—ã¦ã„ãªã„ã®ãªã‚‰ã€ãã®å¤œã®å¯©å•å®˜ã®æŒ¯ã‚‹èˆã„ã¯ã¾ã£ãŸãç­‹ãŒé€šã‚‰ãªã„ã€‚ã ã‹ã‚‰ã“ãã‚¢ãƒ«ãƒ•ã‚£ãƒã¯ã€è¶³å–ã‚Šã‚’ãŸã©ã‚Šç›´ã›ã°ã€ã“ã®ä¸å¯è§£ã•ã«å…‰ãŒå½“ãŸã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã¨è¨€ã†ã€‚</p>
      <p>ã‚ãªãŸãŒç¾å ´ã¸å‘ã‹ã†ã¨ã€å‘¨å›²ã®ç©ºæ°—ãŒã‚¨ãƒ¼ãƒ†ãƒ«ã®åŠ›ã§ã–ã‚ã‚ãã€ã‹ã™ã‹ãªç•°å¤‰ã‚’å‘Šã’ã¦ãã‚‹ã€‚æˆ»ã£ã¦ããŸã‚ãªãŸã‚’è¦‹ã¦ã€ã‚¢ãƒ«ãƒ•ã‚£ãƒã¯ç¢ºä¿¡ã—ãŸã‚ˆã†ã«è¨€ã†â€•â€•ä½•ã‹è¦‹ã¤ã‘ãŸã®ã ã‚ã†ã€ã‚‚ã£ãŸã„ã¶ã‚‰ãšã«è¦‹ã›ã¦ãã‚Œã€ã¨ã€‚</p>
      <p>ã‚ãªãŸãŒæŒã¡å¸°ã£ãŸå›å‹…ã‚’èª­ã¿ã€ã‚¢ãƒ«ãƒ•ã‚£ãƒã¯çµè«–ã‚’ä¸‹ã™ã€‚ã‚ãªãŸã¯çœŸã®ã‚®ãƒ¨ãƒ¼ãƒ å¯©å•å®˜ã®ç—•è·¡ã«è§¦ã‚ŒãŸã®ã â€•â€•å½¼ã¯ã‚¯ãƒ«ã‚¶ã‚¹ã«èµ´ä»»ã—ãŸãã®æ—¥ã«æ®ºã•ã‚Œã¦ã„ãŸã®ã ã¨ã€‚ãªã‚‰ã°è‚©æ›¸ãã‚’é¨™ã‚‹ã®ã¯å®¹æ˜“ã ã£ãŸã¯ãšã ã—ã€ãŸã¨ãˆè¨€å‹•ã«ä¸å¯©ãªç‚¹ãŒã‚ã£ã¦ã‚‚ã€æ•™çš‡ã®ä»»å‘½ã«ç•°ã‚’å”±ãˆã‚‹è€…ãªã©ã„ãªã„ã€‚ã“ã‚Œã§ã€ã„ã¾ã®å¯©å•å®˜ãŒå½è€…ã§ã‚ã‚‹ã“ã¨ã¯å‹•ã‹ã¬è¨¼æ‹ ã¨ãªã£ãŸã€‚ã ãŒã€ãã®æ­£ä½“ã¨ã€ãªãœã‚ãªãŸãŸã¡ã«æ•µå¯¾ã™ã‚‹ã®ã‹ã¯ã¾ã åˆ†ã‹ã‚‰ãªã„ã€‚ã‚¢ãƒ«ãƒ•ã‚£ãƒã¯æ€¥ã’ã¨è¨€ã†â€•â€•æ¬ºçãŒéœ²è¦‹ã—ãŸã¨ç›¸æ‰‹ã«æ°—ã¥ã‹ã‚Œã‚‹å‰ã«ã€‚</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>ã‚¯ã‚¨ã‚¹ãƒˆç™ºè¡Œ</b> ã‚¢ãƒ«ãƒ•ã‚£ãƒã€€<small class="muted">ã‚¯ãƒ«ã‚¶ã‚¹ä¸­å¤®é«˜åœ° (X:12.7, Y:16.5)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="influencing-inquisitors.html">å¯©å•å®˜ã‚®ã‚¤ã‚§ãƒ¼ãƒ ã®æ¨ªé¡”</a></div>
      <div class="row">ã™ã¹ã¦ï¼ˆãƒªãƒŸãƒ†ãƒƒãƒ‰ã‚¸ãƒ§ãƒ–ã‚’é™¤ãï¼‰Lv 40ï½</div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="blood-for-blood.html">å¹é›ªã®å¤œã®è¿½æƒ³</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'Ishgard ç‡ˆç«ä¹‹ä¸‹ï¼Œæ²‰é»˜çš„çœŸç›¸',
    tabs:{ story:'æ•…äº‹æ¦‚è¦', acq:'å–å¾—æ–¹å¼', unlockq:'è§£é–ä»»å‹™', followq:'å¾ŒçºŒä»»å‹™', comments:'ç•™è¨€' },
    readMore:'å±•é–‹å…¨æ–‡', readLess:'æ”¶åˆå…§å®¹',
    story:`<div class="clamp" data-collapsed="true">
      <p>Alphinaud å‘Šè¨´ä½ ï¼Œä»–å°é‚£åå—å‚·é¨å£«çš„èªªæ³•æ„Ÿåˆ°ä¸å®‰ã€‚å°æ–¹è²ç¨±è‡ªå·±æ˜¯åœ¨æ±é–€å¤–çš„é»‘æš—ä¸­çœ‹è¦‹ä¸€å€‹èº«å½±ã€è¿½ä¸Šå»æ‰å¤±è¶³å¢œè½â€”â€”å¯é€™å€‹ç´°ç¯€è®“ Alphinaud æ€éº¼æƒ³éƒ½è¦ºå¾—ä¸å°å‹ã€‚</p>
      <p>ä»–æŒ‡å‡ºé€šå¾€è¦å¡çš„ä¸»è¦é“è·¯æ˜¯å—è¥¿é–€ï¼Œä¸æ˜¯æ±é–€ã€‚è‡ªå¾ä½ å€‘æŠµé” Whitebrim Front ä»¥ä¾†ï¼Œä½ å¾æœªçœ‹éæœ‰æ—…äººå¾æ±é–€é€²å‡ºã€‚æ›´ä½•æ³é‚£åé¨å£«èªªè‡ªå·±çœ‹è¦‹ã€Œè¢«åŸå…§å…‰ç·šç…§äº®çš„å‰ªå½±ã€ï¼Œé€™ä»£è¡¨é‚£å€‹èº«å½±æ‡‰è©²æ˜¯åœ¨æ±é–€çš„åŒ—å´ï¼Œè€Œä¸æ˜¯å—å´ã€‚</p>
      <p>ä½† Alphinaud èªç‚ºé€™æ ¹æœ¬èªªä¸é€šâ€”â€”å› ç‚ºæ±é–€åŒ—å´åªæœ‰ä¸€é“æ·±ä¸è¦‹åº•çš„è£‚è°·ï¼Œæ²’æœ‰ä»»ä½•æ­£å¸¸äººèƒ½å¾é‚£è£¡éä¾†ã€‚è‹¥ Ser Joellaut ä¸¦ä¸æ˜¯è¨˜éŒ¯ï¼Œé‚£éº¼é‚£ä¸€å¤œã€Œå¯©å•å®˜ã€çš„è¡Œå‹•åœ¨ä»–çœ‹ä¾†å®Œå…¨æ²’æœ‰é“ç†ã€‚Alphinaud æ–¼æ˜¯è¦ä½ æ²¿è‘—ç·šç´¢é‡æ–°èµ°ä¸€éï¼Œæˆ–è¨±èƒ½åœ¨è¶³è·¡ä¹‹ä¸­æ‰¾å‡ºçœŸç›¸ã€‚</p>
      <p>ä½ ç…§ä»–çš„æ¨æ¸¬å»è¿½æŸ¥ï¼Œé€”ä¸­ä½ æ„Ÿè¦ºå‘¨åœçš„ç©ºæ°£é–‹å§‹å› ä»¥å¤ªçš„åŠ›é‡è€ŒåŠˆå•ªä½œéŸ¿ï¼Œåƒæ˜¯åœ¨æé†’ä½ é€™è£¡æ›¾æœ‰ç•°å¸¸ç™¼ç”Ÿã€‚ç­‰ä½ å›åˆ° Alphinaud èº«é‚Šï¼Œä»–ä¸€çœ¼å°±çœ‹å‡ºä½ æœ‰æ‰€ç™¼ç¾ï¼Œè¦ä½ åˆ¥å†åŠèƒƒå£ï¼Œç«‹åˆ»æŠŠæ±è¥¿æ‹¿å‡ºä¾†ã€‚</p>
      <p>ç•¶ä»–è®€å®Œä½ å¸¶å›ä¾†çš„é€šè«­ï¼ŒAlphinaud ç«‹åˆ»åˆ¤æ–·ï¼šä½ å‰›å‰›ç­‰åŒæ–¼æ¥è§¸åˆ°ã€ŒçœŸæ­£çš„ã€Guillaime å¯©å•å®˜â€”â€”é‚£ä½å¯©å•å®˜æ‰å‰›è¢«æ´¾ä¾† Coerthasï¼Œå»åœ¨æŠµé”ç•¶å¤©å°±é­åˆ°æ®ºå®³ã€‚å¦‚æ­¤ä¸€ä¾†ï¼Œå†’åé ‚æ›¿å°±è®Šå¾—è¼•è€Œæ˜“èˆ‰ï¼›å°±ç®—æ­¤äººè¨€è¡Œæ€ªç•°ï¼Œåˆæœ‰èª°æ•¢è³ªç–‘æ•™çš‡ä»»å‘½çš„æ¬Šå¨ï¼Ÿ</p>
      <p>é€™ä»½é€šè«­å·²ç¶“ç„¡å¯ç½®ç–‘åœ°è­‰æ˜ï¼šä½ å€‘ä¸€ç›´é¢å°çš„é‚£ä½ã€Œå¯©å•å®˜ã€æ˜¯å†’ç‰Œè²¨ã€‚ç„¶è€Œä½ å€‘ä»ä¸çŸ¥é“ä»–çš„çœŸæ­£èº«åˆ†ï¼Œä¹Ÿå°šæœªå¼„æ¸…ä»–ç‚ºä½•è¦é˜»æ’“ä½ å€‘ã€‚Alphinaud å‚¬ä¿ƒä½ ç«‹åˆ»è¡Œå‹•â€”â€”åœ¨å°æ–¹å¯Ÿè¦ºè‡ªå·±çš„é¨™å±€å·²è¢«æ­ç©¿ä¹‹å‰ã€‚</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>ä»»å‹™ç™¼å¸ƒ</b> é˜¿çˆ¾è²è«¾ã€€<small class="muted">åº«çˆ¾æœ­æ–¯ä¸­å¤®é«˜åœ° (X:12.7, Y:16.5)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="influencing-inquisitors.html">Guillaime çš„çœŸé¢ç›®æµ®ç¾</a></div>
      <div class="row">æ‰€æœ‰è·æ¥­ï¼ˆä¸å«é™å®šè·ï¼‰ ç­‰ç´š 40 ä»¥ä¸Š</div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="blood-for-blood.html">å¹é›ªä¹‹å¤œçš„è¿½æ†¶ï¼Œè¡€å‚µçµ‚é ˆè¡€å„Ÿ</a></div>
    </div>`
  }
};

const tabBtns = [...document.querySelectorAll('.tab-btn')];
const pageTitle = document.getElementById('pageTitle');
const langToggle = document.getElementById('langToggle');
const panels = {
  story: document.getElementById('panel-story'),
  acq: document.getElementById('panel-acq'),
  unlockq: document.getElementById('panel-unlockq'),
  followq: document.getElementById('panel-followq'),
  comments: document.getElementById('panel-comments')
};

function getLang(){ return localStorage.getItem('ffxiv-guide-lang') || 'EN'; }

function wireClamp(panelEl, t){
  const clamp = panelEl.querySelector('.clamp');
  const btn = panelEl.querySelector('[data-role="expand"]');
  if(!clamp || !btn) return;
  function setLabel(){
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    btn.textContent = collapsed ? t.readMore : t.readLess;
  }
  setLabel();
  btn.addEventListener('click', ()=>{
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    clamp.setAttribute('data-collapsed', collapsed ? 'false' : 'true');
    setLabel();
  });
}

function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  if (key !== 'comments') panels[key].innerHTML = t[key];
  if (key === 'story') wireClamp(panels[key], t);
  if (key === 'comments') loadGiscusForCurrentLang();
}

function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `ğŸŒ ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}

tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});

langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem('ffxiv-guide-lang', next);
  applyLang(next);
});

applyLang(getLang());

const GISCUS_CFG = {
  repo: 'BELAUG-FFXIV/FFXIV_Library',
  repoId: 'R_kgDOPyh4Kw',
  category: 'General',
  categoryId: 'DIC_kwDOPyh4K84CwPjL',
  theme: 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  mount.innerHTML = '';
  const langCode = getLang();
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + 'ï½œ' + langCode);
  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;
  mount.appendChild(s);
}
</script>
</body>
</html>
