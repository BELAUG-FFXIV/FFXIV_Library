<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>That Weight | BELAUG Â· FFXIV Library</title>
  <meta name="description" content="MSQ â€“ That Weight (ARR Patch 2.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:var(--fg);border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}
    .clamp{position:relative; max-height:360px; overflow:hidden}
    .clamp[data-collapsed="false"]{max-height:none}
    .clamp[data-collapsed="true"]::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:72px;
      background:linear-gradient(to bottom, rgba(255,255,255,0), var(--card)); pointer-events:none;
    }
    .expand-wrap{ margin-top:12px; }
    .expand-btn{
      display:inline-block; padding:8px 14px; border-radius:10px;
      background:var(--card); border:1px solid var(--border); cursor:pointer; font-weight:600;
    }
    .expand-btn:hover{ background:#fffef8; }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">ğŸ  Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="åˆ‡æ›èªè¨€">ğŸŒ EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <!-- å·¦ï¼šå½±ç‰‡ -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/0LF5MXWwevI"
              title="That Weight" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- å³ï¼šæ¨™é¡Œ + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">That Weight</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story"   class="tab-panel active"></div>
          <div id="panel-acq"     class="tab-panel"></div>
          <div id="panel-unlockq" class="tab-panel"></div>
          <div id="panel-followq" class="tab-panel"></div>
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const LANG_KEY = 'ffxiv-guide-lang';
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:'That Weight',
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    readMore:'Show more', readLess:'Show less',
    story:`<div class="clamp" data-collapsed="true">
      <p>Shamani Lohmani speaks with the ease of someone who has finally found room to breathe, remarking on how delightfully unpredictable life can beâ€”how his long-held love of wine only became something he could truly pursue after circumstance forced him into retirement.</p>
      <p>He admits that it would never have happened without the savings he amassed as a mercenary. Whatever one thinks of that line of work, he says, the pay is undeniableâ€”and it is that hard-earned coin that let him turn a passion into a calling.</p>
      <p>But he sees your impatience at once, and he doesnâ€™t linger. Wheiskaet is expecting wine, and that is where the trouble lies: nothing Shamani has on hand is worthy of the occasion, not when quality is demanded rather than merely desired.</p>
      <p>The finest vintages, he explains, are hoarded by Byrglaent, the man who owns and operates the largest winery in Vylbrand. Shamani doubts the vintner will be receptive, yet with no better option, you must go and beg his assistance all the same.</p>
      <p>When you approach Byrglaent in Wineport, you find him already in a fury, raging over a bottle ruined by impurities and insisting that dismissal is too gentle for whoever produced such tainted swill. He snaps at your interruption, then laughs at the â€œneophyte vintnerâ€ who sent youâ€”declaring that neither you nor your friend has the palate to appreciate his private stock. He would sooner serve you goobbue urine than part with even his worst vintage, and he drives you away.</p>
      <p>You return to Shamani Lohmani with the refusal. He had expected as much, even if the bluntness surprises him in its own way, and he remarks that while the Wine Baron of Limsa Lominsa has passion and skill, tact has never been among his virtues. With that, Shamani steels himself and tells you the two of you will have to take an alternative approach.</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> Drest <small class="muted">Eastern La Noscea (X:14.0, Y:30.3)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="give-a-man-a-drink.html">Give a Man a Drink</a></div>
      <div class="row">All classes and jobs (excluding limited jobs) (Level 33 or above)</div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="battle-scars.html">Battle Scars</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'è€³ã«æ®‹ã‚‹ã¯èŸ²ã®éŸ³',
    tabs:{ story:'ã‚¹ãƒˆãƒ¼ãƒªãƒ¼', acq:'å…¥æ‰‹æ–¹æ³•', unlockq:'é–‹æ”¾ã‚¯ã‚¨ã‚¹ãƒˆ', followq:'å¾Œç¶šã‚¯ã‚¨ã‚¹ãƒˆ', comments:'ã‚³ãƒ¡ãƒ³ãƒˆ' },
    readMore:'å…¨æ–‡ã‚’è¡¨ç¤º', readLess:'æŠ˜ã‚ŠãŸãŸã‚€',
    story:`<div class="clamp" data-collapsed="true">
      <p>ã‚·ãƒ£ãƒãƒ‹ãƒ»ãƒ­ãƒ¼ãƒãƒ‹ã¯ã€äººç”Ÿã¨ã¯å®Ÿã«äºˆæ¸¬ã—ãŒãŸã„ã‚‚ã®ã ã¨èªã‚Šã€ã‹ã­ã¦ã‚ˆã‚Šãƒ¯ã‚¤ãƒ³ã«æƒ…ç†±ã‚’æŠ±ã„ã¦ã„ãŸã‚‚ã®ã®ã€å¼•é€€ã‚’ä½™å„€ãªãã•ã‚Œã¦ã¯ã˜ã‚ã¦ã€ãã‚Œã‚’è¶£å‘³ä»¥ä¸Šã®ã‚‚ã®ã¨ã—ã¦è¿½ã„ã‹ã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã ã¨ç©ã‚„ã‹ã«æŒ¯ã‚Šè¿”ã‚‹ã€‚</p>
      <p>ãã—ã¦ã€ãã‚ŒãŒæˆã‚Šç«‹ã£ãŸã®ã¯å‚­å…µã¨ã—ã¦è“„ãˆãŸè²¯ãˆãŒã‚ã£ã¦ã“ãã ã¨ã‚‚èªã‚ã‚‹ã€‚ä»•äº‹ã®æ€§è³ªã«ã¤ã„ã¦ä½•ã‚’è¨€ã‚ã‚Œã‚ˆã†ã¨ã€ç¨¼ãã ã‘ã¯ç¢ºã‹ã â€•â€•ãã®ç¾å®ŸãŒã€ä»Šã®è‡ªåˆ†ã‚’æ”¯ãˆãŸã®ã ã¨ã€‚</p>
      <p>ã ãŒã€ã‚ãªãŸãŒå…ˆã‚’æ€¥ã„ã§ã„ã‚‹ã“ã¨ã‚‚è¦‹æŠœã„ã¦ã„ãŸã€‚ãƒ´ã‚§ã‚¤ã‚¹ã‚±ãƒ¼ãƒˆã®ã‚‚ã¨ã¸ãƒ¯ã‚¤ãƒ³ã‚’å±Šã‘ã­ã°ãªã‚‰ãªã„ã®ã«ã€ã„ã¾æ‰‹å…ƒã«ã‚ã‚‹ã‚‚ã®ã§ã¯ã“ã®å¸­ã«ãµã•ã‚ã—ã„å“è³ªã«å±Šã‹ãªã„â€•â€•ãã“ãŒå•é¡Œã ã¨ã€å½¼ã¯ç«¯çš„ã«å‘Šã’ã‚‹ã€‚</p>
      <p>æœ€é«˜ã®ãƒ´ã‚£ãƒ³ãƒ†ãƒ¼ã‚¸ã¯ã€æœ€å¤§è¦æ¨¡ã®ãƒ¯ã‚¤ãƒŠãƒªãƒ¼ã‚’å–ã‚Šä»•åˆ‡ã‚‹ãƒ“ãƒ«ã‚®ãƒ¬ãƒ³ãƒˆãŒæŠ±ãˆè¾¼ã‚“ã§ã„ã‚‹ã¨ã„ã†ã€‚æœ›ã¿è–„ã ã¨ã¯æ€ã„ã¤ã¤ã‚‚ã€äº‹æƒ…ãŒäº‹æƒ…ã ã‘ã«ã€ã‚ãªãŸã«åŠ©åŠ›ã‚’ä¹ã„ã«è¡Œã£ã¦ã‚‚ã‚‰ã†ã»ã‹ãªã„ã®ã ã¨ã€‚</p>
      <p>ãƒ¯ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãƒ“ãƒ«ã‚®ãƒ¬ãƒ³ãƒˆã«å£°ã‚’ã‹ã‘ã‚‹ã¨ã€å½¼ã¯ä¸ç´”ç‰©ã«æ±šã•ã‚ŒãŸå‡ºæ¥æãªã„ã®é…’ã‚’ç½µã‚Šã€ã“ã‚“ãªä»£ç‰©ã‚’ç“¶è©°ã‚ã—ãŸè€…ã«ã¯æ›´è¿­ã§ã™ã‚‰ç”Ÿã¬ã‚‹ã„ã¨è¨€ã„æ¨ã¦ã¦ã„ãŸã€‚å¿™ã—ã„è©±ã®æœ€ä¸­ã ã¨è‹›ç«‹ã¡ã‚’éœ²ã‚ã«ã—ã€ã‚ã®é§†ã‘å‡ºã—ã®é†¸é€ å®¶ãŒã‚ãªãŸã‚’å¯„è¶Šã—ãŸã®ã‹ã¨å˜²ç¬‘ã™ã‚‹ã€‚ãã—ã¦ã€ã‚ãªãŸãŸã¡ã«è‡ªåˆ†ã®ç§˜è”µé…’ã®ç¹Šç´°ã•ã‚’å‘³ã‚ã†èˆŒã¯ãªã„ã¨æ–­ã˜ã€æœ€æ‚ªã®ãƒ´ã‚£ãƒ³ãƒ†ãƒ¼ã‚¸ã‚’å£²ã‚‹ãã‚‰ã„ãªã‚‰ã‚´ãƒƒãƒ–ãƒ¼ã®å°¿ã‚’å‡ºã™ã»ã†ãŒã¾ã—ã ã¨è¨€ã„æ”¾ã¡ã€ã‚ãªãŸã‚’è¿½ã„æ‰•ã†ã€‚</p>
      <p>ã‚ãªãŸãŒã‚·ãƒ£ãƒãƒ‹ãƒ»ãƒ­ãƒ¼ãƒãƒ‹ã®ã‚‚ã¨ã¸æˆ»ã£ã¦æ–­ã‚‰ã‚ŒãŸæ—¨ã‚’ä¼ãˆã‚‹ã¨ã€å½¼ã¯ã‚„ã¯ã‚Šã€ã¨çŸ­ãå—ã‘æ­¢ã‚ã‚‹ã€‚æƒ…ç†±ã¨è…•ã¯ç–‘ã„ã‚ˆã†ãŒãªã„ãŒã€ãƒªãƒ ã‚µãƒ»ãƒ­ãƒŸãƒ³ã‚µã®ãƒ¯ã‚¤ãƒ³ç”·çˆµã¯æ°—é…ã‚Šã§çŸ¥ã‚‰ã‚Œã‚‹ç”·ã§ã¯ãªã„â€•â€•ãã†è¨€ã£ã¦ã€åˆ¥ã®æ‰‹ã‚’è€ƒãˆã‚ˆã†ã¨å‘Šã’ã‚‹ã€‚</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>ã‚¯ã‚¨ã‚¹ãƒˆç™ºè¡Œ</b> ãƒ‰ãƒ¬ã‚¹ãƒˆã€€<small class="muted">æ±ãƒ©ãƒã‚·ã‚¢ (X:14.0, Y:30.3)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="give-a-man-a-drink.html">å¯†æ—ã®ç”·</a></div>
      <div class="row">ã™ã¹ã¦ï¼ˆãƒªãƒŸãƒ†ãƒƒãƒ‰ã‚¸ãƒ§ãƒ–ã‚’é™¤ãï¼‰Lv 33ï½</div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="battle-scars.html">å‹æƒ…ã®æœ¨ã®å®Ÿ</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'èŸ²é³´åœ¨è€³ã€é‡æ“”åœ¨å¿ƒ',
    tabs:{ story:'æ•…äº‹æ¦‚è¦', acq:'å–å¾—æ–¹å¼', unlockq:'è§£é–ä»»å‹™', followq:'å¾ŒçºŒä»»å‹™', comments:'ç•™è¨€' },
    readMore:'å±•é–‹å…¨æ–‡', readLess:'æ”¶åˆå…§å®¹',
    story:`<div class="clamp" data-collapsed="true">
      <p>Shamani Lohmani å¸¶è‘—ä¸€ç¨®å¦ç„¶çš„å£å»è«‡èµ·äººç”Ÿçš„ä¸å¯é æ¸¬â€”â€”ä»–ä¸€ç›´éƒ½ç†±æ„›è‘¡è„é…’ï¼Œä½†ç›´åˆ°è¢«è¿«é€€ä¼‘ä¹‹å¾Œï¼Œæ‰çµ‚æ–¼èƒ½æŠŠé€™ä»½ç†±æƒ…ç•¶æˆä¸åªæ˜¯èˆˆè¶£ï¼Œè€Œæ˜¯ä¸€æ¢çœŸæ­£èƒ½èµ°ä¸‹å»çš„è·¯ã€‚</p>
      <p>ä»–ä¹Ÿç›´è¨€ï¼Œè‹¥æ²’æœ‰è‡ªå·±ç•¶ä½£å…µæ™‚å­˜ä¸‹çš„ç©è“„ï¼Œé€™ä¸€åˆ‡æ ¹æœ¬ä¸å¯èƒ½æˆçœŸã€‚é‚£ä»½å·¥ä½œæˆ–è¨±æœ‰çˆ­è­°ï¼Œä½†æ²’æœ‰äººèƒ½å¦èªå®ƒå ±é…¬è±åšï¼›è€Œæ­£æ˜¯é‚£äº›éŒ¢ï¼Œè®“ä»–èƒ½æŠŠæ„›å¥½è®Šæˆå¦‚ä»Šçš„åŸ·è‘—ã€‚</p>
      <p>å¯ä»–å¾ˆå¿«çœ‹å‡ºä½ å·²ç¶“ä¸è€ç…©ï¼Œä¾¿ä¸å†ç¹åœˆå­ï¼šWheiskaet ç­‰è‘—è¦é…’ï¼Œè€Œå•é¡Œå°±åœ¨æ–¼â€”â€”Shamani Lohmani æ‰‹ä¸Šçš„æ”¶è—ï¼Œæ²’æœ‰ä¸€ç“¶é…å¾—ä¸Šé€™æ¬¡çš„å ´åˆã€‚</p>
      <p>ä»–å‘Šè¨´ä½ ï¼ŒWineport æœ€å¥½çš„å¹´ä»½éƒ½è¢« Byrglaent å›¤è‘—ã€‚é‚£äººæŒç®¡è‘— Vylbrand æœ€å¤§çš„é…’èŠï¼ŒShamani Lohmani ä¹Ÿä¸æŒ‡æœ›ä»–æœƒå¥½èªªè©±ï¼›ä½†åœ¨åˆ¥ç„¡é¸æ“‡çš„æƒ…æ³ä¸‹ï¼Œä½ åªèƒ½å»è«‹ä»–å‡ºæ‰‹ç›¸åŠ©ã€‚</p>
      <p>ä½ åœ¨ Wineport æ‰¾ä¸Š Byrglaent æ™‚ï¼Œä»–æ­£æ€’ä¸å¯éï¼Œç—›æ–¥æŸå€‹å¤–è¡ŒäººæŠŠé…’è£ç“¶æ™‚æ··é€²é›œè³ªï¼Œç°¡ç›´è®“é…’å¹¾ä¹é›£ä»¥ä¸‹åš¥ï¼Œç”šè‡³èªªå…‰æ˜¯é–‹é™¤éƒ½å¤ªä¾¿å®œäº†ï¼Œè©²è®“é‚£äººæŠŠé‚£æ¡¶è¢«æ±¡æŸ“çš„é…’ä¸€æ»´ä¸å‰©åœ°å–ä¸‹å»æ‰å°ã€‚ä»–ä¸è€ç…©ä½ çš„æ‰“æ“¾ï¼Œåˆå˜²ç¬‘é‚£å€‹ã€Œæ–°æ‰‹é‡€é…’å¸«ã€ç«Ÿæ´¾ä½ ä¾†èªªæƒ…ï¼Œä¸¦æ–·è¨€ä½ å’Œä½ çš„åŒä¼´æ ¹æœ¬æ²’æœ‰è³‡æ ¼å“å‡ºä»–ç§è—é…’çš„ç´°è†©ã€‚ä»–èªªè‡ªå·±å¯§å¯ç«¯å‡º goobbue çš„å°¿ï¼Œä¹Ÿä¸æœƒæŠŠæœ€å·®çš„å¹´ä»½è³£çµ¦ä½ ï¼Œæœ€å¾Œç›´æ¥æŠŠä½ è¶•èµ°ã€‚</p>
      <p>ä½ å¸¶è‘—æ‹’çµ•å›åˆ° Shamani Lohmani é¢å‰ã€‚ä»–è½å®Œå¾Œåªæ·¡æ·¡å•äº†ä¸€å¥ï¼Œæœç„¶ä¸å‡ºæ‰€æ–™ï¼Œç”šè‡³é€£é‚£äº›åˆºè€³çš„åŸè©±ä¹Ÿåœ¨ä»–çš„é æƒ³ä¹‹ä¸­ã€‚ä»–æ‰¿èª Byrglaent çš„ç†±æƒ…èˆ‡æŠ€è¡“ç„¡å¯æŒ‘å‰”ï¼Œä½†ä½œç‚º Limsa Lominsa çš„ã€Œé…’ä¹‹ç”·çˆµã€ï¼Œä»–å¾ä¾†ä¸æ˜¯ä»¥åœ“æ»‘æˆ–é«”é¢è‘—ç¨±çš„äººã€‚æ–¼æ˜¯ Shamani Lohmani æ”¶èµ·æœŸå¾…ï¼Œå‘Šè¨´ä½ ï¼šåªèƒ½æ”¹èµ°åˆ¥çš„è·¯äº†ã€‚</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>ä»»å‹™ç™¼å¸ƒ</b> å¾·é›·æ–¯ç‰¹ã€€<small class="muted">æ‹‰è«¾è¥¿äºæ±éƒ¨ (X:14.0, Y:30.3)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="give-a-man-a-drink.html">å¯†æ—ä¸­çš„ç”·äºº</a></div>
      <div class="row">æ‰€æœ‰è·æ¥­ï¼ˆä¸å«é™å®šè·ï¼‰ ç­‰ç´š 33 ä»¥ä¸Š</div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="battle-scars.html">å‚·ç—•å­•è‚²çš„å‹èª¼</a></div>
    </div>`
  }
};

const langToggle  = document.getElementById('langToggle');
const pageTitle   = document.getElementById('pageTitle');
const tabBtns     = [...document.querySelectorAll('.tab-btn')];
const panels = {
  story:  document.getElementById('panel-story'),
  acq:    document.getElementById('panel-acq'),
  unlockq:document.getElementById('panel-unlockq'),
  followq:document.getElementById('panel-followq'),
  comments: document.getElementById('panel-comments')
};

function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }
function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `ğŸŒ ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}

function wireClamp(panelEl, t){
  const clamp = panelEl.querySelector('.clamp');
  const btn = panelEl.querySelector('[data-role="expand"]');
  if(!clamp || !btn) return;
  function setLabel(){
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    btn.textContent = collapsed ? t.readMore : t.readLess;
  }
  setLabel();
  btn.addEventListener('click', ()=>{
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    clamp.setAttribute('data-collapsed', collapsed ? 'false' : 'true');
    setLabel();
  });
}

function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  if (key !== 'comments') panels[key].innerHTML = t[key];
  if (key === 'story') wireClamp(panels[key], t);
  if (key === 'comments') loadGiscusForCurrentLang();
}

tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});

langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem(LANG_KEY, next);
  applyLang(next);
});

applyLang(getLang());

const GISCUS_CFG = {
  repo: 'BELAUG-FFXIV/FFXIV_Library',
  repoId: 'R_kgDOPyh4Kw',
  category: 'General',
  categoryId: 'DIC_kwDOPyh4K84CwPjL',
  theme: 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  mount.innerHTML = '';
  const langCode = getLang();
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + 'ï½œ' + langCode);
  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;
  mount.appendChild(s);
}
</script>
</body>
</html>
