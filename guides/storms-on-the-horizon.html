<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Storms on the Horizon | BELAUG · FFXIV Library</title>
  <meta name="description" content="MSQ – Storms on the Horizon (ARR Patch 2.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:#222;border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}

    /* 長文自動收合 */
    .story-collapsible{position:relative;max-height:380px;overflow:hidden}
    .story-collapsible::after{
      content:"";position:absolute;inset:auto 0 0 0;height:72px;
      background:linear-gradient(to bottom, rgba(255,248,230,0), var(--card));
    }
    .story-toggle{display:inline-block;margin-top:10px;padding:8px 14px;border:1px solid var(--border);
      border-radius:999px;background:#fff;cursor:pointer;font-weight:600}
    .story-expanded{max-height:none}
    .story-expanded::after{display:none}
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">🏠 Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="切換語言">🌐 EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <!-- 左：影片 -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/4vjf6FrsOkk"
              title="Storms on the Horizon" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- 右：標題 + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">Storms on the Horizon</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
        </div>
        <div class="bd">
          <div id="panel-story"   class="tab-panel active"></div>
          <div id="panel-acq"     class="tab-panel"></div>
          <div id="panel-unlockq" class="tab-panel"></div>
          <div id="panel-followq" class="tab-panel"></div>
        </div>
      </section>
    </div>
  </main>

<script>
const LANG_KEY = 'ffxiv-guide-lang';
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:"Storms on the Horizon",
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest' },
    story:`<p>You’re approached with a light-hearted errand: Captain Baldewyn is planning a feast for the thaumaturges at Horizon, and fresh fish is on the menu. You’re sent south to Crescent Cove to ensure the village fulfills the request.</p>
<p>At the cove, you find Raffe flustered. The seas have been rough, and the day’s catch is lacking. Still, he nods and swears that the captain will have his fish—no matter what. Behind his nervous words, you sense the pressure weighing on this small coastal outpost.</p>
<p>What was framed as a simple message reveals the strain between command and those expected to serve it.</p>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> Nunuzofu <small class="muted">(Western Thanalan, X:17.9, Y:16.0)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="following-footfalls.html">Following Footfalls</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="#">Oh Captain, My Captain</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'酒のサカナ求む',
    tabs:{ story:'ストーリー', acq:'入手方法', unlockq:'開放クエスト', followq:'後続クエスト' },
    story:`<p>あなたはささいな伝令役を頼まれる。バルドウィン隊長が、ホライズンにて呪術士たちのための宴を企画しており、最高の料理を振る舞うという。その目玉は「新鮮な魚」。あなたは南の「クレセントコーヴ」に向かい、漁村に調達を依頼する。</p>
<p>到着すると、ラッフは戸惑いながら応じる。最近の荒天のせいで漁獲は少なく、満足いく供給ができるか不安を隠せない。それでも、彼は「隊長の魚は必ず届ける」と誓う。</p>
<p>一見軽い命令の裏には、小さな村の漁師たちにかかる重圧と、従属する者たちの現実が垣間見えた。</p>`,
    acq:`<div class="stack">
      <div class="row"><b>クエスト発行</b> ヌヌゾフ <small class="muted">（西ザナラーン, X:17.9, Y:16.0）</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="following-footfalls.html">足跡の谷へ</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="#">正義を銅の刃に宿し</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'風暴前的酒宴',
    tabs:{ story:'故事概要', acq:'取得方式', unlockq:'解鎖任務', followq:'後續任務' },
    story:`<p>你接下了一項看似簡單的任務──Baldewyn 隊長要為 Horizon 的 thaumaturges 籌辦宴會，食材中少不了最上等的鮮魚。你受命前往西南方的 Crescent Cove，向村裡傳達命令。</p>
<p>在那裡，你遇見了神情緊張的 Raffe。他說近來海象不佳，漁獲不多，無法保證能捕到足夠的好魚。但他還是重重點頭，保證「隊長的魚一定會到」。</p>
<p>一項輕描淡寫的差事，背後卻藏著層層壓力與責任。小村落默默承受上層命令的重量，而你，恰巧見證了這其中的裂縫。</p>`,
    acq:`<div class="stack">
      <div class="row"><b>任務發布</b> 努努佐夫 <small class="muted">（薩納蘭西部, X:17.9, Y:16.0）</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="following-footfalls.html">踏尋足跡之谷</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="#">正義託付於銅之刃</a></div>
    </div>`
  }
};

const langToggle  = document.getElementById('langToggle');
const pageTitle   = document.getElementById('pageTitle');
const tabBtns     = [...document.querySelectorAll('.tab-btn')];
const panels = {
  story:  document.getElementById('panel-story'),
  acq:    document.getElementById('panel-acq'),
  unlockq:document.getElementById('panel-unlockq'),
  followq:document.getElementById('panel-followq')
};

function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }
function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `🌐 ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}
function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  panels[key].innerHTML = t[key];
}
tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});
langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem(LANG_KEY, next);
  applyLang(next);
});

/* —— 長文自動收合（依字數自動出現） —— */
const readMoreLabels = {
  EN: {more:'Read more', less:'Show less'},
  JP: {more:'続きを読む',   less:'折りたたむ'},
  ZH: {more:'展開全文',     less:'收合內容'}
};
function makeStoryCollapsible(lang){
  const panel = document.getElementById('panel-story');
  if(!panel) return;
  const textLen = panel.textContent.trim().length;
  if(textLen < 800) return;
  const inner = panel.innerHTML.trim();
  const wrap = document.createElement('div');
  wrap.className = 'story-collapsible';
  wrap.innerHTML = inner;
  const btn = document.createElement('button');
  const L = readMoreLabels[lang] || readMoreLabels.EN;
  btn.className = 'story-toggle';
  btn.textContent = L.more;
  btn.addEventListener('click', ()=>{
    const on = wrap.classList.toggle('story-expanded');
    btn.textContent = on ? L.less : L.more;
  });
  panel.innerHTML = '';
  panel.appendChild(wrap);
  panel.appendChild(btn);
}
/* 掛鉤 renderPanel：切到 Story 時套用收合 */
const _origRenderPanel = renderPanel;
renderPanel = function(key, lang){
  _origRenderPanel(key, lang);
  if(key==='story') makeStoryCollapsible(lang);
};

applyLang(getLang());
</script>
</body>
</html>
