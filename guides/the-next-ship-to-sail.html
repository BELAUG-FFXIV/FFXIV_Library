<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Next Ship to Sail | BELAUG · FFXIV Library</title>
  <meta name="description" content="MSQ – The Next Ship to Sail (EW Patch 6.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:var(--fg);border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}

    /* 展開/收合（Story clamp） */
    .clamp{position:relative; max-height:360px; overflow:hidden}
    .clamp[data-collapsed="false"]{max-height:none}
    .clamp[data-collapsed="true"]::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:72px;
      background:linear-gradient(to bottom, rgba(255,255,255,0), var(--card)); pointer-events:none;
    }
    .expand-wrap{ margin-top:12px; }
    .expand-btn{
      display:inline-block; padding:8px 14px; border-radius:10px;
      background:var(--card); border:1px solid var(--border); cursor:pointer; font-weight:600;
    }
    .expand-btn:hover{ background:#fffef8; }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">🏠 Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="切換語言">🌐 EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <!-- 左：影片 -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/KxJD8RkFfZ8"
              title="The Next Ship to Sail" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- 右：標題 + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">The Next Ship to Sail</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story"   class="tab-panel active"></div>
          <div id="panel-acq"     class="tab-panel"></div>
          <div id="panel-unlockq" class="tab-panel"></div>
          <div id="panel-followq" class="tab-panel"></div>
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const LANG_KEY = 'ffxiv-guide-lang';
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:'The Next Ship to Sail',
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    readMore:'Show more', readLess:'Show less',
    story:`<div class="clamp" data-collapsed="true">
      <p>At Dawn’s Respite, Alphinaud calls the Scions together to reassess the situation. The Telophoroi have constructed towers across the world, corrupting innocents for primal summonings.</p>
      <p>Even Garlemald has fallen into silence, its people transformed into thralls building a twisted edifice. Concerned by the growing threat, the Scions resolve to travel to Sharlayan, posing as associates of the Students of Baldesion. As the ship prepares to leave Limsa Lominsa, Tataru bids them farewell.</p>
      <p>Onboard, Thancred recalls his meeting with Louisoix, and Hydaelyn appears to the Warrior of Light, revealing her nature as a primal and the burden she now bears. As Sharlayan comes into view, emotions stir—nostalgia, apprehension, and determination. Upon arrival in Sharlayan, the group undergoes strict immigration procedures. One by one, they are approved—Alphinaud and Alisaie drawing wary attention, Estinien nearly rejected. Krile steps in to vouch for them all. With entry granted, the Scions step into Sharlayan, a city of knowledge and secrecy, where answers may lie hidden behind paper and pride.</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> Alphinaud <small class="muted">(The Rising Stones, X:6.0, Y:5.9)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="#">Death Unto Dawn</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="#">Old Sharlayan, New to You</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'やがて流れは海へと注ぐ',
    tabs:{ story:'ストーリー', acq:'入手方法', unlockq:'開放クエスト', followq:'後続クエスト', comments:'コメント' },
    readMore:'全文を表示', readLess:'折りたたむ',
    story:`<div class="clamp" data-collapsed="true">
      <p>「ドーンズ・レスト」に集ったアルフィノたちは、世界中に出現した「塔」の脅威について再確認する。テロフォロイによって造られたその構造物は、人々の信仰を歪めて蛮神を召喚し、多くの罪なき者たちを虜にしてきた。ガレマルドでは戦の声もなくなり、住民たちは無言のまま巨大な塔を築く。</p>
      <p>終末への危機が迫る中、一行は「バルデシオン委員会の協力者」としてシャーレアンへ向かうことを決意する。リムサ・ロミンサからの船出に際して、タタルが別れを惜しむ。航海中、サンクレッドはルイゾワとの出会いを思い出し、エスティニアンとアルフィノの間にはぎこちないながらも心が通う。そんな中、ハイデリンが冒険者に語りかける。</p>
      <p>自身が蛮神であること、力を失いつつあること、そして終末の災厄が迫っていること。その言葉は海の彼方に消えていく。やがて船はシャーレアンに到着する。厳格な入国審査が始まり、ひとりずつ手続きを受ける仲間たち。アルフィノとアリゼーは父の名に言及され、エスティニアンは拒否されかけるが、クルルの支援で全員が無事に入国を果たす。こうして一行は、終末の真実に迫るべく、知の都に足を踏み入れるのだった。</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>クエスト発行</b> アルフィノ <small class="muted">（モードゥナ：石の家, X:6.0, Y:5.9）</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="#">黎明の死闘</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="#">オールド・シャーレアン</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'航向大海的時刻',
    tabs:{ story:'故事概要', acq:'取得方式', unlockq:'解鎖任務', followq:'後續任務', comments:'留言' },
    readMore:'展開全文', readLess:'收合內容',
    story:`<div class="clamp" data-collapsed="true">
      <p>Alphinaud 在 Dawn’s Respite 召集眾人，重新盤點 Telophoroi 的威脅。他們在世界各地築起高塔，將無辜之人扭曲為原初召喚的祭品。Garlemald 如今陷入詭異的沉默，居民化為沉默的奴僕，為惡夢般的構造物無言築塔。面對逐漸逼近的災厄，Scions 決定前往 Sharlayan，以 Baldesion 協會協力者的身分探尋真相。啟航前，Tataru 為眾人送行。</p>
      <p>航程中，Thancred 回憶起初次與 Louisoix 相遇的片段，Estinien 與 Alphinaud 也在尷尬與調侃間逐漸建立起新的默契。忽然間，Hydaelyn 的聲音響起，對 Warrior of Light 傳達自身作為原初存在的真相、逐漸衰退的力量，以及即將到來的 Final Days。語畢，她的聲音隨風而逝。</p>
      <p>一行人抵達 Sharlayan，迎來嚴格的入境審查。Alisaie 與 Alphinaud 面對家族風波，Estinien 更差點被拒，所幸在 Krile 出面擔保下全員順利通關。穿越港口，他們終於踏上這片充滿智慧與戒心的土地──Sharlayan，通往真相的起點。</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>任務發布</b> 阿爾菲諾 <small class="muted">（石之家, X:6.0, Y:5.9）</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="#">黎明之戰</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="#">古薩雷安，新篇章</a></div>
    </div>`
  }
};

const langToggle  = document.getElementById('langToggle');
const pageTitle   = document.getElementById('pageTitle');
const tabBtns     = [...document.querySelectorAll('.tab-btn')];
const panels = {
  story:  document.getElementById('panel-story'),
  acq:    document.getElementById('panel-acq'),
  unlockq:document.getElementById('panel-unlockq'),
  followq:document.getElementById('panel-followq'),
  comments: document.getElementById('panel-comments')
};

function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }
function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `🌐 ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}

function wireClamp(panelEl, t){
  const clamp = panelEl.querySelector('.clamp');
  const btn = panelEl.querySelector('[data-role="expand"]');
  if(!clamp || !btn) return;
  function setLabel(){
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    btn.textContent = collapsed ? t.readMore : t.readLess;
  }
  setLabel();
  btn.addEventListener('click', ()=>{
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    clamp.setAttribute('data-collapsed', collapsed ? 'false' : 'true');
    setLabel();
  });
}

function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  if (key !== 'comments') panels[key].innerHTML = t[key];
  if (key === 'story') wireClamp(panels[key], t);
  if (key === 'comments') loadGiscusForCurrentLang();
}

tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});

langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem(LANG_KEY, next);
  applyLang(next);
});

applyLang(getLang());

/* === Giscus：Comments 分頁（與多語自動切換） === */
const GISCUS_CFG = {
      repo: 'BELAUG-FFXIV/FFXIV_Library',
      repoId: 'R_kgDOPyh4Kw',
      category: 'General',
      categoryId: 'DIC_kwDOPyh4K84CwPjL',
      theme: 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  mount.innerHTML = '';
  const langCode = getLang();
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + '｜' + langCode);
  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;
  mount.appendChild(s);
}
</script>
</body>
</html>
