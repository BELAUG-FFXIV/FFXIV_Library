<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Welcome to Limsa Lominsa | BELAUG · FFXIV Library</title>
  <meta name="description" content="MSQ – Welcome to Limsa Lominsa (ARR Patch 2.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){ .grid{grid-template-columns:1fr} .video-wrap{position:relative;padding-top:56.25%} .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%} }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:var(--fg);border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left"><a class="home" href="../index.html">🏠 Home</a></div>
      <div class="right"><button id="langToggle" class="icon-btn" aria-label="切換語言">🌐 EN</button></div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <!-- 左：影片 -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/ktxcbn2sin8"
              title="Welcome to Limsa Lominsa" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- 右：標題 + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">Welcome to Limsa Lominsa</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <!-- ✨ 新增：單一 Comments 分頁（文字會隨語言切換） -->
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story"   class="tab-panel active"></div>
          <div id="panel-acq"     class="tab-panel"></div>
          <div id="panel-unlockq" class="tab-panel"></div>
          <div id="panel-followq" class="tab-panel"></div>
          <!-- ✨ 新增：Comments 面板（只有掛載點，沒有多餘內容） -->
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const LANG_KEY = 'ffxiv-guide-lang';
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:'Welcome to Limsa Lominsa',
    // ✨ 新增 comments 按鈕文案
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    story:`<p>The city of Limsa Lominsa bustles with adventurers from across the realm, each drawn by whispers of glory or purpose. Among them steps a new arrival—an outsider with no fame, no power, just the will to begin anew. Greeted by Aetheryte Attendant and the Maelstrom’s watchful eye, they are welcomed not with fanfare, but with open opportunity. This is not a tale of greatness foretold, but of quiet beginnings in a city of sails and shadows. The harbor opens its arms… and so begins the journey.</p>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> <span class="muted">N/A (intro scene)</span></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><span class="muted">N/A</span></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="we-must-rebuild.html">We Must Rebuild
</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'リムサ・ロミンサへの導き',
    // ✨ 新增 comments 按鈕文案
    tabs:{ story:'ストーリー', acq:'入手方法', unlockq:'開放クエスト', followq:'後続クエスト', comments:'コメント' },
    story:`<p>海都リムサ・ロミンサ――そこは、冒険者たちが己の夢と目的を胸に集う港町。名もなきひとりの来訪者が、今日またその地を踏みしめる。迎えるのは、エーテライト案内役と、メイルシュトロームの見守る視線。派手な演出はないが、確かな第一歩がそこにあった。これは予言された英雄譚ではなく、ひとりの無名なる旅人の静かな始まりの物語。帆と影が揺れるこの街から、冒険が動き出す。</p>`,
    acq:`<div class="stack">
      <div class="row"><b>クエスト発行</b> <span class="muted">（NPC未登場）</span></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><span class="muted">該当なし</span></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="we-must-rebuild.html">ウルダハ操車庫へ
</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'歡迎來到利姆薩．羅敏薩',
    // ✨ 新增 comments 按鈕文案
    tabs:{ story:'故事概要', acq:'取得方式', unlockq:'解鎖任務', followq:'後續任務', comments:'留言' },
    story:`<p>Limsa Lominsa——一座繁忙的海港都市，迎來來自各地的冒險者。有的追尋榮耀，有的渴望改變。而今天，又有一名無名的旅人來到此地，懷抱著一份堅定而靜默的初心。在以太之環的指引下、在海軍守望的注視下，他／她邁出了第一步。這不是命運預言的英雄物語，而是一段在風帆與陰影交錯中誕生的平凡旅程。冒險，就此展開。</p>`,
    acq:`<div class="stack">
      <div class="row"><b>任務發布</b> <span class="muted">尚無 NPC</span></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><span class="muted">無</span></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="we-must-rebuild.html">重建之路
</a></div>
    </div>`
  }
};

const langToggle  = document.getElementById('langToggle');
const pageTitle   = document.getElementById('pageTitle');
const tabBtns     = [...document.querySelectorAll('.tab-btn')];
const panels = {
  story:  document.getElementById('panel-story'),
  acq:    document.getElementById('panel-acq'),
  unlockq:document.getElementById('panel-unlockq'),
  followq:document.getElementById('panel-followq'),
  comments:document.getElementById('panel-comments') // ✨ 新增
};

function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }
function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `🌐 ${t.langLabel}`;
  tabBtns.forEach(btn => { if (t.tabs[btn.dataset.tab]) btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}
function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  // ✨ 修改：只有該語系有內容時才覆寫 innerHTML，避免把 Comments 掛載點清空
  if (t[key]) panels[key].innerHTML = t[key];
}
tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
    // ✨ 當切到 Comments 時載入/重載對應語言的 giscus
    if (btn.dataset.tab === 'comments') loadGiscusForCurrentLang();
  });
});
langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem(LANG_KEY, next);
  applyLang(next);
  // ✨ 如果目前就在 Comments，就重新載入對應語言的 giscus
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true');
  if (activeBtn && activeBtn.dataset.tab === 'comments') loadGiscusForCurrentLang();
});
applyLang(getLang());

/* ✨ Giscus：單一 Comments 分頁，跟著語言切換（各語言各自獨立串） */
const GISCUS_CFG = {
  repo: 'belaug-ffxiv/FFXIV_Library',
  repoId: 'R_kgD0Pyh4Kw',                 // 你在 giscus.app 的 repo ID
  category: 'General',
  categoryId: 'DIC_kwD0Pyh4K84CwPjL',      // 你在 giscus.app 的 category ID
  theme: 'light'                            // 子頁固定亮色；若想自動可改 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP'?'ja':(code==='ZH'?'zh-TW':'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  // 清掉舊的 iframe/script（切語言或第一次進入時重建）
  mount.innerHTML = '';

  const langCode = getLang(); // EN / JP / ZH
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);

  // 同一頁不同語言 → 用 specific term 各自成串
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + '｜' + langCode);

  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;

  mount.appendChild(s);
}
</script>
</body>
</html>
