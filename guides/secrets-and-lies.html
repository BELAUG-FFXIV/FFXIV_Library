<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Secrets and Lies | BELAUG · FFXIV Library</title>
  <meta name="description" content="MSQ – Secrets and Lies (ARR Patch 2.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:#222;border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}

    /* 長文自動收合（若內文過長才會生效） */
    .story-collapsible{position:relative;max-height:380px;overflow:hidden}
    .story-collapsible::after{
      content:"";position:absolute;inset:auto 0 0 0;height:72px;
      background:linear-gradient(to bottom, rgba(255,248,230,0), var(--card));
    }
    .story-toggle{display:inline-block;margin-top:10px;padding:8px 14px;border:1px solid var(--border);
      border-radius:999px;background:#fff;cursor:pointer;font-weight:600}
    .story-expanded{max-height:none}
    .story-expanded::after{display:none}
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">🏠 Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="切換語言">🌐 EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <!-- 左：影片 -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/ea3Yof_aQWc"
              title="Secrets and Lies" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- 右：標題 + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">Secrets and Lies</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story"    class="tab-panel active"></div>
          <div id="panel-acq"      class="tab-panel"></div>
          <div id="panel-unlockq"  class="tab-panel"></div>
          <div id="panel-followq"  class="tab-panel"></div>
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const LANG_KEY = 'ffxiv-guide-lang';
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:'Secrets and Lies',
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    story:`<p>Fufulupa calls on you once more—but this time, it’s personal. In the aftermath of Baldewyn’s arrest, he uncovers a sealed letter among the captain’s possessions. It’s addressed to Owyne—one of the Sultansworn elite.</p>
<p>Conflicted and uncertain, Fufulupa dares not open it himself. If Owyne is involved, the corruption may run deeper than anyone feared. And so, he entrusts it to you alone, asking that you deliver it to someone he trusts—Momodi of the Quicksand.</p>
<p>When you arrive in Ul’dah, Momodi greets you warmly, but her smile fades as soon as she hears the name on the letter. She vouches for Owyne’s loyalty, but something about the situation unsettles her. She remembers something—something she doesn’t say. Not yet.</p>
<p>Her voice grows serious. She asks you to swear secrecy, to commit fully, or walk away now. Whatever’s hidden in that letter… it’s not just evidence. It’s a key to something far more dangerous.</p>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> Fufulupa <small class="muted">(Western Thanalan, X:22.6, Y:17.1)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="oh-captain-my-captain.html">Oh Captain, My Captain</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="duty-honor-country.html">Duty, Honor, Country</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'落日の銀冑団',
    tabs:{ story:'ストーリー', acq:'入手方法', unlockq:'開放クエスト', followq:'後続クエスト', comments:'コメント' },
    story:`<p>フフルパは再びあなたに助けを求める。しかし今回は、彼自身の想いが強く込められていた。バルドウィンの私物から発見された封書──宛先は、サルタンスウォーンの上位隊士「オワイン」。</p>
<p>フフルパは動揺する。敬意を抱いていた者が汚職に関与していたかもしれない……その可能性が、彼には信じ難かった。自ら開封する勇気はなく、あなたに託す。届け先は、彼が信頼する人物──「クイックサンド」のモモディ。</p>
<p>ウルダハに戻ったあなたを、モモディは笑顔で迎える。だが、手紙の名を聞いた途端、空気が変わる。「オワインは誠実な男だ」と言いつつも、彼女の表情には不安がよぎる。そして──何かを思い出したように、声を潜める。</p>
<p>「このことは誰にも漏らさないと誓ってくれる？」語られていない何かが、封筒の向こうにある。あなたは試されているのだった。</p>`,
    acq:`<div class="stack">
      <div class="row"><b>クエスト発行</b> フフルパ <small class="muted">（西ザナラーン, X:22.6, Y:17.1）</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="oh-captain-my-captain.html">正義を銅の刃に宿し</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="duty-honor-country.html">至宝の影で蠢く闇</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'祕密與謊言',
    tabs:{ story:'故事概要', acq:'取得方式', unlockq:'解鎖任務', followq:'後續任務', comments:'留言' },
    story:`<p>Fufulupa 再次找上你，但這一次，他的語氣格外沉重。為了調查 Baldewyn 的腐敗，他翻閱了隊長的私人信件，意外發現一封封口的信──收信人是 Owyne，一位地位崇高的 Sultansworn 成員。</p>
<p>這個名字讓他遲疑。他不敢開封，也不敢貿然揣測。若這封信牽涉到 Owyne，那整起事件的規模恐怕遠超預期。他選擇相信你，請你將信交給 Momodi──那位始終站在 sultana 一方，與 Sultansworn 關係密切的老友。</p>
<p>當你回到 Ul’dah，Momodi 照例親切迎接你。但當她看到信上的名字，表情一沉。她說 Owyne 忠誠可靠，但她的眼神中閃過一絲動搖。她想起了什麼，卻沒有馬上說出口。</p>
<p>「你得先保證保密，否則這件事別再問下去。」那不只是一封信，它可能是連接更大陰謀的鑰匙。而你的選擇，將決定你是否踏入那道門後的黑暗。</p>`,
    acq:`<div class="stack">
      <div class="row"><b>任務發布</b> 弗弗魯帕 <small class="muted">（薩納蘭西部, X:22.6, Y:17.1）</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="oh-captain-my-captain.html">正義託付於銅之刃</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="duty-honor-country.html">責任、榮耀與祖國</a></div>
    </div>`
  }
};

const langToggle  = document.getElementById('langToggle');
const pageTitle   = document.getElementById('pageTitle');
const tabBtns     = [...document.querySelectorAll('.tab-btn')];
const panels = {
  story:  document.getElementById('panel-story'),
  acq:    document.getElementById('panel-acq'),
  unlockq:document.getElementById('panel-unlockq'),
  followq:document.getElementById('panel-followq'),
  comments: document.getElementById('panel-comments')
};

function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }
function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `🌐 ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}
function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  if (key !== 'comments') panels[key].innerHTML = t[key];
  if (key === 'story') makeStoryCollapsible(lang);
  if (key === 'comments') loadGiscusForCurrentLang();
}
tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});
langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem(LANG_KEY, next);
  applyLang(next);
});

/* —— 長文自動收合（依字數自動出現） —— */
const readMoreLabels = {
  EN: {more:'Read more',  less:'Show less'},
  JP: {more:'続きを読む',    less:'折りたたむ'},
  ZH: {more:'展開全文',      less:'收合內容'}
};
function makeStoryCollapsible(lang){
  const panel = document.getElementById('panel-story');
  if(!panel) return;
  const textLen = panel.textContent.trim().length;
  if(textLen < 800) { panel.classList.remove('story-collapsible'); panel.innerHTML = (i18n[lang]||i18n.EN).story; return; }
  const inner = (i18n[lang]||i18n.EN).story;
  panel.innerHTML = '';
  const wrap = document.createElement('div');
  wrap.className = 'story-collapsible';
  wrap.innerHTML = inner;
  const btn = document.createElement('button');
  const L = readMoreLabels[lang] || readMoreLabels.EN;
  btn.className = 'story-toggle';
  btn.textContent = L.more;
  btn.addEventListener('click', ()=>{
    const on = wrap.classList.toggle('story-expanded');
    btn.textContent = on ? L.less : L.more;
  });
  panel.appendChild(wrap);
  panel.appendChild(btn);
}

applyLang(getLang());

/* === Giscus：Comments 分頁 ===
   ⚠️ 請將 repo/repoId/categoryId 替換為你的實際值 */
const GISCUS_CFG = {
  repo: 'belaug-ffxiv/FFXIV_Library',
  repoId: 'R_kgD0Pyh4Kw',
  category: 'General',
  categoryId: 'DIC_kwD0Pyh4K84CwPjL',
  theme: 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  mount.innerHTML = '';
  const langCode = getLang();
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + '｜' + langCode);
  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;
  mount.appendChild(s);
}
</script>
</body>
</html>
