<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rock of Rancor | BELAUG · FFXIV Library</title>
  <meta name="description" content="MSQ – Rock of Rancor (ARR Patch 2.0)">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#fff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .container{max-width:1080px;margin:0 auto;padding:0 16px}
    .site-header{border-bottom:1px solid var(--border);background:#fff9edb3;backdrop-filter:saturate(120%) blur(6px);position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .left{display:flex;align-items:center;gap:12px}
    .home{border:1px solid var(--border);background:#fff;padding:4px 8px;border-radius:8px;text-decoration:none;color:var(--fg);font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex;align-items:center;gap:8px}
    .icon-btn{background:none;border:none;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px}
    .icon-btn:hover{background:#fff;border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:start}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr}
      .video-wrap{position:relative;padding-top:56.25%}
      .video-wrap iframe{position:absolute;inset:0;width:100%;height:100%}
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%;height:420px;border:0;display:block;border-radius:16px}
    .tabs{display:flex;gap:8px;padding:12px 12px 0;flex-wrap:wrap}
    .tab-btn{background:#fff;border:1px solid var(--border);color:var(--fg);border-radius:999px;padding:8px 14px;cursor:pointer;font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent);color:#fff;background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex;flex-direction:column;gap:10px}
    .stack .row{padding:12px 14px;border:1px dashed var(--border);border-radius:12px;background:#fffdf6}
    .row b{display:inline-block;min-width:130px}
    .muted{color:var(--muted)}
    .link{color:#0b60d8;text-decoration:none}
    .link:hover{text-decoration:underline}
    /* 展開/收合 */
    .clamp{position:relative; max-height:360px; overflow:hidden}
    .clamp[data-collapsed="false"]{max-height:none}
    .clamp[data-collapsed="true"]::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:72px;
      background:linear-gradient(to bottom, rgba(255,255,255,0), var(--card)); pointer-events:none;
    }
    .expand-wrap{ margin-top:12px; }
    .expand-btn{
      display:inline-block; padding:8px 14px; border-radius:10px;
      background:var(--card); border:1px solid var(--border); cursor:pointer; font-weight:600;
    }
    .expand-btn:hover{ background:#fffef8; }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">🏠 Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="切換語言">🌐 EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <!-- 左：影片 -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/Fb3AcrKqUz8"
              title="Rock of Rancor" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- 右：標題 + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">Rock of Rancor</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true"  data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Acquisition</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlockq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="followq">Follow-Up Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story"   class="tab-panel active"></div>
          <div id="panel-acq"     class="tab-panel"></div>
          <div id="panel-unlockq" class="tab-panel"></div>
          <div id="panel-followq" class="tab-panel"></div>
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
const LANG_KEY = 'ffxiv-guide-lang';
const i18n = {
  EN:{
    langLabel:'EN',
    pageTitle:'Rock of Rancor',
    tabs:{ story:'Story', acq:'Acquisition', unlockq:'Unlock Quest', followq:'Follow-Up Quest', comments:'Comments' },
    readMore:'Show more', readLess:'Show less',
    story:`<div class="clamp" data-collapsed="true">
      <p>Following the string of mysterious deaths, Aideen shared another unsettling rumor: all the victims had been young, beautiful women. With a half-hearted joke, she warned that she might be next, before getting to the real concern—a strange legend surrounding a crag southwest of Fallgourd Float.</p>
      <p>Locals whispered that after each death, the victim’s rancor would seep into the rock, causing it to flash and emit eerie sounds. Though skeptical, Aideen proposed testing the rumor firsthand. She gave you a firesand stick and instructed you to hurl it at the stone to break off fragments for analysis.</p>
      <p>You traveled to the site—known as the Rock of Rancor—braved its unsettling presence, and used the firesand to shatter part of it. Upon returning, Aideen examined the fragments. Beneath the grime, they turned out to be ordinary lightning crystals. The moaning and flashing? Just an elemental reaction. Disappointed, she admitted the phenomenon likely had nothing to do with the masked man… or vengeful spirits.</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>Quest Giver</b> Aideen <small class="muted">(North Shroud, X:21.8, Y:26.7)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="ziz-is-so-ridiculous.html">Ziz Is So Ridiculous</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="power-of-deduction.html">Power of Deduction</a></div>
    </div>`
  },
  JP:{
    langLabel:'JP',
    pageTitle:'怨念岩の謎',
    tabs:{ story:'ストーリー', acq:'入手方法', unlockq:'開放クエスト', followq:'後続クエスト', comments:'コメント' },
    readMore:'全文を表示', readLess:'折りたたむ',
    story:`<div class="clamp" data-collapsed="true">
      <p>連続する怪死事件について、Aideen はさらに気がかりな噂を口にした。どうやら犠牲者は、いずれも若く美しい女性だったという。自らも標的になるのではと冗談めかす彼女だったが、すぐに調査の提案へと切り替えた。</p>
      <p>Fallgourd Float の南西には「怨念の岩」と呼ばれる岩があり、死者が出るたびにその岩が光り、うめき声をあげるという不気味な噂があるらしい。真偽を確かめるため、Aideen はあなたに火薬棒を手渡し、岩に投げつけて破片を持ち帰るよう依頼した。</p>
      <p>現地へ向かい、噂の岩に火薬棒を投げると、それは小さな爆発を起こして砕けた。Fallgourd Float に戻ったあなたから破片を受け取った Aideen は、表面の汚れを落としながら観察した──中身は、ごく普通の雷属性クリスタルだった。光や音は、魔力の共鳴によるものだったらしい。</p>
      <p>がっかりした様子の彼女は、「仮面の男」との関連性も霊的な怨念も、どうやら単なる憶測だったようだと肩を落とした。</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>クエスト発行</b> アイディーン　黒衣森：北部森林 <small class="muted">(X:21.8, Y:26.7)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="ziz-is-so-ridiculous.html">採掘場の切り裂き魔</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="power-of-deduction.html">推理は踊る</a></div>
    </div>`
  },
  ZH:{
    langLabel:'ZH',
    pageTitle:'怨岩之謎',
    tabs:{ story:'故事概要', acq:'取得方式', unlockq:'解鎖任務', followq:'後續任務', comments:'留言' },
    readMore:'展開全文', readLess:'收合內容',
    story:`<div class="clamp" data-collapsed="true">
      <p>隨著調查持續，Aideen 又透露了另一個毛骨悚然的傳聞：所有死者似乎都是年輕貌美的女性。她自嘲地開了個玩笑，說自己得小心點，接著轉入正題——一塊位於 Fallgourd Float 西南方的奇岩。</p>
      <p>當地流言指出，每當一位少女遇害，她的怨念便會滲入那塊巨石，令其閃爍光芒並發出低鳴。雖然聽起來荒誕，Aideen 還是決定親自驗證這則傳言。她交給你一根火砂棒，請你親自前往該處，將其投向巨石並帶回碎片。</p>
      <p>你前往那塊石頭，當地人稱之為 Rock of Rancor（怨念之岩），即便氣氛詭異，你仍果斷出手。巨響過後，你收集了一些碎裂結晶，回到 Fallgourd Float 交給 Aideen 檢視。</p>
      <p>她擦去碎片上的塵土，發現那其實只是普通的雷屬性結晶。至於閃爍與低鳴，不過是魔力反應導致的自然現象。她頗感失望地承認，這一切應與戴面具的神秘人無關，也並非死者怨念所致。</p>
    </div>
    <div class="expand-wrap"><button class="expand-btn" data-role="expand"></button></div>`,
    acq:`<div class="stack">
      <div class="row"><b>任務發布</b> 艾汀　黑衣森林北部 <small class="muted">(X:21.8, Y:26.7)</small></div>
    </div>`,
    unlockq:`<div class="stack">
      <div class="row"><a class="link" href="ziz-is-so-ridiculous.html">潛伏於礦場的魔影</a></div>
    </div>`,
    followq:`<div class="stack">
      <div class="row"><a class="link" href="power-of-deduction.html">推理的力量</a></div>
    </div>`
  }
};

const langToggle  = document.getElementById('langToggle');
const pageTitle   = document.getElementById('pageTitle');
const tabBtns     = [...document.querySelectorAll('.tab-btn')];
const panels = {
  story:  document.getElementById('panel-story'),
  acq:    document.getElementById('panel-acq'),
  unlockq:document.getElementById('panel-unlockq'),
  followq:document.getElementById('panel-followq'),
  comments: document.getElementById('panel-comments')
};

function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }
function applyLang(lang){
  const t = i18n[lang] || i18n.EN;
  pageTitle.textContent = t.pageTitle;
  langToggle.textContent = `🌐 ${t.langLabel}`;
  tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
  const activeBtn = tabBtns.find(b => b.getAttribute('aria-selected')==='true') || tabBtns[0];
  renderPanel(activeBtn.dataset.tab, lang);
}

function wireClamp(panelEl, t){
  const clamp = panelEl.querySelector('.clamp');
  const btn = panelEl.querySelector('[data-role="expand"]');
  if(!clamp || !btn) return;
  function setLabel(){
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    btn.textContent = collapsed ? t.readMore : t.readLess;
  }
  setLabel();
  btn.addEventListener('click', ()=>{
    const collapsed = clamp.getAttribute('data-collapsed') !== 'false';
    clamp.setAttribute('data-collapsed', collapsed ? 'false' : 'true');
    setLabel();
  });
}

function renderPanel(key, lang){
  const t = i18n[lang] || i18n.EN;
  Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
  panels[key].classList.add('active');
  if (key !== 'comments') panels[key].innerHTML = t[key];
  if (key === 'story') wireClamp(panels[key], t);
  if (key === 'comments') loadGiscusForCurrentLang();
}

tabBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    renderPanel(btn.dataset.tab, getLang());
  });
});

langToggle.addEventListener('click', ()=>{
  const cur = getLang();
  const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
  localStorage.setItem(LANG_KEY, next);
  applyLang(next);
});

applyLang(getLang());

/* === Giscus：Comments 分頁 === */
const GISCUS_CFG = {
  repo: 'BELAUG-FFXIV/FFXIV_Library',
  repoId: 'R_kgDOPyh4Kw',
  category: 'General',
  categoryId: 'DIC_kwDOPyh4K84CwPjL',
  theme: 'preferred_color_scheme'
};
function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
function loadGiscusForCurrentLang(){
  const mount = document.getElementById('giscus_container');
  if (!mount) return;
  mount.innerHTML = '';
  const langCode = getLang();
  const s = document.createElement('script');
  s.src = 'https://giscus.app/client.js';
  s.setAttribute('data-repo', GISCUS_CFG.repo);
  s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
  s.setAttribute('data-category', GISCUS_CFG.category);
  s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
  s.setAttribute('data-mapping', 'specific');
  s.setAttribute('data-term', location.pathname + '｜' + langCode);
  s.setAttribute('data-reactions-enabled', '1');
  s.setAttribute('data-emit-metadata', '0');
  s.setAttribute('data-input-position', 'bottom');
  s.setAttribute('data-lang', uiLang(langCode));
  s.setAttribute('data-theme', GISCUS_CFG.theme);
  s.setAttribute('crossorigin', 'anonymous');
  s.async = true;
  mount.appendChild(s);
}
</script>
</body>
</html>
