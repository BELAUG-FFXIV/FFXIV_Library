<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Dark Inside | BELAUG · FFXIV Library</title>
  <meta name="description" content="FFXIV EW 6.0 Trial — The Dark Inside（ゾディアーク討滅戦 / 黑暗深淵：佐迪亞克）：故事概要、需求條件、解鎖任務與後續任務，附影片。">
  <link rel="icon" href="../img/favicon.ico" />
  <style>
    :root { --bg:#fff8e6; --card:#ffffff; --fg:#222; --muted:#666; --border:#e5e1d8; --accent:#e11d48; }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans TC","Noto Sans JP",Arial,sans-serif; background:var(--bg); color:var(--fg);}
    .container{max-width:1080px; margin:0 auto; padding:0 16px}
    .site-header{border-bottom:1px solid var(--border); background:#fff9edb3; backdrop-filter:saturate(120%) blur(6px); position:sticky; top:0; z-index:10}
    .nav{display:flex; align-items:center; justify-content:space-between; height:60px}
    .left{display:flex; align-items:center; gap:12px}
    .home{border:1px solid var(--border); background:#fff; padding:4px 8px; border-radius:8px; text-decoration:none; color:var(--fg); font-weight:800}
    .home:hover{background:#fffef8}
    .right{display:flex; align-items:center; gap:8px}
    .icon-btn{background:none; border:none; cursor:pointer; font-size:14px; padding:6px 10px; border-radius:8px}
    .icon-btn:hover{background:#fff; border:1px solid var(--border)}
    .main{padding:20px 0 40px}
    .grid{display:grid; grid-template-columns:1.1fr 1fr; gap:20px; align-items:start;}
    @media (max-width:900px){ .grid{grid-template-columns:1fr} .video-wrap{position:relative; padding-top:56.25%} .video-wrap iframe{position:absolute; inset:0; width:100%; height:100%} }
    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; box-shadow:0 4px 14px rgba(0,0,0,.05)}
    .card .hd{padding:14px 16px; border-bottom:1px solid var(--border); font-weight:700}
    .card .bd{padding:16px}
    .video-card .bd{padding:0}
    .video-card iframe{width:100%; height:420px; border:0; display:block; border-radius:16px}
    .tabs{display:flex; gap:8px; padding:12px 12px 0; flex-wrap:wrap}
    .tab-btn{background:#fff; border:1px solid var(--border); color:var(--fg); border-radius:999px; padding:8px 14px; cursor:pointer; font-weight:600}
    .tab-btn[aria-selected="true"]{border-color:var(--accent); color:#fff; background:var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .stack{display:flex; flex-direction:column; gap:10px}
    .stack .row{padding:12px 14px; border:1px dashed var(--border); border-radius:12px; background:#fffdf6}
    .muted{color:var(--muted)}
    .link{color:#0b60d8; text-decoration:none}
    .link:hover{text-decoration:underline}
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="container nav">
      <div class="left">
        <a class="home" href="../index.html">🏠 Home</a>
      </div>
      <div class="right">
        <button id="langToggle" class="icon-btn" aria-label="切換語言">🌐 EN</button>
      </div>
    </nav>
  </header>

  <main class="container main">
    <div class="grid">
      <!-- 左：影片 -->
      <section class="card video-card">
        <div class="bd">
          <div class="video-wrap">
            <iframe id="ytFrame" src="https://www.youtube.com/embed/WivGwTzVpr4" title="The Dark Inside" allowfullscreen></iframe>
          </div>
        </div>
      </section>

      <!-- 右：標題 + Tabs -->
      <section class="card">
        <div class="hd" id="pageTitle">The Dark Inside</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" role="tab" aria-selected="true" data-tab="story">Story</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="req">Requirements</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="acq">Unlock Quest</button>
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="unlock">Follow-Up Quest</button>
          <!-- 新增：Comments 分頁按鈕 -->
          <button class="tab-btn" role="tab" aria-selected="false" data-tab="comments">Comments</button>
        </div>
        <div class="bd">
          <div id="panel-story" class="tab-panel active"></div>
          <div id="panel-acq" class="tab-panel"></div>
          <div id="panel-req" class="tab-panel"></div>
          <div id="panel-unlock" class="tab-panel"></div>
          <!-- 新增：留言面板 -->
          <div id="panel-comments" class="tab-panel">
            <div id="giscus_container" style="min-height:320px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <script>
    const LANG_KEY = 'ffxiv-guide-lang';

    const i18n = {
      EN: {
        langLabel: 'EN',
        pageTitle: 'The Dark Inside',
        tabs: { story:'Story', req:'Requirements', acq:'Unlock Quest', unlock:'Follow-Up Quest', comments:'Comments' },
        story: `<p>Zodiark’s shackles have finally been broken, bringing His millennia-long imprisonment to an end. This premature awakening is the work of Fandaniel, who has cast aside his duty as an Ascian to turn the god of Darkness against the very star He was created to protect. With Zodiark’s unfathomable power at his disposal, Fandaniel has selected his first victim─the Warrior of Light, who has ever been a thorn in the Ascian’s side.</p>`,
        req: `<div class="stack">
          <div class="row">1 to 8 players (2 Tanks, 2 Healers, 4 DPS)</div>
          <div class="row">Unrestricted Parties Not Allowed</div>
          <div class="row">Class: Disciples of War or Magic</div>
          <div class="row">※ Limited jobs can participate only in a preformed party meeting party size requirements or an unrestricted party, and if duty rules allow.</div>
          <div class="row">Level: 83 (Sync from 84)</div>
          <div class="row">※ While synced, all item stats are adjusted.</div>
          <div class="row">※ Role and item level restrictions are lifted for parties meeting minimum size requirements.</div>
        </div>`,
        acq: `<div class="stack">
          <div class="row"><a class="link" href="#">The Martyr</a></div>
        </div>`,
        unlock: `<div class="stack">
          <div class="row"><a class="link" href="#">In Shadow’s Wake</a></div>
        </div>`
      },

      JP: {
        langLabel: 'JP',
        pageTitle: 'ゾディアーク討滅戦',
        tabs: { story:'ストーリー', req:'必要条件', acq:'開放クエスト', unlock:'後続クエスト', comments:'コメント' },
        story: `<p>ついにゾディアークの枷が破られ、幾千年に及ぶ幽閉が終わりを告げた。この早すぎる覚醒を引き起こしたのはファダニエルである。彼はアシエンとしての使命を捨て去り、闇の神を本来守るべき星に牙を剥かせようとしたのだ。計り知れぬ力を手中に収めたファダニエルが最初の獲物に選んだのは、常にアシエンの脅威であり続けた「光の戦士」──あなたであった。</p>`,
        req: `<div class="stack">
          <div class="row">1～8人用（タンク2／ヒーラー2／DPS4）</div>
          <div class="row">制限解除パーティ不可</div>
          <div class="row">参加条件：ファイター／ソーサラー</div>
          <div class="row">※ リミテッドジョブは、人数条件を満たす事前結成パーティまたは制限解除パーティ、かつ任務ルールが許可する場合のみ参加可能。</div>
          <div class="row">レベル：83（シンク：84）</div>
          <div class="row">※ シンク時はすべてのアイテムステータスが調整されます。</div>
          <div class="row">※ 最低人数条件を満たすパーティでは、ロールおよびアイテムレベル制限が解除されます。</div>
        </div>`,
        acq: `<div class="stack">
          <div class="row"><a class="link" href="#">星を救った英雄</a></div>
        </div>`,
        unlock: `<div class="stack">
          <div class="row"><a class="link" href="#">長き時の記録</a></div>
        </div>`
      },

      ZH: {
        langLabel: 'ZH',
        pageTitle: '黑暗深淵：佐迪亞克',
        tabs: { story:'故事概要', req:'需求條件', acq:'解鎖任務', unlock:'後續任務', comments:'留言' },
        story: `<p>Zodiark 的枷鎖終於被打破，結束了祂長達千年的囚禁。這場過早的甦醒正是 Fandaniel 的所作所為──他拋棄了 Ascian 的使命，反將這位黑暗之神引向本應守護的星球。如今，掌握了 Zodiark 無可測度力量的 Fandaniel，將目光投向了他的首個獵物──那個始終如刺般令 Ascian 危機四伏的存在，也就是你，「Warrior of Light」。</p>`,
        req: `<div class="stack">
          <div class="row">1–8 人（2 坦克、2 治療、4 輸出）</div>
          <div class="row">不允許無限制隊伍</div>
          <div class="row">職業：戰鬥／魔法師系</div>
          <div class="row">※ 限定職僅能在符合人數條件的預組隊伍或無限制隊伍，且當副本規則允許時方可參與。</div>
          <div class="row">等級：83（同步 84）</div>
          <div class="row">※ 同步時會調整所有裝備屬性。</div>
          <div class="row">※ 於符合最低人數條件的隊伍中，角色定位與裝備等級限制將予以解除。</div>
        </div>`,
        acq: `<div class="stack">
          <div class="row"><a class="link" href="#">殉道者</a></div>
        </div>`,
        unlock: `<div class="stack">
          <div class="row"><a class="link" href="#">歲月之痕</a></div>
        </div>`
      }
    };

    const langToggle = document.getElementById('langToggle');
    const pageTitle  = document.getElementById('pageTitle');
    const tabBtns    = [...document.querySelectorAll('.tab-btn')];
    const panels = {
      story : document.getElementById('panel-story'),
      acq   : document.getElementById('panel-acq'),
      req   : document.getElementById('panel-req'),
      unlock: document.getElementById('panel-unlock'),
      comments: document.getElementById('panel-comments') // 新增
    };

    function getLang(){ return localStorage.getItem(LANG_KEY) || 'EN'; }

    // 取代：進入 comments 才載入 giscus；不要覆寫留言容器
    function renderPanel(key, lang){
      const t = i18n[lang] || i18n.EN;
      Object.keys(panels).forEach(k => panels[k].classList.remove('active'));
      panels[key].classList.add('active');

      if (key !== 'comments') {
        panels[key].innerHTML = t[key];
      } else {
        loadGiscusForCurrentLang();
      }
    }

    tabBtns.forEach(btn=>{
      btn.addEventListener('click',()=>{
        tabBtns.forEach(b=>b.setAttribute('aria-selected','false'));
        btn.setAttribute('aria-selected','true');
        renderPanel(btn.dataset.tab, getLang());
      });
    });

    langToggle.addEventListener('click',()=>{
      const cur = getLang();
      const next = cur==='EN' ? 'JP' : (cur==='JP' ? 'ZH' : 'EN');
      localStorage.setItem(LANG_KEY,next);
      applyLang(next);
    });

    function applyLang(lang){
      const t = i18n[lang] || i18n.EN;
      pageTitle.textContent = t.pageTitle;
      langToggle.textContent = `🌐 ${t.langLabel}`;
      tabBtns.forEach(btn => { btn.textContent = t.tabs[btn.dataset.tab]; });
      const activeBtn = tabBtns.find(b=>b.getAttribute('aria-selected')==='true') || tabBtns[0];
      renderPanel(activeBtn.dataset.tab, lang);
      // 若正停在留言分頁，切語言後重載 giscus
      if (activeBtn && activeBtn.dataset.tab === 'comments') loadGiscusForCurrentLang();
    }

    applyLang(getLang());

    /* === Giscus：單一 Comments 分頁，隨語言切換 === */
    const GISCUS_CFG = {
      repo: 'belaug-ffxiv/FFXIV_Library',
      repoId: 'R_kgD0Pyh4Kw',
      category: 'General',
      categoryId: 'DIC_kwD0Pyh4K84CwPjL',
      theme: 'preferred_color_scheme'
    };
    function uiLang(code){ return code==='JP' ? 'ja' : (code==='ZH' ? 'zh-TW' : 'en'); }
    function loadGiscusForCurrentLang(){
      const mount = document.getElementById('giscus_container');
      if (!mount) return;
      mount.innerHTML = '';
      const langCode = getLang(); // EN / JP / ZH
      const s = document.createElement('script');
      s.src = 'https://giscus.app/client.js';
      s.setAttribute('data-repo', GISCUS_CFG.repo);
      s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
      s.setAttribute('data-category', GISCUS_CFG.category);
      s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
      s.setAttribute('data-mapping', 'specific');
      s.setAttribute('data-term', location.pathname + '｜' + langCode);
      s.setAttribute('data-reactions-enabled', '1');
      s.setAttribute('data-emit-metadata', '0');
      s.setAttribute('data-input-position', 'bottom');
      s.setAttribute('data-lang', uiLang(langCode));
      s.setAttribute('data-theme', GISCUS_CFG.theme);
      s.setAttribute('crossorigin', 'anonymous');
      s.async = true;
      mount.appendChild(s);
    }
  </script>
</body>
</html>
